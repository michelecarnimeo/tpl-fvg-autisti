<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>TPL FVG - Prezzi</title>
  <!-- Font locali per PWA offline -->
  <!-- CSS personalizzati -->
  <link rel="stylesheet" href="style1.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="src/tpl.jpg" type="image/jpeg">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
    }

    /* Nascondi card su mobile e aggiungi padding */
    @media (max-width: 768px) {
      .main-card {
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
        padding: 1rem !important;
        margin: 0 !important;
        border-radius: 0 !important;
      }
    }
  </style>
</head>

<body class="prezzi-page">
  <!-- Navbar -->
  <header class="navbar">
    <div class="container">
      <div class="navbar-content">
        <a href="index.html" class="navbar-brand-link">
          <div class="navbar-brand">
            <div class="navbar-logo-wrapper">
              <img src="src/logo.png" alt="TPL" class="navbar-logo navbar-logo-default" />
              <img src="src/logo1.png" alt="TPL" class="navbar-logo navbar-logo-hover" />
            </div>
            <div class="navbar-title">
              <div class="logo-acronym">
                <div>tpl</div>
                <div>fvg</div>
              </div>
              <div class="logo-text">
                <div>trasporto</div>
                <div>pubblico</div>
                <div>locale</div>
              </div>
            </div>
          </div>
        </a>
        <!-- Hamburger button (mobile only) -->
        <button id="hamburger-toggle" class="hamburger-toggle" aria-label="Menu">
          <span class="hamburger-icon"></span>
        </button>
        
        <nav class="navbar-nav">
          <a href="index.html" class="nav-link">Home</a>
          <a href="fermate.html" class="nav-link">Fermate</a>
          <a href="prezzi.html" class="nav-link active">Prezzi</a>
          <button id="desktop-settings-btn" class="nav-settings-btn" title="Impostazioni">
            <span class="settings-icon">⚙️</span>
            <span class="settings-text">Impostazioni</span>
          </button>
          
          <!-- Pulsanti individuali (nascosti su desktop, usati solo via JS per compatibilità) -->
          <button id="darkmode-toggle" class="dark-mode-toggle navbar-legacy-btn" title="Darkmode" style="display: none;">
            <span>🌙</span>
          </button>
          <button class="animation-toggle navbar-legacy-btn" id="animationToggle" title="Toggle animazione sfondo" style="display: none;">
            🎬
          </button>
          <button id="cache-reset" class="cache-reset-btn navbar-legacy-btn" title="Verifica aggiornamenti e riavvia app" style="display: none;">
            <span id="cache-icon">🔄</span>
          </button>
          <div class="font-size-group navbar-legacy-btn" style="display: none;">
            <button id="font-size-small" class="font-size-btn active" data-size="normal" title="Testo normale">
              <span>A</span>
            </button>
            <button id="font-size-medium" class="font-size-btn" data-size="large" title="Testo grande">
              <span>A</span>
            </button>
            <button id="font-size-large" class="font-size-btn" data-size="xlarge" title="Testo molto grande">
              <span>A</span>
            </button>
          </div>
        </nav>
      </div>
    </div>
    
    <!-- Mobile menu overlay -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay"></div>
    
    <!-- Mobile menu drawer -->
    <div id="mobile-menu" class="mobile-menu">
      <div class="mobile-menu-header">
        <span class="mobile-menu-title">Menu</span>
        <button id="mobile-menu-close" class="mobile-menu-close" aria-label="Chiudi menu">×</button>
      </div>
      <nav class="mobile-menu-nav">
        <a href="index.html" class="mobile-nav-link">
          <span class="mobile-nav-icon">🏠</span>
          <span>Home</span>
        </a>
        <a href="fermate.html" class="mobile-nav-link">
          <span class="mobile-nav-icon">🚌</span>
          <span>Fermate</span>
        </a>
        <a href="prezzi.html" class="mobile-nav-link">
          <span class="mobile-nav-icon">💰</span>
          <span>Prezzi</span>
        </a>
        <button id="open-settings" class="mobile-nav-link">
          <span class="mobile-nav-icon">⚙️</span>
          <span>Impostazioni</span>
        </button>
      </nav>
    </div>
  </header>

  <!-- Main Prezzi -->
  <main class="main-content">
    <div class="container">
      <h1 class="page-title">Prezzi per linea</h1>

      <!-- Pulsante selezione linea -->
      <div class="line-selector-container">
        <div class="form-group">
          <button id="linea-prezzi-btn" class="route-button linea-select-btn">
            <span id="linea-prezzi-text">Seleziona una linea</span>
            <span class="route-arrow">▼</span>
          </button>
        </div>
        
        <!-- Barra di ricerca (nascosta inizialmente) -->
        <div id="search-container-prezzi" class="search-container" style="display: none;">
          <div class="search-box">
            <span class="search-icon">🔍</span>
            <input type="text" id="search-input-prezzi" class="search-input" placeholder="Cerca tratta o codice..." />
            <button id="clear-search-prezzi" class="clear-btn" style="display: none;">✕</button>
          </div>
        </div>
      </div>

      <!-- Griglia prezzi (nascosta inizialmente) -->
      <div id="prezzi-grid-container" style="display: none;">
        <div class="main-card fade-in">
          <h2 id="andata-title" class="page-title">Prezzi e codici biglietto (Andata)</h2>
          <div class="overflow-x-auto">
            <table id="prezzi-andata" class="prezzi-table">
              <!-- Tabella generata da JS -->
            </table>
          </div>
        </div>

        <div class="main-card fade-in" style="animation-delay: 0.2s;">
          <h2 id="ritorno-title" class="page-title">Prezzi e codici biglietto (Ritorno)</h2>
          <div class="overflow-x-auto">
            <table id="prezzi-ritorno" class="prezzi-table">
              <!-- Tabella generata da JS -->
            </table>
          </div>
        </div>
      </div>
      <!-- Banner installazione PWA -->
      <div id="pwa-install-banner" class="pwa-install-banner" style="display: none;">
        <div class="pwa-install-content">
          <div class="pwa-install-text">
            <span class="pwa-install-title">📱 Installa l'app</span>
            <span class="pwa-install-subtitle">Accedi più velocemente e offline</span>
          </div>
          <div class="pwa-install-actions">
            <button id="pwa-install-later" class="pwa-btn pwa-btn-secondary" type="button">Più tardi</button>
            <button id="pwa-install-button" class="pwa-btn pwa-btn-primary" type="button">Installa</button>
          </div>
        </div>
        <div id="pwa-ios-hint" class="pwa-ios-hint" style="display: none;">
          <div class="ios-hint-title">📲 Come installare su iPhone/iPad:</div>
          <ol class="ios-hint-steps">
            <li><span class="step-number">1.</span> Tocca il pulsante <strong>Condividi</strong> <span class="ios-share-icon">📤</span> in basso (Safari)</li>
            <li><span class="step-number">2.</span> Scorri e seleziona <strong>"Aggiungi a Home"</strong> <span class="ios-plus-icon">➕</span></li>
            <li><span class="step-number">3.</span> Tocca <strong>"Aggiungi"</strong> in alto a destra ✅</li>
          </ol>
          <div class="ios-hint-note">💡 L'app apparirà sulla tua schermata Home come un'app nativa</div>
        </div>
      </div>
    </div>
  </main>

  <!-- PWA Brand Header (in alto) -->
  <div id="pwa-brand-header" class="pwa-brand-header" style="display: none;">
    <div class="pwa-logo-wrapper">
      <img src="src/logo.png" alt="TPL" class="pwa-logo-img pwa-logo-default">
      <img src="src/logo1.png" alt="TPL" class="pwa-logo-img pwa-logo-hover">
    </div>
    <div class="pwa-brand-title">
      <div class="pwa-logo-acronym">
        <div>tpl</div>
        <div>fvg</div>
      </div>
      <div class="pwa-logo-text">
        <div>trasporto</div>
        <div>pubblico</div>
        <div>locale</div>
      </div>
    </div>
  </div>
  
  <!-- PWA Bottom Navigation (in basso) -->
  <nav id="pwa-bottom-nav" class="pwa-bottom-nav" style="display: none;">
    <a href="index.html" class="pwa-nav-item" data-page="home">
      <svg class="pwa-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      <span class="pwa-nav-label">Home</span>
    </a>
    
    <a href="fermate.html" class="pwa-nav-item" data-page="fermate">
      <svg class="pwa-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="18" height="18" rx="2"></rect>
        <circle cx="8.5" cy="8.5" r="1.5"></circle>
        <circle cx="15.5" cy="8.5" r="1.5"></circle>
        <path d="M6 16h12"></path>
      </svg>
      <span class="pwa-nav-label">Fermate</span>
    </a>
    
    <a href="prezzi.html" class="pwa-nav-item active" data-page="prezzi">
      <svg class="pwa-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="1" x2="12" y2="23"></line>
        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
      </svg>
      <span class="pwa-nav-label">Prezzi</span>
    </a>
    
    <button class="pwa-nav-item" data-page="settings" id="pwa-settings-btn">
      <svg class="pwa-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M12 1v6m0 6v6m5.2-13.2l-4.2 4.2m0 6l4.2 4.2M1 12h6m6 0h6m-13.2 5.2l4.2-4.2m0-6l-4.2-4.2"></path>
      </svg>
      <span class="pwa-nav-label">Impostazioni</span>
    </button>
  </nav>

  <!-- Footer -->
  <footer class="footer">
    <p>© <span id="footer-year"></span> Michele Carnimeo. Tutti i diritti riservati.<br>TPL FVG è un marchio di TPL FVG S.C. a R.L. · <a href="test.html" style="color: inherit; text-decoration: none; transition: text-decoration 0.3s ease;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">TPL Autisti 1.4.9</a></p>
    <div class="footer-links">
      <a href="https://t.me/+eoJ9nYFFrjphMzVk" target="_blank" class="telegram-link" title="Canale Telegram">
        <span class="telegram-icon">📢</span> Avvisi & Aggiornamenti
      </a>
      <a href="https://t.me/+2yIF2NfPYt82MWI0" target="_blank" class="telegram-link" title="Gruppo Telegram">
        <span class="telegram-icon">🐛</span> Segnala Errori
      </a>
    </div>
  </footer>

  <!-- Pulsante torna su -->
  <button class="scroll-to-top" onclick="scrollToTop()" title="Torna su">
    ↑
  </button>

  <!-- Modal selezione linee -->
  <div id="linee-prezzi-modal" class="fermate-modal">
    <div class="fermate-modal-content">
      <div class="fermate-modal-header">
        <h3 id="linee-prezzi-modal-title">Seleziona linea</h3>
        <div class="fermate-modal-actions">
          <button id="linee-prezzi-modal-close" class="fermate-modal-close" aria-label="Chiudi">×</button>
        </div>
      </div>
      <div class="fermate-modal-body">
        <!-- Lista linee -->
        <div class="fermate-list-container">
          <ul id="linee-prezzi-modal-list" class="fermate-modal-list">
            <!-- Linee generate dinamicamente -->
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal conferma riavvio app -->
  <div id="cache-modal" class="cache-modal">
    <div class="cache-modal-content">
      <div class="cache-modal-header">
        <h3 id="modal-title">🔄 Verifica Aggiornamenti</h3>
      </div>
      <div class="cache-modal-body">
        <p id="modal-message">Verifico se ci sono aggiornamenti disponibili...</p>
        <p class="cache-modal-warning" id="modal-warning" style="display: none;">⚠️ L'app si ricaricherà automaticamente e tornerai alla pagina di benvenuto.</p>
      </div>
      <div class="cache-modal-footer">
        <button id="cache-cancel" class="cache-modal-btn cache-modal-cancel">Annulla</button>
        <button id="cache-confirm" class="cache-modal-btn cache-modal-confirm" style="display: none;">Riavvia e Aggiorna (v1.2)</button>
      </div>
    </div>
  </div>

  <!-- Modal Impostazioni -->
  <div id="settings-modal" class="settings-modal">
    <div class="settings-modal-content">
      <!-- Header -->
      <div class="settings-modal-header">
        <h3>⚙️ Impostazioni</h3>
        <button id="settings-modal-close" class="settings-modal-close" aria-label="Chiudi">×</button>
      </div>
      
      <!-- Tabs -->
      <div class="settings-tabs">
        <button class="settings-tab active" data-tab="appearance">
          <span class="tab-icon">👁️</span>
          <span>Aspetto</span>
        </button>
        <button class="settings-tab" data-tab="accessibility">
          <span class="tab-icon">♿</span>
          <span>Accessibilità</span>
        </button>
        <button class="settings-tab" data-tab="info">
          <span class="tab-icon">ℹ️</span>
          <span>Info</span>
        </button>
      </div>
      
      <!-- Tab Content -->
      <div class="settings-content">
        
        <!-- Tab Aspetto -->
        <div class="settings-tab-content active" data-content="appearance">
          <div class="settings-section">
            <h4 class="settings-section-title">👁️ Aspetto</h4>
            
            <!-- Theme Mode -->
            <div class="settings-item settings-item-vertical">
              <div class="settings-item-info">
                <span class="settings-item-icon">🌓</span>
                <div class="settings-item-text">
                  <div class="settings-item-label">Tema</div>
                  <div class="settings-item-description">Scegli l'aspetto dell'app</div>
                </div>
              </div>
              <div class="settings-theme-options">
                <label class="settings-theme-option">
                  <input type="radio" name="theme-mode" value="system" id="theme-system" checked>
                  <span class="theme-option-card">
                    <span class="theme-option-icon">⚙️</span>
                    <span class="theme-option-label">Sistema</span>
                    <span class="theme-option-description">Segue il dispositivo</span>
                  </span>
                </label>
                <label class="settings-theme-option">
                  <input type="radio" name="theme-mode" value="light" id="theme-light">
                  <span class="theme-option-card">
                    <span class="theme-option-icon">☀️</span>
                    <span class="theme-option-label">Chiara</span>
                    <span class="theme-option-description">Sempre chiara</span>
                  </span>
                </label>
                <label class="settings-theme-option">
                  <input type="radio" name="theme-mode" value="dark" id="theme-dark">
                  <span class="theme-option-card">
                    <span class="theme-option-icon">🌙</span>
                    <span class="theme-option-label">Scura</span>
                    <span class="theme-option-description">Sempre scura</span>
                  </span>
                </label>
              </div>
            </div>
            
            <!-- Animazione Sfondo -->
            <div class="settings-item">
              <div class="settings-item-info">
                <span class="settings-item-icon">🎬</span>
                <div class="settings-item-text">
                  <div class="settings-item-label">Animazione sfondo</div>
                  <div class="settings-item-description">Gradiente animato nello sfondo</div>
                </div>
              </div>
              <label class="settings-toggle">
                <input type="checkbox" id="settings-animation">
                <span class="settings-toggle-slider"></span>
              </label>
            </div>
            
            <!-- Contrasto Alto -->
            <div class="settings-item">
              <div class="settings-item-info">
                <span class="settings-item-icon">👁️</span>
                <div class="settings-item-text">
                  <div class="settings-item-label">Contrasto elevato</div>
                  <div class="settings-item-description">Migliora leggibilità in pieno sole</div>
                </div>
              </div>
              <label class="settings-toggle">
                <input type="checkbox" id="settings-high-contrast">
                <span class="settings-toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
        
        <!-- Tab Accessibilità -->
        <div class="settings-tab-content" data-content="accessibility">
          <div class="settings-section">
            <h4 class="settings-section-title">♿ Accessibilità</h4>
            
            <!-- Dimensione Testo -->
            <div class="settings-item settings-item-vertical">
              <div class="settings-item-info">
                <span class="settings-item-icon">A</span>
                <div class="settings-item-text">
                  <div class="settings-item-label">Dimensione testo</div>
                  <div class="settings-item-description">Scegli la dimensione più comoda</div>
                </div>
              </div>
              <div class="settings-font-buttons">
                <button class="settings-font-btn active" data-size="normal">
                  <span class="font-sample">A</span>
                  <span class="font-label">Normale</span>
                </button>
                <button class="settings-font-btn" data-size="large">
                  <span class="font-sample">A</span>
                  <span class="font-label">Grande</span>
                </button>
                <button class="settings-font-btn" data-size="xlarge">
                  <span class="font-sample">A</span>
                  <span class="font-label">Molto Grande</span>
                </button>
              </div>
            </div>
            
            <!-- Pulsanti Grandi -->
            <div class="settings-item">
              <div class="settings-item-info">
                <span class="settings-item-icon">👆</span>
                <div class="settings-item-text">
                  <div class="settings-item-label">Modalità touch</div>
                  <div class="settings-item-description">Pulsanti più grandi e spaziati</div>
                </div>
              </div>
              <label class="settings-toggle">
                <input type="checkbox" id="settings-touch-friendly">
                <span class="settings-toggle-slider"></span>
              </label>
            </div>
          </div>
          
          <!-- Sezione Dimensione Interfaccia -->
          <div class="settings-section">
            <h4 class="settings-section-title">🔍 Dimensione Interfaccia</h4>
            
            <div class="scale-preset-selector">
              <div class="scale-preset-description">
                Scala l'intera interfaccia della web app
              </div>
              
              <div class="scale-preset-options">
                <label class="scale-preset-option">
                  <input type="radio" name="interface-scale" value="75" id="scale-75">
                  <div class="scale-preset-card">
                    <div class="scale-preset-info">
                      <div class="scale-preset-name">Molto Compatta</div>
                      <div class="scale-preset-percent">75%</div>
                    </div>
                  </div>
                </label>
                
                <label class="scale-preset-option">
                  <input type="radio" name="interface-scale" value="85" id="scale-85">
                  <div class="scale-preset-card">
                    <div class="scale-preset-info">
                      <div class="scale-preset-name">Compatta</div>
                      <div class="scale-preset-percent">85%</div>
                    </div>
                  </div>
                </label>
                
                <label class="scale-preset-option">
                  <input type="radio" name="interface-scale" value="100" id="scale-100" checked>
                  <div class="scale-preset-card">
                    <div class="scale-preset-info">
                      <div class="scale-preset-name">Normale</div>
                      <div class="scale-preset-percent">100%</div>
                    </div>
                  </div>
                </label>
                
                <label class="scale-preset-option">
                  <input type="radio" name="interface-scale" value="115" id="scale-115">
                  <div class="scale-preset-card">
                    <div class="scale-preset-info">
                      <div class="scale-preset-name">Grande</div>
                      <div class="scale-preset-percent">115%</div>
                    </div>
                  </div>
                </label>
                
                <label class="scale-preset-option">
                  <input type="radio" name="interface-scale" value="125" id="scale-125">
                  <div class="scale-preset-card">
                    <div class="scale-preset-info">
                      <div class="scale-preset-name">Molto Grande</div>
                      <div class="scale-preset-percent">125%</div>
                    </div>
                  </div>
                </label>
              </div>
            </div>
          </div>
          
          <!-- Sezione Ottimizzazione Display -->
          <div class="settings-section">
            <h4 class="settings-section-title">🖥️ Ottimizzazione Display</h4>
            
            <!-- Info Display Rilevato -->
            <div class="display-optimization-card">
              <div class="display-detection">
                <div class="display-detection-header">
                  <span class="display-detection-icon">📱</span>
                  <div class="display-detection-info">
                    <div class="display-detection-title">Display rilevato</div>
                    <div class="display-detection-type" id="display-type-indicator">
                      <span id="display-type-text">Rilevamento...</span>
                      <span class="display-dpr-badge" id="display-dpr-badge">-</span>
                    </div>
                  </div>
                </div>
                
                <div class="display-specs">
                  <div class="display-spec-item">
                    <span class="display-spec-label">Device Pixel Ratio</span>
                    <span class="display-spec-value" id="dpr-value">-</span>
                  </div>
                  <div class="display-spec-item">
                    <span class="display-spec-label">Risoluzione fisica</span>
                    <span class="display-spec-value" id="resolution-value">-</span>
                  </div>
                </div>
              </div>
              
              <!-- Preset Ottimizzazione -->
              <div class="display-preset-selector" style="margin-top: 1rem; border-top: 1px solid var(--bordo); padding-top: 1rem;">
                <div class="preset-header">
                  <span class="preset-header-icon">🎨</span>
                  <div class="preset-header-text">
                    <div class="preset-header-title">Livello di ottimizzazione</div>
                    <div class="preset-header-description">Scegli il preset più adatto al tuo display</div>
                  </div>
                </div>
                
                <div class="preset-options">
                  <label class="preset-option" data-preset="auto">
                    <input type="radio" name="display-preset" value="auto" id="preset-auto">
                    <div class="preset-card">
                      <div class="preset-icon">⚡</div>
                      <div class="preset-info">
                        <div class="preset-name">
                          Automatico
                          <span class="recommended-badge" id="auto-badge" style="display: none;">Consigliato</span>
                        </div>
                        <div class="preset-description">Rileva e ottimizza automaticamente</div>
                      </div>
                    </div>
                  </label>
                  
                  <label class="preset-option" data-preset="standard">
                    <input type="radio" name="display-preset" value="standard" id="preset-standard">
                    <div class="preset-card">
                      <div class="preset-icon">📺</div>
                      <div class="preset-info">
                        <div class="preset-name">Standard</div>
                        <div class="preset-description">Nessuna ottimizzazione (DPR 1.0x)</div>
                      </div>
                    </div>
                  </label>
                  
                  <label class="preset-option" data-preset="retina">
                    <input type="radio" name="display-preset" value="retina" id="preset-retina">
                    <div class="preset-card">
                      <div class="preset-icon">💎</div>
                      <div class="preset-info">
                        <div class="preset-name">Retina</div>
                        <div class="preset-description">Ottimizzato per DPR 2.0x (HiDPI)</div>
                      </div>
                    </div>
                  </label>
                  
                  <label class="preset-option" data-preset="ultra">
                    <input type="radio" name="display-preset" value="ultra" id="preset-ultra">
                    <div class="preset-card">
                      <div class="preset-icon">✨</div>
                      <div class="preset-info">
                        <div class="preset-name">Ultra HD</div>
                        <div class="preset-description">Massima qualità per DPR 3.0x+</div>
                      </div>
                    </div>
                  </label>
                </div>
              </div>
              
              <!-- Suggerimenti -->
              <div class="display-recommendations" id="display-recommendations" style="display: none;">
                <div class="recommendation-header">
                  <span class="recommendation-icon">💡</span>
                  <span class="recommendation-title">Suggerimenti per il tuo display</span>
                </div>
                <ul class="recommendation-list" id="recommendation-list">
                  <!-- Popolato dinamicamente -->
                </ul>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Tab Info e Aggiornamenti -->
        <div class="settings-tab-content" data-content="info">
          <div class="settings-section">
            <h4 class="settings-section-title">ℹ️ Informazioni</h4>
            
            <!-- Informazioni App -->
            <div class="info-card">
              <div class="info-header">
                <img src="src/logo.png" alt="TPL FVG" class="info-logo">
                <div class="info-title">
                  <h3>TPL FVG Autisti</h3>
                  <p class="info-version">Versione 1.4.9</p>
                  <p class="info-date">25 Ottobre 2025 - 21:00</p>
                </div>
              </div>
              
              <div class="info-description">
                <p>App per calcolare i prezzi dei biglietti e visualizzare le fermate del trasporto pubblico locale del Friuli Venezia Giulia.</p>
              </div>
              
              <div class="info-features">
                <div class="info-feature">
                  <span class="info-feature-icon">💰</span>
                  <span>Calcolo prezzi biglietti</span>
                </div>
                <div class="info-feature">
                  <span class="info-feature-icon">🚌</span>
                  <span>Elenco fermate per linea</span>
                </div>
                <div class="info-feature">
                  <span class="info-feature-icon">📱</span>
                  <span>Installabile come PWA</span>
                </div>
                <div class="info-feature">
                  <span class="info-feature-icon">🌙</span>
                  <span>Modalità scura</span>
                </div>
              </div>
            </div>
            
            <!-- Verifica Aggiornamenti -->
            <div class="info-card update-check-card">
              <div class="update-check-header">
                <div class="update-check-icon">🔄</div>
                <div class="update-check-text">
                  <h4 class="update-check-title">Verifica Aggiornamenti</h4>
                  <p class="update-check-description">Controlla se è disponibile una nuova versione dell'app</p>
                </div>
              </div>
              <button id="pwa-cache-reset" class="update-check-btn">
                Verifica Aggiornamenti
              </button>
            </div>
            
            <!-- Riavvia App -->
            <div class="info-card update-check-card">
              <div class="update-check-header">
                <div class="update-check-icon">📲</div>
                <div class="update-check-text">
                  <h4 class="update-check-title">Riavvia App</h4>
                  <p class="update-check-description">Riavvia l'applicazione per applicare le modifiche</p>
                </div>
              </div>
              <button id="restart-app-btn" class="update-check-btn restart-app-btn">
                Riavvia Ora
              </button>
            </div>
            
            <!-- Aggiornamenti Recenti -->
            <div class="info-card">
              <h4 class="info-card-title">📋 Aggiornamenti Recenti</h4>
              
              <div class="update-item">
                <div class="update-version">
                  <span class="update-badge">v1.4.9</span>
                  <span class="update-date">25 Ottobre 2025</span>
                </div>
                <div class="update-content">
                  <p class="update-title">Info Device & Test GPS Avanzati</p>
                  <ul class="update-list">
                    <li>📱 Sezione "Info Device/Browser" con rilevamento hardware</li>
                    <li>🎨 Layout responsive: card colorate su desktop, lista su mobile</li>
                    <li>⚡ Test Rapido GPS One-Click con report automatico</li>
                    <li>📄 Export Report completo (JSON + TXT)</li>
                    <li>🔄 Modal moderno per Reset dati GPS</li>
                    <li>🔋 Monitoraggio batteria e connessione in tempo reale</li>
                  </ul>
                </div>
              </div>
              
              <div class="update-item update-item-hidden">
                <div class="update-version">
                  <span class="update-badge">v1.4.8</span>
                  <span class="update-date">25 Ottobre 2025</span>
                </div>
                <div class="update-content">
                  <p class="update-title">Simulazione Posizione GPS Fake</p>
                  <ul class="update-list">
                    <li>🎭 Modalità test con posizione GPS simulata</li>
                    <li>Preset città FVG: Trieste, Udine, Pordenone, Gorizia</li>
                    <li>Input manuale coordinate personalizzate (lat/lng)</li>
                    <li>Configurazione accuratezza e altitudine</li>
                    <li>Badge visivo GPS reale vs simulato</li>
                    <li>Integrazione completa con mappa e calcolo distanza</li>
                  </ul>
                </div>
              </div>
              
              <div class="update-item update-item-hidden">
                <div class="update-version">
                  <span class="update-badge">v1.4.7</span>
                  <span class="update-date">25 Ottobre 2025</span>
                </div>
                <div class="update-content">
                  <p class="update-title">Mappa Interattiva e Banner HTTPS</p>
                  <ul class="update-list">
                    <li>Mappa interattiva con Leaflet.js (~40KB, tile OpenStreetMap)</li>
                    <li>Marker blu posizione attuale con popup coordinate</li>
                    <li>Cerchio accuratezza GPS con raggio dinamico</li>
                    <li>Zoom automatico intelligente e pulsante "Centra"</li>
                    <li>Banner HTTPS dinamico (visibile solo se necessario)</li>
                    <li>Controlli interattivi: drag, zoom, popup click</li>
                  </ul>
                </div>
              </div>
              
              <div class="update-item update-item-hidden">
                <div class="update-version">
                  <span class="update-badge">v1.4.6</span>
                  <span class="update-date">25 Ottobre 2025</span>
                </div>
                <div class="update-content">
                  <p class="update-title">Calcolo Distanza GPS</p>
                  <ul class="update-list">
                    <li>Preset città FVG: Trieste, Udine, Pordenone, Gorizia</li>
                    <li>Input coordinate personalizzate per punti specifici</li>
                    <li>Formula Haversine per distanza in linea d'aria (km)</li>
                    <li>Tempi stimati: a piedi (5km/h), bus (30km/h), auto (50km/h)</li>
                    <li>Formattazione intelligente tempi (15min o 1h 25min)</li>
                  </ul>
                </div>
              </div>
              
              <div class="update-item update-item-hidden">
                <div class="update-version">
                  <span class="update-badge">v1.4.5</span>
                  <span class="update-date">25 Ottobre 2025</span>
                </div>
                <div class="update-content">
                  <p class="update-title">Miglioramenti Test Geolocalizzazione</p>
                  <ul class="update-list">
                    <li>Status permessi geolocalizzazione in tempo reale (granted/denied/prompt)</li>
                    <li>Pulsante "Copia Coordinate" per copiare lat/long negli appunti</li>
                    <li>Reverse geocoding: mostra indirizzo testuale (via, città, CAP)</li>
                    <li>Velocità e direzione (se disponibili durante movimento)</li>
                    <li>Altitudine con margine errore (±m)</li>
                  </ul>
                </div>
              </div>
              
              <div class="update-item update-item-hidden">
                <div class="update-version">
                  <span class="update-badge">v1.4.4</span>
                  <span class="update-date">25 Ottobre 2025</span>
                </div>
                <div class="update-content">
                  <p class="update-title">Banner Offline e Simulazione Connettività</p>
                  <ul class="update-list">
                    <li>Aggiunto banner notifica offline/online in alto con design glassmorphism</li>
                    <li>Animazione icona pulsante e transizione slide-down</li>
                    <li>Banner verde "Connessione ripristinata" quando torna online</li>
                    <li>Simulazione modalità offline persistente su test.html</li>
                    <li>Sincronizzazione cross-tab della modalità offline test</li>
                  </ul>
                </div>
              </div>
              
              <div class="update-item update-item-hidden">
                <div class="update-version">
                  <span class="update-badge">v1.4.3</span>
                  <span class="update-date">24 Ottobre 2025</span>
                </div>
                <div class="update-content">
                  <p class="update-title">Verifica Aggiornamenti PWA e Miglioramenti UI</p>
                  <ul class="update-list">
                    <li>Aggiunto pulsante "Verifica Aggiornamenti" in modalità PWA</li>
                    <li>Contorni attivi per sezioni impostazioni personalizzate</li>
                    <li>Tema "Sistema" selezionato di default</li>
                    <li>Dimensione testo "Normale" evidenziato di default</li>
                    <li>Rimosso link ridondante "Vedi tutti gli aggiornamenti"</li>
                    <li>Ottimizzazioni UI e UX generali</li>
                  </ul>
                </div>
              </div>
              
              <div class="update-item update-item-hidden">
                <div class="update-version">
                  <span class="update-badge">v1.4.2</span>
                  <span class="update-date">24 Ottobre 2025</span>
                </div>
                <div class="update-content">
                  <p class="update-title">PWA Bottom Navigation e Tab Info</p>
                  <ul class="update-list">
                    <li>Barra di navigazione moderna e sospesa in modalità PWA</li>
                    <li>Design con glassmorphism e bordi arrotondati</li>
                    <li>Logo TPL centrale (60px) con effetto rifrazione luce</li>
                    <li>Accesso rapido: Home, Fermate, Prezzi, Impostazioni</li>
                    <li>Nuova tab "Info e Aggiornamenti" nel modal Impostazioni</li>
                    <li>Navbar superiore nascosta in modalità PWA</li>
                  </ul>
                </div>
              </div>
              
              <div class="update-item update-item-hidden">
                <div class="update-version">
                  <span class="update-badge">v1.4.0</span>
                  <span class="update-date">Ottobre 2025</span>
                </div>
                <div class="update-content">
                  <p class="update-title">Miglioramenti Generali</p>
                  <ul class="update-list">
                    <li>Ottimizzazioni performance</li>
                    <li>Miglioramenti UI/UX</li>
                    <li>Bug fix vari</li>
                  </ul>
                </div>
              </div>
              
              <button class="show-all-updates-btn" id="show-all-updates-btn">
                <span class="show-updates-icon">📋</span>
                <span class="show-updates-text">Vedi tutti gli aggiornamenti</span>
              </button>
            </div>
            
            <!-- Link Utili -->
            <div class="info-card">
              <h4 class="info-card-title">🔗 Link Utili</h4>
              
              <a href="https://t.me/+eoJ9nYFFrjphMzVk" target="_blank" class="info-link external-link">
                <span class="info-link-icon">📢</span>
                <span>Canale Telegram - Avvisi & Aggiornamenti</span>
                <span>↗</span>
              </a>
              
              <a href="test.html" class="info-link">
                <span class="info-link-icon">🧪</span>
                <span>Pagina Test Funzionalità</span>
                <span>→</span>
              </a>
            </div>
            
            <!-- Crediti -->
            <div class="info-footer">
              <p>© 2025 Michele Carnimeo. Tutti i diritti riservati.</p>
              <p class="info-disclaimer">TPL FVG è un marchio di TPL FVG S.C. a R.L.</p>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>

  <!-- Script principale -->
  <script src="script.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(err => console.error('SW registration failed', err));
      });
    }
    
    // ===== SISTEMA PRO DI OTTIMIZZAZIONE DISPLAY =====
    (function() {
      const STORAGE_KEY = 'tpl.displayOptimization';
      const FIRST_RUN_KEY = 'tpl.displayOptFirstRun';
      
      // Rileva info display
      function detectDisplayInfo() {
        const dpr = window.devicePixelRatio || 1;
        const screenWidth = window.screen.width;
        const screenHeight = window.screen.height;
        const physicalWidth = Math.round(screenWidth * dpr);
        const physicalHeight = Math.round(screenHeight * dpr);
        
        let type = 'standard';
        let typeName = 'Standard';
        let typeClass = '';
        
        if (dpr >= 3) {
          type = 'super-retina';
          typeName = 'Super Retina / Ultra HD';
          typeClass = 'super-retina';
        } else if (dpr >= 2) {
          type = 'retina';
          typeName = 'Retina / HiDPI';
          typeClass = 'retina';
        } else if (dpr > 1) {
          type = 'high-density';
          typeName = 'Alta Densità';
          typeClass = 'retina';
        }
        
        return {
          dpr,
          type,
          typeName,
          typeClass,
          screenWidth,
          screenHeight,
          physicalWidth,
          physicalHeight,
          isHighDPI: dpr >= 2
        };
      }
      
      // Genera suggerimenti intelligenti
      function generateRecommendations(displayInfo) {
        const recommendations = [];
        
        if (displayInfo.dpr >= 2) {
          recommendations.push('Il tuo display <strong>ad alta densità</strong> beneficia delle ottimizzazioni automatiche');
          
          if (displayInfo.dpr >= 3) {
            recommendations.push('Con DPR <strong>' + displayInfo.dpr.toFixed(2) + 'x</strong>, potresti preferire la dimensione testo "Grande" o "Molto Grande"');
          } else {
            recommendations.push('Considera di usare la dimensione testo "Media" o "Grande" per una migliore leggibilità');
          }
          
          recommendations.push('Le icone e i bordi sono ottimizzati automaticamente per apparire più nitidi');
          
          if (displayInfo.physicalWidth >= 2880) {
            recommendations.push('Il tuo schermo ad altissima risoluzione visualizza i dettagli in modo eccellente');
          }
        } else {
          recommendations.push('Il tuo display ha una densità standard. Le ottimizzazioni non sono necessarie.');
        }
        
        return recommendations;
      }
      
      // Aggiorna UI
      function updateDisplayUI(displayInfo) {
        // Tipo display
        const displayTypeText = document.getElementById('display-type-text');
        const displayDprBadge = document.getElementById('display-dpr-badge');
        
        if (displayTypeText) {
          displayTypeText.textContent = displayInfo.typeName;
          displayTypeText.className = displayInfo.typeClass;
        }
        
        if (displayDprBadge) {
          displayDprBadge.textContent = displayInfo.dpr.toFixed(2) + 'x';
          displayDprBadge.className = 'display-dpr-badge ' + displayInfo.typeClass;
        }
        
        // Valori spec
        const dprValue = document.getElementById('dpr-value');
        const resolutionValue = document.getElementById('resolution-value');
        
        if (dprValue) {
          dprValue.textContent = displayInfo.dpr.toFixed(2) + 'x';
        }
        
        if (resolutionValue) {
          resolutionValue.textContent = displayInfo.physicalWidth + ' × ' + displayInfo.physicalHeight + ' px';
        }
        
        // Badge consigliato
        const autoBadge = document.getElementById('auto-opt-badge');
        if (autoBadge && displayInfo.isHighDPI) {
          autoBadge.style.display = 'inline-block';
        }
        
        // Suggerimenti
        const recommendations = generateRecommendations(displayInfo);
        const recContainer = document.getElementById('display-recommendations');
        const recList = document.getElementById('recommendation-list');
        
        if (recContainer && recList && recommendations.length > 0) {
          recList.innerHTML = recommendations.map(rec => '<li>' + rec + '</li>').join('');
          recContainer.style.display = 'block';
        }
        
        // Log console
        console.log('🖥️ Display rilevato:', {
          tipo: displayInfo.typeName,
          dpr: displayInfo.dpr,
          risoluzione: displayInfo.screenWidth + 'x' + displayInfo.screenHeight,
          fisica: displayInfo.physicalWidth + 'x' + displayInfo.physicalHeight,
          highDPI: displayInfo.isHighDPI
        });
      }
      
      // Applica ottimizzazioni in base al preset
      function applyPreset(preset, displayInfo) {
        // Rimuovi tutte le classi di ottimizzazione
        document.body.classList.remove('display-optimized', 'display-retina', 'display-ultra');
        
        let appliedClass = '';
        
        switch(preset) {
          case 'auto':
            // Automatico - rileva e applica
            if (displayInfo.dpr >= 3) {
              document.body.classList.add('display-optimized', 'display-ultra');
              appliedClass = 'Ultra HD (auto)';
            } else if (displayInfo.dpr >= 2) {
              document.body.classList.add('display-optimized', 'display-retina');
              appliedClass = 'Retina (auto)';
            } else {
              appliedClass = 'Standard (auto)';
            }
            break;
            
          case 'retina':
            document.body.classList.add('display-optimized', 'display-retina');
            appliedClass = 'Retina';
            break;
            
          case 'ultra':
            document.body.classList.add('display-optimized', 'display-ultra');
            appliedClass = 'Ultra HD';
            break;
            
          case 'standard':
          default:
            appliedClass = 'Standard';
            break;
        }
        
        console.log('🎨 Preset applicato:', appliedClass);
        
        // Salva preferenza
        localStorage.setItem(STORAGE_KEY, preset);
      }
      
      // Auto-configurazione al primo avvio
      function firstRunAutoConfig(displayInfo) {
        const hasRun = localStorage.getItem(FIRST_RUN_KEY);
        
        if (!hasRun) {
          // Primo avvio - pre-configura 'auto'
          localStorage.setItem(STORAGE_KEY, 'auto');
          console.log('🎉 Prima configurazione: Preset "Automatico" selezionato');
          localStorage.setItem(FIRST_RUN_KEY, 'true');
        }
      }
      
      // Inizializzazione
      function init() {
        const displayInfo = detectDisplayInfo();
        updateDisplayUI(displayInfo);
        
        // Auto-config al primo avvio
        firstRunAutoConfig(displayInfo);
        
        // Leggi preset salvato
        const savedPreset = localStorage.getItem(STORAGE_KEY) || 'auto';
        
        // Setup radio buttons
        const presetRadios = document.querySelectorAll('input[name="display-preset"]');
        presetRadios.forEach(radio => {
          if (radio.value === savedPreset) {
            radio.checked = true;
          }
          
          radio.addEventListener('change', (e) => {
            if (e.target.checked) {
              applyPreset(e.target.value, displayInfo);
            }
          });
        });
        
        // Mostra badge "Consigliato" su Automatico se HiDPI
        const autoBadge = document.getElementById('auto-badge');
        if (autoBadge && displayInfo.isHighDPI) {
          autoBadge.style.display = 'inline-block';
        }
        
        // Applica preset iniziale
        applyPreset(savedPreset, displayInfo);
      }
      
      // Avvia al caricamento
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
      
      // Re-detect su resize (rotazione, zoom)
      let resizeTimeout;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          const displayInfo = detectDisplayInfo();
          updateDisplayUI(displayInfo);
        }, 300);
      });
    })();
    
    // ===== SISTEMA SCALA INTERFACCIA =====
    (function() {
      const STORAGE_KEY_SCALE = 'tpl.interfaceScale';
      
      // Applica scala all'interfaccia
      function applyScale(scale) {
        // Rimuovi tutte le classi di scala
        document.documentElement.classList.remove('scale-75', 'scale-85', 'scale-100', 'scale-115', 'scale-125');
        
        // Aggiungi la classe corretta
        document.documentElement.classList.add('scale-' + scale);
        
        console.log('🔍 Scala interfaccia applicata:', scale + '%');
        
        // Salva preferenza
        localStorage.setItem(STORAGE_KEY_SCALE, scale);
      }
      
      // Inizializzazione
      function initScale() {
        // Leggi scala salvata (default 100)
        const savedScale = localStorage.getItem(STORAGE_KEY_SCALE) || '100';
        
        // Setup radio buttons
        const scaleRadios = document.querySelectorAll('input[name="interface-scale"]');
        scaleRadios.forEach(radio => {
          if (radio.value === savedScale) {
            radio.checked = true;
          }
          
          radio.addEventListener('change', (e) => {
            if (e.target.checked) {
              applyScale(e.target.value);
            }
          });
        });
        
        // Applica scala iniziale
        applyScale(savedScale);
      }
      
      // Avvia al caricamento
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initScale);
      } else {
        initScale();
      }
    })();
  </script>
</body>

</html>