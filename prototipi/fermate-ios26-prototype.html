<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>TPL FVG - Fermate iOS 26</title>
  <link rel="stylesheet" href="css/fonts.css">
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/icons.css">
  <link rel="stylesheet" href="css/components/navbar.css">
  <link rel="stylesheet" href="css/components/settings-button.css">
  <link rel="stylesheet" href="css/components/hamburger-button.css">
  <link rel="stylesheet" href="css/components/mobile-menu.css">
  <link rel="stylesheet" href="css/components/main-card.css">
  <link rel="stylesheet" href="css/components/step-content.css">
  <link rel="stylesheet" href="css/components/selection-buttons.css">
  <link rel="stylesheet" href="css/components/progress-bar.css">
  <link rel="stylesheet" href="css/pages/fermate-page.css">
  <style>
    /* Fix per visibilità pulsante hamburger nella pagina fermate */
    .navbar-actions {
      display: flex !important;
      align-items: center !important;
      opacity: 1 !important;
      visibility: visible !important;
      z-index: 2000 !important;
    }

    .hamburger-toggle {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
      z-index: 2001 !important;
      position: relative !important;
      min-width: 140px !important;
      padding: 0.6rem 0.75rem !important;
      height: auto !important;
      overflow: visible !important;
    }

    .hamburger-section-label {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
    }

    .hamburger-separator {
      opacity: 1 !important;
      visibility: visible !important;
    }

    .hamburger-icon-wrapper {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
    }

    .hamburger-icon {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
    }

    .hamburger-icon span {
      display: block !important;
      opacity: 1 !important;
      visibility: visible !important;
    }

    @media (min-width: 768px) {
      .hamburger-toggle {
        min-width: 160px !important;
      }
    }

    /* Override padding body per pagina fermate */
    body {
      padding-top: 80px !important;
    }

    @media (max-width: 768px) {
      body {
        padding-top: 70px !important;
      }
    }

  </style>
  <style>
    /* EMERGENCY FIX FOR HAMBURGER BUTTON VISIBILITY */
    .navbar-actions {
      display: flex !important;
      align-items: center !important;
      opacity: 1 !important;
      visibility: visible !important;
      z-index: 2000 !important;
    }

    .hamburger-toggle {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
      z-index: 2001 !important;
      position: relative !important;
      min-width: 140px !important;
      padding: 0.6rem 0.75rem !important;
      height: auto !important;
      overflow: visible !important;
    }

    .hamburger-section-label {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
    }

    .hamburger-separator {
      opacity: 1 !important;
      visibility: visible !important;
    }

    .hamburger-icon-wrapper {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
    }

    .hamburger-icon {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
    }

    .hamburger-icon span {
      display: block !important;
      opacity: 1 !important;
      visibility: visible !important;
    }

    @media (min-width: 768px) {
      .hamburger-toggle {
        min-width: 160px !important;
      }
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="navbar-content">
      <a href="home-ios26-prototype.html" class="navbar-brand">
        <div class="navbar-logo-wrapper">
          <img src="../src/logo.png" alt="TPL" class="navbar-logo" onerror="this.style.display='none'" />
        </div>
        <div class="navbar-title">
          <div class="logo-acronym">
            <span class="logo-line">tpl</span>
            <span class="logo-line">fvg</span>
          </div>
          <div class="logo-text">
            <span class="logo-text-line">trasporto</span>
            <span class="logo-text-line">pubblico</span>
            <span class="logo-text-line">locale</span>
          </div>
        </div>
      </a>

      <nav class="navbar-nav">
        <a href="home-ios26-prototype.html" class="nav-link">Home</a>
        <a href="fermate-ios26-prototype.html" class="nav-link active">Fermate</a>
        <a href="#" class="nav-link">Prezzi</a>
      </nav>

      <div class="navbar-actions">
        <button
          class="settings-button"
          aria-label="Impostazioni"
          title="Impostazioni"
        >
          <svg
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"
            ></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
        <button class="hamburger-toggle" onclick="toggleMobileMenu()" aria-label="Menu" id="hamburger-toggle"
          data-section="fermate">
          <span class="hamburger-section-label">Fermate</span>
          <span class="hamburger-separator"></span>
          <div class="hamburger-icon-wrapper">
            <div class="hamburger-icon">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile Menu Overlay -->
  <div class="mobile-menu-overlay" id="mobile-menu-overlay"></div>

  <!-- Mobile Menu - Popup iOS 26 Style -->
  <div class="mobile-menu" id="mobile-menu">
    <nav class="mobile-menu-nav">
      <a href="home-ios26-prototype.html" class="mobile-nav-link">
        <span class="mobile-nav-icon">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="0.8"
            stroke-linecap="round"
            stroke-linejoin="round"
            width="20"
            height="20"
          >
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
        </span>
        <span>Home</span>
      </a>
      <a href="fermate-ios26-prototype.html" class="mobile-nav-link active">
        <span class="mobile-nav-icon">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="0.8"
            stroke-linecap="round"
            stroke-linejoin="round"
            width="20"
            height="20"
          >
            <rect x="6" y="5" width="12" height="14" rx="2" />
            <line x1="6" y1="9" x2="18" y2="9" />
            <line x1="6" y1="14" x2="18" y2="14" />
            <line x1="8" y1="17" x2="9" y2="17" />
            <line x1="15" y1="17" x2="16" y2="17" />
            <path d="M6 8c-2 0 -3 1 -3 3v2" />
            <path d="M18 8c2 0 3 1 3 3v2" />
            <path d="M8 19v1a1.5 1.5 0 0 0 3 0v-1" />
            <path d="M13 19v1a1.5 1.5 0 0 0 3 0v-1" />
          </svg>
        </span>
        <span>Fermate</span>
      </a>
      <a href="prezzi-ios26-prototype.html" class="mobile-nav-link">
        <span class="mobile-nav-icon">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="0.8"
            stroke-linecap="round"
            stroke-linejoin="round"
            width="20"
            height="20"
          >
            <path
              d="M19 5H5a2 2 0 0 0-2 2v2.5a2.5 2.5 0 0 1 0 5V17a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-2.5a2.5 2.5 0 0 1 0-5V7a2 2 0 0 0-2-2z"
            />
            <circle cx="8" cy="9" r="1" fill="currentColor" stroke="none" />
            <circle cx="8" cy="12" r="1" fill="currentColor" stroke="none" />
            <circle cx="8" cy="15" r="1" fill="currentColor" stroke="none" />
            <line x1="12" y1="9" x2="17" y2="9" />
            <line x1="12" y1="12" x2="17" y2="12" />
            <line x1="12" y1="15" x2="17" y2="15" />
          </svg>
        </span>
        <span>Prezzi</span>
      </a>
      <div class="mobile-nav-separator"></div>
      <button class="mobile-nav-link" onclick="toggleTheme()">
        <span class="mobile-nav-icon">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            width="20"
            height="20"
          >
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </span>
        <span>Tema</span>
      </button>
    </nav>
  </div>

  <div class="step-nav-sticky" aria-label="Navigazione rapida step">
    <div class="step-nav-container">
      <button type="button" class="step-nav-button active" data-step-target="1" onclick="handleStepNavClick(1)">
        <span class="step-nav-index">1</span>
        <span>Linea</span>
      </button>
      <button type="button" class="step-nav-button" data-step-target="2" onclick="handleStepNavClick(2)">
        <span class="step-nav-index">2</span>
        <span>Fermate</span>
      </button>
    </div>
  </div>

  <div class="container">
    <div class="main-card">
      <!-- Desktop Tabs Navigation -->
      <div class="desktop-step-tabs" aria-label="Navigazione step desktop">
        <button
          type="button"
          class="desktop-tab active"
          data-step-target="1"
          onclick="handleStepNavClick(1)"
        >
          <span class="desktop-tab-number">1</span>
          <div class="desktop-tab-label-wrapper">
            <span class="desktop-tab-label">Linea</span>
            <span
              class="desktop-tab-selected"
              id="selected-linea-tab-indicator"
            ></span>
          </div>
        </button>
        <button
          type="button"
          class="desktop-tab"
          data-step-target="2"
          onclick="handleStepNavClick(2)"
        >
          <span class="desktop-tab-number">2</span>
          <span class="desktop-tab-label">Fermate</span>
        </button>

        <div class="desktop-tabs-actions">
          <button class="desktop-tab-action" onclick="resetLine()">
            ↺ Cambia linea
          </button>
        </div>
      </div>

      <!-- Step 1: Selezione Linea -->
      <div class="step-content active" data-step="1">
        <h1 class="step-title">Scegli la tua linea</h1>
        <p class="step-subtitle">Seleziona una linea per visualizzare le fermate</p>

        <button class="selection-button" onclick="selectLine('400', event)" id="line-400-btn">
          <div class="line-icon-badge">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="0.8"
              stroke-linecap="round"
              stroke-linejoin="round"
              width="24"
              height="24"
            >
              <rect x="6" y="5" width="12" height="14" rx="2" />
              <line x1="6" y1="9" x2="18" y2="9" />
              <line x1="6" y1="14" x2="18" y2="14" />
              <line x1="8" y1="17" x2="9" y2="17" />
              <line x1="15" y1="17" x2="16" y2="17" />
              <path d="M6 8c-2 0 -3 1 -3 3v2" />
              <path d="M18 8c2 0 3 1 3 3v2" />
              <path d="M8 19v1a1.5 1.5 0 0 0 3 0v-1" />
              <path d="M13 19v1a1.5 1.5 0 0 0 3 0v-1" />
            </svg>
            <span class="line-number">400</span>
          </div>
          <div class="line-info">
            <span class="line-name">Udine-Grado</span>
            <span class="line-stops-badge">
              <span class="stops-count">42 fermate</span>
            </span>
          </div>
          <span class="arrow">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              width="20"
              height="20"
            >
              <path d="M5 12h14" />
              <path d="M12 5l7 7-7 7" />
            </svg>
          </span>
        </button>

        <button class="selection-button" onclick="selectLine('401', event)" id="line-401-btn">
          <div class="line-icon-badge">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="0.8"
              stroke-linecap="round"
              stroke-linejoin="round"
              width="24"
              height="24"
            >
              <rect x="6" y="5" width="12" height="14" rx="2" />
              <line x1="6" y1="9" x2="18" y2="9" />
              <line x1="6" y1="14" x2="18" y2="14" />
              <line x1="8" y1="17" x2="9" y2="17" />
              <line x1="15" y1="17" x2="16" y2="17" />
              <path d="M6 8c-2 0 -3 1 -3 3v2" />
              <path d="M18 8c2 0 3 1 3 3v2" />
              <path d="M8 19v1a1.5 1.5 0 0 0 3 0v-1" />
              <path d="M13 19v1a1.5 1.5 0 0 0 3 0v-1" />
            </svg>
            <span class="line-number">401</span>
          </div>
          <div class="line-info">
            <span class="line-name">Udine-San Daniele</span>
            <span class="line-stops-badge">
              <span class="stops-count">35 fermate</span>
            </span>
          </div>
          <span class="arrow">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              width="20"
              height="20"
            >
              <path d="M5 12h14" />
              <path d="M12 5l7 7-7 7" />
            </svg>
          </span>
        </button>
      </div>

      <!-- Step 2: Mappa e Fermate -->
      <div class="step-content" data-step="2">
        <h1 class="step-title">Fermate e Mappa</h1>
        <p class="step-subtitle" id="line-subtitle">Visualizza fermate e percorso</p>

        <!-- Mappa -->
        <div class="map-section">
          <div class="map-container-wrapper">
            <div class="map-container">
              <div class="map-placeholder">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round"
                  style="margin-bottom: 0.5rem;">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg><br />
                Mappa interattiva<br />
                <small style="opacity: 0.7">Visualizzazione fermate e percorso</small>
              </div>
            </div>
          </div>
          <div class="map-controls">
            <button class="map-control-btn" onclick="centerMap()">
              <span><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg></span>
              <span>Centra</span>
            </button>
            <button class="map-control-btn" onclick="useLocation()">
              <span><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg></span>
              <span>La mia posizione</span>
            </button>
            <button class="map-control-btn" onclick="toggleStopsList()">
              <span><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="6" y="5" width="12" height="14" rx="2" />
                  <line x1="6" y1="9" x2="18" y2="9" />
                  <line x1="6" y1="14" x2="18" y2="14" />
                  <line x1="8" y1="17" x2="9" y2="17" />
                  <line x1="15" y1="17" x2="16" y2="17" />
                  <path d="M6 8c-2 0 -3 1 -3 3v2" />
                  <path d="M18 8c2 0 3 1 3 3v2" />
                  <path d="M8 19v1a1.5 1.5 0 0 0 3 0v-1" />
                  <path d="M13 19v1a1.5 1.5 0 0 0 3 0v-1" />
                </svg></span>
              <span>Fermate</span>
            </button>
            <button class="map-control-btn" onclick="changeMapSize()">
              <span><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="0.8" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="3"></circle>
                  <path
                    d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                  </path>
                </svg></span>
              <span>Dimensioni</span>
            </button>
          </div>
        </div>

        <!-- Lista Fermate -->
        <div class="stops-section">
          <h2 class="stops-title">Fermate</h2>
          <ul class="stops-list" id="stops-list">
            <!-- Fermate verranno aggiunte dinamicamente -->
          </ul>
        </div>

        <button class="reset-button" onclick="resetLine()">
          ↺ Cambia linea
        </button>
      </div>
    </div>
  </div>

  <script>
    let currentStep = 1;
    let selectedLine = null;

    function updateStepIndicator(step) {
      // Aggiorna la progress bar (mobile/tablet)
      const navButtons = document.querySelectorAll(".step-nav-button");
      navButtons.forEach((button, index) => {
        const buttonStep = index + 1;
        button.classList.remove("active", "completed");

        if (buttonStep < step) {
          button.classList.add("completed");
        } else if (buttonStep === step) {
          button.classList.add("active");
        }
      });

      // Aggiorna tab desktop
      const desktopTabs = document.querySelectorAll(".desktop-tab");
      desktopTabs.forEach((tab) => {
        const target = Number(tab.dataset.stepTarget);
        if (target === step) {
          tab.classList.add("active");
          tab.setAttribute("aria-current", "step");
        } else {
          tab.classList.remove("active");
          tab.removeAttribute("aria-current");
        }
      });

      // Mostra/nascondi azioni desktop tabs
      const desktopTabsActions = document.querySelector(
        ".desktop-tabs-actions"
      );
      if (desktopTabsActions) {
        if (step >= 2) {
          desktopTabsActions.classList.add("show");
        } else {
          desktopTabsActions.classList.remove("show");
        }
      }
    }

    function handleStepNavClick(targetStep) {
      // Verifica se lo step è accessibile
      if (targetStep === 1) {
        // Sempre accessibile
        goToStep(1);
      } else if (targetStep === 2 && selectedLine) {
        // Step 2 accessibile solo se la linea è stata selezionata
        goToStep(2);
      }
    }

    function goToStep(step) {
      console.log("goToStep chiamata:", { from: currentStep, to: step });

      // Verifica che lo step esista
      const newStep = document.querySelector(`.step-content[data-step="${step}"]`);
      if (!newStep) {
        console.error(`Step ${step} non trovato nel DOM`);
        return;
      }

      // Nascondi step corrente
      const currentStepEl = document.querySelector(
        `.step-content[data-step="${currentStep}"]`
      );
      if (currentStepEl) {
        currentStepEl.classList.remove("active");
        console.log("Step corrente nascosto:", currentStep);
      }

      // Aggiorna currentStep
      currentStep = step;

      // Mostra nuovo step
      newStep.classList.add("active");
      console.log("Nuovo step mostrato:", step);

      // Aggiorna indicator
      updateStepIndicator(step);

      // Animazione
      newStep.style.animation = "none";
      setTimeout(() => {
        newStep.style.animation = "fadeInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1)";
      }, 10);
    }

    function selectLine(lineId, event) {
      selectedLine = lineId;

      // Aggiorna indicatore linea selezionata nel desktop tab
      updateSelectedLineaIndicator();

      // Aggiorna pulsante "Cambia linea"
      updateChangeLineButton();

      // Simula animazione del pulsante
      const button = event ? event.currentTarget : event.target;
      if (button) {
        button.style.transform = "scale(0.95)";
        setTimeout(() => {
          button.style.transform = "";
          goToStep(2);
        }, 200);
      } else {
        goToStep(2);
      }

      // Carica fermate
      loadStops(lineId);

      // Aggiorna sottotitolo
      const lineNames = {
        400: "Linea 400 Udine-Grado",
        401: "Linea 401 Udine-San Daniele",
      };
      const subtitle = document.getElementById("line-subtitle");
      if (subtitle) {
        subtitle.textContent = lineNames[lineId] || "Visualizza fermate e percorso";
      }
    }

    function loadStops(lineId) {
      const stopsList = document.getElementById("stops-list");
      stopsList.innerHTML = "";

      // Fermate simulate
      const stops = {
        400: [
          { name: "Udine", info: "Stazione centrale" },
          { name: "Palmanova", info: "Piazza Grande" },
          { name: "Cervignano FS", info: "Stazione ferroviaria" },
          { name: "Grado", info: "Centro città" },
          { name: "Aquileia", info: "Via Roma" },
          { name: "Monfalcone", info: "Stazione" },
        ],
        401: [
          { name: "Udine", info: "Stazione centrale" },
          { name: "San Daniele", info: "Piazza del Duomo" },
          { name: "Fagagna", info: "Via Nazionale" },
          { name: "Majano", info: "Centro" },
        ],
      };

      const lineStops = stops[lineId] || [];

      lineStops.forEach((stop) => {
        const li = document.createElement("li");
        li.className = "stop-item";
        li.innerHTML = `
            <div class="stop-name">${stop.name}</div>
            <div class="stop-info">${stop.info}</div>
          `;
        stopsList.appendChild(li);
      });
    }

    function centerMap() {
      console.log("Centra mappa");
      alert("Funzionalità mappa: Centra su tutte le fermate");
    }

    function useLocation() {
      console.log("Usa posizione");
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            alert(
              `Posizione: ${position.coords.latitude}, ${position.coords.longitude}`
            );
          },
          (error) => {
            alert("Impossibile ottenere la posizione");
          }
        );
      } else {
        alert("Geolocalizzazione non supportata");
      }
    }

    function toggleStopsList() {
      const stopsSection = document.getElementById("stops-section");
      if (stopsSection) {
        stopsSection.style.display =
          stopsSection.style.display === "none" ? "block" : "none";
      }
    }

    function changeMapSize() {
      alert("Funzionalità: Cambia dimensione mappa");
    }

    function updateSelectedLineaIndicator() {
      // Indicatore nel tab
      const tabIndicator = document.getElementById(
        "selected-linea-tab-indicator"
      );

      if (selectedLine && tabIndicator) {
        // Estrai il nome della linea dal pulsante
        const button = document.getElementById(`line-${selectedLine}-btn`);
        if (button) {
          // Cerca il nome nella struttura line-info > line-name
          const lineNameElement = button.querySelector(".line-name");
          if (lineNameElement) {
            tabIndicator.textContent = lineNameElement.textContent;
            tabIndicator.style.display = "block";
          } else {
            // Fallback: prova a estrarre da span se la struttura è diversa
            const nome = button.querySelector("span")?.textContent;
            if (nome) {
              const match = nome.match(/Linea \d+\s+(.+)/);
              const displayText = match ? match[1] : nome;
              tabIndicator.textContent = displayText;
              tabIndicator.style.display = "block";
            }
          }
        }
      } else if (tabIndicator) {
        tabIndicator.textContent = "";
        tabIndicator.style.display = "none";
      }
    }

    function updateChangeLineButton() {
      // Mantieni solo "Cambia linea" senza nome della linea
      const changeLineButtons = document.querySelectorAll('.desktop-tab-action, .reset-button');
      changeLineButtons.forEach(btn => {
        if (btn.textContent.includes("Cambia linea")) {
          btn.textContent = "↺ Cambia linea";
        }
      });
    }

    function resetLine() {
      console.log("resetLine chiamata");
      selectedLine = null;

      // Aggiorna indicatore linea selezionata
      updateSelectedLineaIndicator();

      // Aggiorna pulsante "Cambia linea"
      updateChangeLineButton();

      // Reset lista fermate
      const stopsList = document.getElementById("stops-list");
      if (stopsList) {
        stopsList.innerHTML = "";
      }

      // Reset sottotitolo
      const subtitle = document.getElementById("line-subtitle");
      if (subtitle) {
        subtitle.textContent = "Visualizza fermate e percorso";
      }

      // Torna allo step 1
      goToStep(1);
    }

    function toggleTheme() {
      document.body.classList.toggle("light");
      const theme = document.body.classList.contains("light")
        ? "light"
        : "dark";
      localStorage.setItem("theme", theme);
    }

    function toggleMobileMenu() {
      const overlay = document.getElementById("mobile-menu-overlay");
      const menu = document.getElementById("mobile-menu");
      const hamburger = document.getElementById("hamburger-toggle");

      const isOpen = menu.classList.contains("active");

      if (isOpen) {
    menu.classList.remove("active");
    menu.classList.add("closing");
    setTimeout(() => {
      menu.classList.remove("closing");
      overlay.classList.remove("active");
    }, 250);
        if (hamburger) {
          hamburger.classList.remove("active");
          hamburger.blur();
        }
      } else {
        overlay.classList.add("active");
        setTimeout(() => {
          menu.classList.add("active");
      menu.classList.remove("closing");
        }, 10);
        if (hamburger) {
          hamburger.classList.add("active");
          setTimeout(() => {
            hamburger.blur();
          }, 100);
        }
      }
    }

    // Previeni la chiusura quando si clicca sul menu stesso
    const menu = document.getElementById("mobile-menu");
    if (menu) {
      menu.addEventListener("click", (e) => {
        e.stopPropagation();
      });
    }

    // Chiudi menu quando si clicca sull'overlay
    const overlay = document.getElementById("mobile-menu-overlay");
    if (overlay) {
      overlay.onclick = null; // Rimuovi l'onclick dall'HTML
      overlay.addEventListener("click", (e) => {
        e.stopPropagation();
        const menu = document.getElementById("mobile-menu");
        if (menu && menu.classList.contains("active")) {
          toggleMobileMenu();
        }
      });
    }

    // Chiudi menu quando si clicca fuori (su document) - solo se il menu è aperto
    document.addEventListener("click", (e) => {
      const menu = document.getElementById("mobile-menu");
      const hamburger = document.getElementById("hamburger-toggle");
      const overlay = document.getElementById("mobile-menu-overlay");

      if (
        menu &&
        menu.classList.contains("active") &&
        !menu.contains(e.target) &&
        hamburger &&
        !hamburger.contains(e.target) &&
        overlay &&
        !overlay.contains(e.target)
      ) {
        toggleMobileMenu();
      }
    });

    // Carica tema salvato
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme === "light") {
      document.body.classList.add("light");
    }

    // Inizializza
    updateStepIndicator(1);
  </script>
</body>

</html>