<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>TPL FVG - Test Funzionalit√†</title>
    <script src="js/utils/css-preset-loader.js"></script>
    <style>
      /* Scroll normalization per test.html */
      html, body {
        overflow-y: auto;
        height: auto;
        touch-action: auto;
      }
      
      /* Navbar sticky */
      .navbar {
        position: sticky !important;
        top: 0 !important;
        z-index: 1000 !important;
      }
      
      /* Mobile scroll optimization */
      body {
        min-height: 100vh;
        -webkit-overflow-scrolling: touch;
      }
    </style>
    <script>
      // Fix scroll bloccato su test.html - SICURO
      function forceUnblockScroll() {
        // Controlla che gli elementi esistano
        if (document.body) {
          document.body.style.overflow = '';
          document.body.style.height = '';
          document.body.style.position = '';
          document.body.style.touchAction = 'auto';
        }
        if (document.documentElement) {
          document.documentElement.style.overflow = '';
          document.documentElement.style.height = '';
          document.documentElement.style.position = '';
        }
        // Debug rimosso per sicurezza
      }
      
      // Esegui al DOMContentLoaded (quando body esiste)
      document.addEventListener('DOMContentLoaded', forceUnblockScroll);
      
      // Esegui dopo 1 secondo per sicurezza
      setTimeout(forceUnblockScroll, 1000);
      
      // Esponi globalmente per debug
      window.forceUnblockScroll = forceUnblockScroll;
      
      // DIAGNOSI COMPLETA SCROLL
      window.diagnoseScroll = function() {
        console.log('üîç DIAGNOSI SCROLL:', {
          body: {
            overflow: getComputedStyle(document.body).overflow,
            overflowX: getComputedStyle(document.body).overflowX,
            overflowY: getComputedStyle(document.body).overflowY,
            height: getComputedStyle(document.body).height,
            maxHeight: getComputedStyle(document.body).maxHeight,
            position: getComputedStyle(document.body).position,
            touchAction: getComputedStyle(document.body).touchAction
          },
          html: {
            overflow: getComputedStyle(document.documentElement).overflow,
            overflowX: getComputedStyle(document.documentElement).overflowX,
            overflowY: getComputedStyle(document.documentElement).overflowY,
            height: getComputedStyle(document.documentElement).height,
            maxHeight: getComputedStyle(document.documentElement).maxHeight
          },
          viewport: {
            innerHeight: window.innerHeight,
            outerHeight: window.outerHeight,
            scrollHeight: document.body.scrollHeight,
            clientHeight: document.body.clientHeight
          },
          scroll: {
            scrollTop: document.documentElement.scrollTop || document.body.scrollTop,
            scrollY: window.scrollY,
            canScroll: document.body.scrollHeight > window.innerHeight
          }
        });
      };
      
      // Diagnosi disabilitata in produzione
      // Decommentare solo per debug
      // setTimeout(() => {
      //   if (window.diagnoseScroll) window.diagnoseScroll();
      // }, 2000);
    </script>
    <!-- Animazioni e transizioni globali -->
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/components/footer.css">
    <link rel="stylesheet" href="css/components/modals.css">
    <!-- Test Modules (sticky headers, groups, animations) -->
    <link rel="stylesheet" href="css/components/tests/header.css">
    <link rel="stylesheet" href="css/components/tests/groups.css">
    <link rel="stylesheet" href="css/components/tests/test-animations.css">
    <!-- Test Modules (base styles, status, effects) -->
    <link rel="stylesheet" href="css/components/tests/test-base.css">
    <link rel="stylesheet" href="css/components/tests/test-status.css">
    <link rel="stylesheet" href="css/components/tests/test-effects.css">
    <!-- Mega Dropdown Settings (componente condiviso, solo desktop) -->
    <link rel="stylesheet" href="css/components/mega-dropdown-settings.css">
    <!-- Test Page Specific (distance, leaflet) -->
    <link rel="stylesheet" href="css/components/tests/test-page-specific.css">
    <!-- Test Device Info (device info cards) -->
    <link rel="stylesheet" href="css/components/tests/test-device-info.css">
    <!-- Test Prezzi Adaptive (tipografia adattiva) -->
    <link rel="stylesheet" href="css/components/tests/test-prezzi-adaptive.css">
    <!-- TOC Sidebar (indice rapido desktop) -->
    <link rel="stylesheet" href="css/components/tests/toc-sidebar.css">
    <!-- Settings (struttura modale) -->
    <link rel="stylesheet" href="css/components/settings/impostazioni.css">
    <link rel="stylesheet" href="css/components/settings/accessibilita.css">
    <link rel="stylesheet" href="css/components/settings/aspetto.css">
    <link rel="stylesheet" href="css/components/settings/info.css">
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="icon" href="src/tpl.jpg" type="image/jpeg">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>

<body class="bg-background-light text-foreground-light">

    <!-- Navbar -->
    <header class="navbar">
        <div class="container">
            <div class="navbar-content">
                <a href="index.html" class="navbar-brand-link">
                    <div class="navbar-brand">
                        <div class="navbar-logo-wrapper">
                            <img src="src/logo.png" alt="TPL" class="navbar-logo navbar-logo-default" />
                            <img src="src/logo1.png" alt="TPL" class="navbar-logo navbar-logo-hover" />
                        </div>
                        <div class="navbar-title">
                            <div class="logo-acronym">
                                <div>tpl</div>
                                <div>fvg</div>
                            </div>
                            <div class="logo-text">
                                <div>trasporto</div>
                                <div>pubblico</div>
                                <div>locale</div>
                            </div>
                        </div>
                    </div>
                </a>
                <!-- Hamburger button (mobile only) -->
                <button id="hamburger-toggle" class="hamburger-toggle" aria-label="Menu">
                    <span class="hamburger-icon"></span>
                </button>

                <nav class="navbar-nav">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="fermate.html" class="nav-link">Fermate</a>
                    <a href="prezzi.html" class="nav-link">Prezzi</a>
                    <a href="test.html" class="nav-link active">Test</a>

                    <!-- Mega Dropdown Impostazioni (Opzione C) -->
                    <div class="settings-dropdown-container">
                        <button id="settings-dropdown-btn" class="nav-settings-dropdown-btn" title="Impostazioni">
                            <span class="settings-icon">‚öôÔ∏è</span>
                            <span class="settings-text">Impostazioni</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </button>

                        <div id="settings-dropdown" class="settings-mega-dropdown">
                            <!-- Sezione Aspetto -->
                            <div class="dropdown-section">
                                <h4 class="dropdown-section-title">üëÅÔ∏è Aspetto</h4>

                                <div class="dropdown-item">
                                    <span class="dropdown-label">üåì Tema</span>
                                    <div class="dropdown-theme-options">
                                        <label class="theme-radio">
                                            <input type="radio" name="theme-radio" value="system" checked>
                                            <span>‚öôÔ∏è Sistema</span>
                                        </label>
                                        <label class="theme-radio">
                                            <input type="radio" name="theme-radio" value="light">
                                            <span>‚òÄÔ∏è Chiaro</span>
                                        </label>
                                        <label class="theme-radio">
                                            <input type="radio" name="theme-radio" value="dark">
                                            <span>üåô Scuro</span>
                                        </label>
                                    </div>
                                </div>

                                <div class="dropdown-item">
                                    <label class="dropdown-label" for="dropdown-animation-toggle">üé¨ Animazione
                                        Sfondo</label>
                                    <label class="dropdown-toggle">
                                        <input type="checkbox" id="dropdown-animation-toggle"
                                            aria-label="Attiva/disattiva animazione sfondo">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- Sezione Accessibilit√† -->
                            <div class="dropdown-section">
                                <h4 class="dropdown-section-title">‚ôø Accessibilit√†</h4>

                                <div class="dropdown-item">
                                    <span class="dropdown-label">A Dimensione Testo</span>
                                    <div class="dropdown-font-buttons">
                                        <button class="dropdown-font-btn active" data-size="normal">A</button>
                                        <button class="dropdown-font-btn" data-size="large">A</button>
                                        <button class="dropdown-font-btn" data-size="xlarge">A</button>
                                    </div>
                                </div>

                                <div class="dropdown-item">
                                    <label class="dropdown-label" for="dropdown-high-contrast">üé® Alto Contrasto</label>
                                    <label class="dropdown-toggle">
                                        <input type="checkbox" id="dropdown-high-contrast"
                                            aria-label="Attiva/disattiva alto contrasto">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- Sezione Azioni Rapide -->
                            <div class="dropdown-section">
                                <h4 class="dropdown-section-title">‚ö° Azioni Rapide</h4>

                                <button class="dropdown-action-btn" id="dropdown-open-settings-modal">
                                    <span>‚öôÔ∏è</span>
                                    <span>Apri Impostazioni Complete</span>
                                </button>

                                <button class="dropdown-action-btn" id="dropdown-check-updates">
                                    <span>üîÑ</span>
                                    <span>Verifica Aggiornamenti</span>
                                </button>

                                <button class="dropdown-action-btn" id="dropdown-clear-cache">
                                    <span>üóëÔ∏è</span>
                                    <span>Cancella Cache</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- NOTE: Pulsanti legacy rimossi - ora si usano direttamente le API pubbliche (Settings, Updates) -->
                </nav>
            </div>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu">
        <div class="mobile-menu-header">
            <span class="mobile-menu-title">Menu</span>
            <button id="mobile-menu-close" class="mobile-menu-close" aria-label="Chiudi menu">√ó</button>
        </div>
        <nav class="mobile-menu-nav">
            <a href="index.html" class="mobile-nav-link">
                <span class="mobile-nav-icon">üè†</span>
                <span>Home</span>
            </a>
            <a href="fermate.html" class="mobile-nav-link">
                <span class="mobile-nav-icon">üöè</span>
                <span>Fermate</span>
            </a>
            <a href="prezzi.html" class="mobile-nav-link">
                <span class="mobile-nav-icon">üí∞</span>
                <span>Prezzi</span>
            </a>
            <a href="test.html" class="mobile-nav-link active">
                <span class="mobile-nav-icon">üß™</span>
                <span>Test</span>
            </a>
            <button id="open-settings" class="mobile-nav-link">
                <span class="mobile-nav-icon">‚öôÔ∏è</span>
                <span>Impostazioni</span>
            </button>
        </nav>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay"></div>

    <!-- Sidebar Indice Rapido (Desktop) -->
    <aside id="toc-sidebar" class="toc-sidebar">
        <div class="toc-sidebar-header">
            <h3>üß≠ Indice</h3>
        </div>
        <nav class="toc-sidebar-nav">
            <a href="#section-stats" class="toc-sidebar-link" data-section="section-stats">
                <span class="toc-icon">üìä</span>
                <span class="toc-label">Statistiche</span>
            </a>
            <a href="#section-pwa" class="toc-sidebar-link" data-section="section-pwa">
                <span class="toc-icon">üì±</span>
                <span class="toc-label">Modalit√† PWA</span>
            </a>
            <a href="#section-quick-links" class="toc-sidebar-link" data-section="section-quick-links">
                <span class="toc-icon">üîó</span>
                <span class="toc-label">Link Rapidi</span>
            </a>
            <a href="#section-connectivity" class="toc-sidebar-link" data-section="section-connectivity">
                <span class="toc-icon">üåê</span>
                <span class="toc-label">Connettivit√†</span>
            </a>
            <a href="#section-device" class="toc-sidebar-link" data-section="section-device">
                <span class="toc-icon">üì±</span>
                <span class="toc-label">Device & Browser</span>
            </a>
            <a href="#section-geolocation" class="toc-sidebar-link" data-section="section-geolocation">
                <span class="toc-icon">üìç</span>
                <span class="toc-label">Geolocalizzazione</span>
            </a>
            <a href="#section-database" class="toc-sidebar-link toc-completed" data-section="section-database" data-color="blue">
                <span class="toc-icon">üì¶</span>
                <span class="toc-label">Database</span>
            </a>
            <a href="#section-darkmode" class="toc-sidebar-link" data-section="section-darkmode">
                <span class="toc-icon">üåô</span>
                <span class="toc-label">Dark Mode</span>
            </a>
            <a href="#section-storage" class="toc-sidebar-link toc-completed" data-section="section-storage" data-color="green">
                <span class="toc-icon">üíæ</span>
                <span class="toc-label">Storage Module</span>
            </a>
            <a href="#section-prezzi" class="toc-sidebar-link toc-completed" data-section="section-prezzi" data-color="yellow">
                <span class="toc-icon">üí∞</span>
                <span class="toc-label">Prezzi</span>
            </a>
            <a href="#section-route" class="toc-sidebar-link toc-completed" data-section="section-route" data-color="blue">
                <span class="toc-icon">üß≠</span>
                <span class="toc-label">Route Selector</span>
            </a>
            <a href="#section-settings" class="toc-sidebar-link toc-completed" data-section="section-settings" data-color="orange">
                <span class="toc-icon">‚öôÔ∏è</span>
                <span class="toc-label">Settings</span>
            </a>
            <a href="#section-sw" class="toc-sidebar-link" data-section="section-sw">
                <span class="toc-icon">‚öôÔ∏è</span>
                <span class="toc-label">Service Worker</span>
            </a>
            <a href="#section-ui" class="toc-sidebar-link" data-section="section-ui">
                <span class="toc-icon">üé®</span>
                <span class="toc-label">UI</span>
            </a>
            <a href="#section-manifest" class="toc-sidebar-link" data-section="section-manifest">
                <span class="toc-icon">üì±</span>
                <span class="toc-label">Manifest</span>
            </a>
            <a href="#section-pwa-install" class="toc-sidebar-link" data-section="section-pwa-install">
                <span class="toc-icon">üì≤</span>
                <span class="toc-label">PWA Install</span>
            </a>
            <a href="#section-performance" class="toc-sidebar-link" data-section="section-performance">
                <span class="toc-icon">‚ö°</span>
                <span class="toc-label">Performance</span>
            </a>
        </nav>
    </aside>

    <div class="test-container test-container-with-sidebar">

        <!-- Indice Rapido (Mobile) -->
        <div id="section-index" class="test-section">
            <h2>üß≠ Indice rapido</h2>
            <div class="toc-grid">
                <a href="#section-stats" class="toc-link" data-section="section-stats" data-label="üìä Statistiche">üìä
                    Statistiche</a>
                <a href="#section-pwa" class="toc-link" data-section="section-pwa" data-label="üì± Modalit√† PWA">üì±
                    Modalit√† PWA</a>
                <a href="#section-quick-links" class="toc-link" data-section="section-quick-links"
                    data-label="üîó Link Rapidi">üîó
                    Link Rapidi</a>
                <a href="#section-connectivity" class="toc-link" data-section="section-connectivity"
                    data-label="üåê Connettivit√†">üåê
                    Connettivit√†</a>
                <a href="#section-device" class="toc-link" data-section="section-device"
                    data-label="üì± Device & Browser">üì±
                    Device & Browser</a>
                <a href="#section-geolocation" class="toc-link" data-section="section-geolocation"
                    data-label="üìç Geolocalizzazione">üìç
                    Geolocalizzazione</a>
                <a href="#section-database" class="toc-link" data-section="section-database" data-label="üì¶ Database">üì¶
                    Database</a>
                <a href="#section-darkmode" class="toc-link" data-section="section-darkmode" data-label="üåô Dark Mode">üåô
                    Dark Mode</a>
                <a href="#section-storage" class="toc-link" data-section="section-storage" data-label="üíæ Storage Module">üíæ
                    Storage Module</a>
                <a href="#section-prezzi" class="toc-link" data-section="section-prezzi" data-label="üí∞ Prezzi">üí∞
                    Prezzi</a>
                <a href="#section-route" class="toc-link" data-section="section-route" data-label="üß≠ Route Selector">üß≠
                    Route Selector</a>
                <a href="#section-settings" class="toc-link" data-section="section-settings" data-label="‚öôÔ∏è Settings">‚öôÔ∏è
                    Settings</a>
                <a href="#section-sw" class="toc-link" data-section="section-sw" data-label="‚öôÔ∏è Service Worker">‚öôÔ∏è
                    Service Worker</a>
                <a href="#section-ui" class="toc-link" data-section="section-ui" data-label="üé® UI">üé®
                    UI</a>
                <a href="#section-manifest" class="toc-link" data-section="section-manifest" data-label="üì± Manifest">üì±
                    Manifest</a>
                <a href="#section-pwa-install" class="toc-link" data-section="section-pwa-install" data-label="üì≤ PWA Install">üì≤
                    PWA Install</a>
                <a href="#section-performance" class="toc-link" data-section="section-performance"
                    data-label="‚ö° Performance">‚ö°
                    Performance</a>
            </div>
        </div>

        <!-- Statistiche -->
        <div id="section-stats" class="test-section">
            <h2>üìä Statistiche Test</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="stat-total">0</div>
                    <div class="stat-label">Totali</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-pass">0</div>
                    <div class="stat-label">Passati</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-fail">0</div>
                    <div class="stat-label">Falliti</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-pending">0</div>
                    <div class="stat-label">In attesa</div>
                </div>
            </div>
            <button class="run-all-btn" data-test="run-all">‚ñ∂Ô∏è Esegui tutti i test</button>
        </div>

        <!-- Test Modalit√† PWA -->
        <div id="section-pwa" class="test-section">
            <h2>üì± Test Modalit√† PWA</h2>
            <div class="test-item">
                <div>
                    <strong>Simulazione Bottom Navigation</strong>
                    <br>
                    <small>Attiva/disattiva la bottom navigation senza installare la PWA</small>
                </div>
                <div>
                    <button id="toggle-pwa-mode" class="test-btn">
                        <span id="pwa-mode-icon">üì±</span>
                        <span id="pwa-mode-text">Attiva Modalit√† PWA</span>
                    </button>
                </div>
            </div>
            <div id="pwa-mode-status">
                <h4>Status Modalit√† PWA:</h4>
                <div id="pwa-mode-info"></div>
            </div>
        </div>

        <!-- Link Rapidi -->
        <div id="section-quick-links" class="test-section">
            <h2>üîó Link Rapidi</h2>
            <div class="test-item">
                <div>
                    <strong>Pagina Benvenuto</strong>
                    <br>
                    <small>Vai alla pagina di benvenuto dell'app</small>
                </div>
                <div>
                    <a href="benvenuto.html" class="test-btn">
                        <span>üëã</span>
                        <span>Vai a Benvenuto</span>
                    </a>
                </div>
            </div>
            <div class="test-item">
                <div>
                    <strong>Simula Errore 404</strong>
                    <br>
                    <small>Reindirizza alla pagina di errore 404 per test</small>
                </div>
                <div>
                    <button class="test-btn" data-simulate-404="true" title="Simula errore 404">
                        <span>üî¥</span>
                        <span>Simula 404</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Test Connettivit√† -->
        <div id="section-connectivity" class="test-section">
            <h2>üåê Test Connettivit√†</h2>
            <div class="test-item">
                <div>
                    <strong>Simulazione Modalit√† Offline</strong>
                    <br>
                    <small>Simula la perdita di connessione per testare il banner offline</small>
                </div>
                <div>
                    <button id="toggle-offline-mode" class="test-btn">
                        <span id="offline-mode-icon">üì∂</span>
                        <span id="offline-mode-text">Simula Offline</span>
                    </button>
                </div>
            </div>
            <div id="offline-mode-status">
                <h4>Status Connettivit√†:</h4>
                <div id="offline-mode-info"></div>
            </div>
        </div>

        <!-- Info Device/Browser -->
        <div id="section-device" class="test-section">
            <h2>üì± Info Device & Browser</h2>
            <p style="color: #666; margin-bottom: 1.5rem;">Informazioni sul dispositivo e ambiente di esecuzione per
                debug</p>

            <!-- Grid Cards (Desktop) / Lista Compatta (Mobile) -->
            <div id="device-info-container">
                <!-- Device Type -->
                <div class="device-info-card" data-color="purple">
                    <div class="device-info-icon">üì±</div>
                    <div class="device-info-content">
                        <div class="device-info-label">Device Type</div>
                        <div id="device-type" class="device-info-value">Rilevamento...</div>
                    </div>
                </div>

                <!-- OS -->
                <div class="device-info-card" data-color="pink">
                    <div class="device-info-icon">üíª</div>
                    <div class="device-info-content">
                        <div class="device-info-label">Sistema Operativo</div>
                        <div id="device-os" class="device-info-value">Rilevamento...</div>
                    </div>
                </div>

                <!-- Browser -->
                <div class="device-info-card" data-color="blue">
                    <div class="device-info-icon">üåê</div>
                    <div class="device-info-content">
                        <div class="device-info-label">Browser</div>
                        <div id="device-browser" class="device-info-value">Rilevamento...</div>
                    </div>
                </div>

                <!-- Battery -->
                <div class="device-info-card" data-color="orange">
                    <div class="device-info-icon">üîã</div>
                    <div class="device-info-content">
                        <div class="device-info-label">Batteria</div>
                        <div id="device-battery" class="device-info-value">Rilevamento...</div>
                    </div>
                </div>

                <!-- GPS Support -->
                <div class="device-info-card" data-color="amber">
                    <div class="device-info-icon">üõ∞Ô∏è</div>
                    <div class="device-info-content">
                        <div class="device-info-label">Supporto GPS</div>
                        <div id="device-gps" class="device-info-value">Rilevamento...</div>
                    </div>
                </div>

                <!-- Touch Support -->
                <div class="device-info-card" data-color="cyan">
                    <div class="device-info-icon">üëÜ</div>
                    <div class="device-info-content">
                        <div class="device-info-label">Touch Support</div>
                        <div id="device-touch" class="device-info-value">Rilevamento...</div>
                    </div>
                </div>

                <!-- PWA Mode -->
                <div class="device-info-card" data-color="indigo">
                    <div class="device-info-icon">üì≤</div>
                    <div class="device-info-content">
                        <div class="device-info-label">PWA Mode</div>
                        <div id="device-pwa" class="device-info-value">Rilevamento...</div>
                    </div>
                </div>

                <!-- Stato Connessione -->
                <div class="device-info-card" data-color="green">
                    <div>
                        <div>
                            <div class="device-info-icon">
                                <span id="connection-status-icon">üü¢</span>
                            </div>
                            <div class="device-info-content">
                                <div class="device-info-label">Stato Connessione</div>
                                <div id="connection-status-text" class="device-info-value">Rilevamento...</div>
                                <div id="connection-test-date">-</div>
                            </div>
                        </div>
                        <div>
                            <button id="check-connection-btn" class="test-btn" title="Verifica stato connessione">
                                <span>üîÑ</span>
                                <span>Verifica</span>
                            </button>
                            <button id="reset-connection-btn" class="test-btn" title="Reset risultati" disabled>
                                <span>üóëÔ∏è</span>
                                <span>Reset</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Test Rilevamento Display -->
            <div>
                <h3>üñ•Ô∏è Rilevamento Display</h3>

                <div>

                    <!-- Card Tipo Display -->
                    <div class="display-info-card">
                        <div>
                            <div>üì±</div>
                            <div>
                                <div>Tipo Display</div>
                                <div id="test-display-type">Rilevamento...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Card Device Pixel Ratio -->
                    <div class="display-info-card">
                        <div>
                            <div>üîç</div>
                            <div>
                                <div>Device Pixel Ratio</div>
                                <div id="test-display-dpr">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- Card Risoluzione Logica -->
                    <div class="display-info-card">
                        <div>
                            <div>üìê</div>
                            <div>
                                <div>Risoluzione Logica</div>
                                <div id="test-display-logical">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- Card Risoluzione Fisica -->
                    <div class="display-info-card">
                        <div>
                            <div>üñºÔ∏è</div>
                            <div>
                                <div>Risoluzione Fisica</div>
                                <div id="test-display-physical">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- Card High DPI -->
                    <div class="display-info-card">
                        <div>
                            <div>‚ú®</div>
                            <div>
                                <div>High DPI</div>
                                <div id="test-display-highdpi">
                                    <span id="test-display-highdpi-badge">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card Viewport -->
                    <div class="display-info-card">
                        <div>
                            <div>üìè</div>
                            <div>
                                <div>Viewport</div>
                                <div id="test-display-viewport">-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <button id="test-display-refresh" class="test-btn">
                        <span>üîÑ</span>
                        <span>Aggiorna Rilevamento</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Test Geolocalizzazione -->
        <div id="section-geolocation" class="test-section">
            <h2>üìç Test Geolocalizzazione</h2>

            <!-- Test Rapido One-Click -->
            <div>
                <div>
                    <div>
                        <h3>‚ö° Test Rapido GPS</h3>
                        <p>Verifica automatica di tutte le funzioni GPS con un click</p>
                    </div>
                    <button id="quick-gps-test-btn">
                        <span id="quick-test-icon">üöÄ</span>
                        <span id="quick-test-text">Avvia Test</span>
                    </button>
                </div>

                <!-- Risultati Test Rapido (nascosto inizialmente) -->
                <div id="quick-test-results">
                    <h4>üìä Risultati Test</h4>
                    <div id="quick-test-items"></div>
                    <div id="quick-test-summary"></div>
                </div>

                <!-- Export Report -->
                <div>
                    <button id="export-json-btn">üìÑ Export JSON</button>
                    <button id="export-txt-btn">üìù Export TXT</button>
                </div>

                <!-- Reset Tutto -->
                <div>
                    <div>
                        <div>
                            <strong>üîÑ Reset Dati GPS</strong>
                            <p>Cancella tutti i dati GPS salvati (fake position, test, ecc.)</p>
                        </div>
                        <button id="reset-gps-btn">üóëÔ∏è Reset</button>
                    </div>
                </div>
            </div>

            <!-- Modal Conferma Reset -->
            <div id="reset-modal-overlay">
                <div>
                    <div id="reset-modal">
                        <!-- Header -->
                        <div>
                            <div>
                                <div>‚ö†Ô∏è</div>
                                <div>
                                    <h3>Conferma Reset</h3>
                                    <p>Questa azione √® irreversibile</p>
                                </div>
                            </div>
                        </div>

                        <!-- Body -->
                        <div>
                            <p>
                                Stai per <strong>cancellare tutti i dati GPS</strong> salvati localmente:
                            </p>

                            <ul>
                                <li>üé≠ Posizione fake simulata</li>
                                <li>üåê Dati simulazione offline</li>
                                <li>üìú Cronologia test GPS</li>
                                <li>üíæ Tutte le impostazioni salvate</li>
                            </ul>

                            <div>
                                <strong>üí° Nota:</strong>
                                <p>
                                    La pagina si ricaricher√† automaticamente dopo il reset.
                                </p>
                            </div>
                        </div>

                        <!-- Footer -->
                        <div>
                            <button id="reset-modal-cancel">‚ùå Annulla</button>
                            <button id="reset-modal-confirm">üóëÔ∏è Conferma Reset</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Permessi -->
            <div id="geo-permission-status">
                <strong>üîê Status Permessi:</strong>
                <span id="geo-permission-text">Verifica in corso...</span>
            </div>

            <!-- Banner HTTPS Warning (solo se non HTTPS/localhost) -->
            <div id="https-warning-banner">
                <div>
                    <div>‚ö†Ô∏è</div>
                    <div>
                        <strong>Attenzione: Geolocalizzazione richiede HTTPS</strong>
                        <p>
                            La geolocalizzazione funziona solo su connessioni sicure (HTTPS) o localhost.
                            <br>
                            <strong>Soluzione:</strong> Assicurati di accedere al sito tramite <code>https://</code>
                        </p>
                    </div>
                </div>
            </div>

            <div class="test-item">
                <div>
                    <strong>Rilevamento Posizione GPS</strong>
                    <span>üü¢ OFFLINE OK</span>
                    <br>
                    <small>Testa il rilevamento della posizione attuale per verificare la funzionalit√† GPS</small>
                </div>
                <div>
                    <button id="test-location-btn" class="test-btn">
                        <span id="test-location-icon">üìç</span>
                        <span id="test-location-text">Rileva Posizione</span>
                    </button>
                </div>
            </div>
            <div id="test-location-result" class="test-result">
                <h4>Risultato Rilevamento:</h4>
                <div id="test-location-info"></div>
            </div>

            <!-- Simulazione Posizione Fake -->
            <div id="fake-position-section">
                <div>
                    <div>
                        <h4>
                            üé≠ Simulazione Posizione
                            <span>üü¢ OFFLINE OK</span>
                        </h4>
                        <p>Usa coordinate fake per test senza GPS reale</p>
                    </div>
                    <label>
                        <input type="checkbox" id="use-fake-position">
                        <span>Attiva</span>
                    </label>
                </div>

                <!-- Contenuto collassabile -->
                <div id="fake-position-content">
                    <!-- Warning -->
                    <div>
                        <strong>‚ö†Ô∏è Modalit√† Test Attiva</strong>
                        <p>
                            Stai usando coordinate simulate. Il GPS reale √® disabilitato.
                        </p>
                    </div>

                    <!-- Preset Citt√† -->
                    <div>
                        <strong>üèôÔ∏è Preset Citt√† FVG:</strong>
                        <div>
                            <button class="fake-position-preset" data-lat="45.6495" data-lng="13.7768"
                                data-name="Trieste">Trieste</button>
                            <button class="fake-position-preset" data-lat="46.0710" data-lng="13.2345"
                                data-name="Udine">Udine</button>
                            <button class="fake-position-preset" data-lat="45.9632" data-lng="12.6603"
                                data-name="Pordenone">Pordenone</button>
                            <button class="fake-position-preset" data-lat="45.9405" data-lng="13.6222"
                                data-name="Gorizia">Gorizia</button>
                        </div>
                    </div>

                    <!-- Input Manuale -->
                    <div>
                        <strong>üìç Coordinate Personalizzate:</strong>
                        <div>
                            <input type="number" id="fake-lat" placeholder="Latitudine" step="0.000001">
                            <input type="number" id="fake-lng" placeholder="Longitudine" step="0.000001">
                        </div>
                        <div>
                            <input type="number" id="fake-accuracy" placeholder="Accuratezza (metri)" value="10" min="1" max="10000">
                            <input type="number" id="fake-altitude" placeholder="Altitudine (metri)" value="0">
                        </div>
                        <div>
                            <input type="number" id="fake-speed" placeholder="Velocit√† (km/h) [opzionale]" min="0" max="300" step="0.1">
                            <input type="number" id="fake-heading" placeholder="Direzione (0-360¬∞) [opzionale]" min="0" max="360" step="1">
                        </div>
                    </div>

                    <!-- Pulsante Applica -->
                    <button id="apply-fake-position">üéØ Applica Posizione Fake</button>

                    <!-- Info Posizione Corrente -->
                    <div id="fake-position-info">
                        <strong>üìç Posizione Fake Attiva:</strong>
                        <div id="fake-position-details"></div>
                    </div>
                </div>
            </div>

            <!-- Watch Position - Monitoraggio Continuo -->
            <div id="watch-position-section">
                <div>
                    <div>
                        <h4>
                            üß≠ Monitoraggio Continuo
                            <span>üü¢ OFFLINE OK</span>
                        </h4>
                        <p>Traccia la posizione GPS in tempo reale mentre ti muovi</p>
                    </div>
                    <button id="toggle-watch-btn">‚ñ∂Ô∏è Avvia</button>
                </div>

                <!-- Status Card -->
                <div id="watch-status-card"
                    style="display: none; padding: 1rem; background: white; border-radius: 10px; border-left: 4px solid #3b82f6; margin-bottom: 1rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <div style="flex: 1;">
                            <strong style="color: #1e40af; font-size: 1rem;">üì° Monitoraggio Attivo</strong>
                            <p style="margin: 0.25rem 0 0 0; color: #666; font-size: 0.85rem;">Ricevi aggiornamenti
                                automatici ogni volta che ti muovi</p>
                        </div>
                        <div style="text-align: center;">
                            <div id="watch-count"
                                style="font-size: 2rem; font-weight: 700; color: #3b82f6; line-height: 1;">0</div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 0.25rem;">aggiornamenti</div>
                        </div>
                    </div>

                    <!-- Ultima Posizione -->
                    <div id="watch-last-position"
                        style="padding: 0.75rem; background: #f8fafc; border-radius: 6px; font-size: 0.9rem;">
                        <strong style="color: #374151;">üìç Ultima Posizione:</strong>
                        <div id="watch-last-position-data" style="margin-top: 0.5rem; color: #666;">
                            In attesa primo aggiornamento...
                        </div>
                    </div>

                    <!-- Distanza Percorsa -->
                    <div id="watch-distance"
                        style="display: none; margin-top: 0.75rem; padding: 0.75rem; background: linear-gradient(135deg, #dbeafe, #bfdbfe); border-radius: 6px;">
                        <strong style="color: #1e40af;">üìè Distanza Percorsa:</strong>
                        <div style="font-size: 1.25rem; font-weight: 600; color: #1e3a8a; margin-top: 0.25rem;">
                            <span id="watch-distance-value">0</span> metri
                        </div>
                    </div>
                </div>

                <!-- Cronologia Posizioni -->
                <div id="watch-history" style="display: none;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                        <strong style="color: #374151;">üìú Cronologia Posizioni (ultime 5)</strong>
                        <button id="clear-watch-history-btn"
                            style="padding: 0.375rem 0.75rem; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-weight: 500; transition: all 0.3s;">
                            üóëÔ∏è Cancella
                        </button>
                    </div>
                    <div id="watch-history-list" style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <!-- Popolato dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Calcolo Distanza -->
            <div id="distance-calculator"
                style="display: none; margin-top: 1rem; padding: 1.5rem; background: var(--grigio-chiaro); border-radius: 12px; border: 2px solid #f59e0b;">
                <h4 style="margin-top: 0; color: #92400e;">
                    üìè Calcolo Distanza
                    <span
                        style="display: inline-block; margin-left: 0.5rem; padding: 0.25rem 0.5rem; background: linear-gradient(135deg, #d1fae5, #a7f3d0); color: #065f46; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">üü¢
                        OFFLINE OK</span>
                </h4>
                <p style="margin-bottom: 1rem; color: #666; font-size: 0.9rem;">Calcola la distanza dalla tua posizione
                    attuale a un punto di riferimento</p>

                <!-- Preset Citt√† FVG -->
                <div style="margin-bottom: 1rem;">
                    <strong style="display: block; margin-bottom: 0.5rem; color: #374151;">üèôÔ∏è Citt√† Principali
                        FVG:</strong>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        <button class="distance-preset-btn" data-lat="45.6495" data-lng="13.7768"
                            data-name="Trieste">Trieste</button>
                        <button class="distance-preset-btn" data-lat="46.0710" data-lng="13.2345"
                            data-name="Udine">Udine</button>
                        <button class="distance-preset-btn" data-lat="45.9632" data-lng="12.6603"
                            data-name="Pordenone">Pordenone</button>
                        <button class="distance-preset-btn" data-lat="45.9405" data-lng="13.6222"
                            data-name="Gorizia">Gorizia</button>
                    </div>
                </div>

                <!-- Input Manuale -->
                <div style="margin-bottom: 1rem;">
                    <strong style="display: block; margin-bottom: 0.5rem; color: #374151;">üìç O inserisci coordinate
                        personalizzate:</strong>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <input type="number" id="target-lat" placeholder="Latitudine" step="0.000001"
                            style="flex: 1; min-width: 150px; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.9rem;">
                        <input type="number" id="target-lng" placeholder="Longitudine" step="0.000001"
                            style="flex: 1; min-width: 150px; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.9rem;">
                    </div>
                </div>

                <!-- Pulsante Calcola -->
                <button id="calculate-distance-btn"
                    style="width: 100%; padding: 0.75rem; background: #f59e0b; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                    üìè Calcola Distanza
                </button>

                <!-- Risultato Distanza -->
                <div id="distance-result"
                    style="display: none; margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px; border-left: 4px solid #f59e0b;">
                    <div id="distance-info"></div>
                </div>
            </div>

            <!-- Mappa Interattiva -->
            <div id="map-container"
                style="display: none; margin-top: 1rem; padding: 1.5rem; background: var(--grigio-chiaro); border-radius: 12px; border: 2px solid #10b981;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <div style="flex: 1;">
                        <h4 style="margin: 0; color: #065f46;">
                            üó∫Ô∏è Mappa Posizione
                            <span
                                style="display: inline-block; margin-left: 0.5rem; padding: 0.25rem 0.5rem; background: linear-gradient(135deg, #fecaca, #fca5a5); color: #7f1d1d; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">üî¥
                                RICHIEDE INTERNET</span>
                        </h4>
                        <p style="margin: 0.25rem 0 0 0; color: #666; font-size: 0.85rem;">Visualizzazione interattiva
                            della tua posizione GPS</p>

                        <!-- Badge Dinamico Status Connessione -->
                        <div id="map-connection-badge"
                            style="display: inline-block; margin-top: 0.5rem; padding: 0.375rem 0.75rem; border-radius: 6px; font-size: 0.8rem; font-weight: 600; transition: all 0.3s;">
                            <span id="map-connection-icon">üü¢</span>
                            <span id="map-connection-text">Online</span>
                        </div>
                    </div>
                    <button id="recenter-map-btn"
                        style="padding: 0.5rem 1rem; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 0.9rem; transition: all 0.3s;">
                        üéØ Centra
                    </button>
                </div>

                <!-- Container Mappa Leaflet -->
                <div id="map"
                    style="height: 400px; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);">
                </div>

                <!-- Info Mappa -->
                <div
                    style="margin-top: 1rem; padding: 0.75rem; background: white; border-radius: 8px; font-size: 0.85rem; color: #6b7280;">
                    <strong style="color: #374151;">üìç Legenda:</strong>
                    <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; line-height: 1.8;">
                        <li><strong style="color: #3b82f6;">Marker blu</strong> = La tua posizione attuale</li>
                        <li><strong style="color: #3b82f6;">Cerchio blu</strong> = Raggio di accuratezza GPS (¬±metri)
                        </li>
                        <li>Usa <strong>scroll/pinch</strong> per zoom, <strong>drag</strong> per muovere la mappa</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Effetti e Animazioni Attive -->
        <div id="section-effects" class="test-section">
            <h2>üé≠ Effetti e Animazioni Attive</h2>
            <div class="effects-grid" id="effects-grid">
                <!-- Gli effetti verranno popolati dinamicamente -->
            </div>
            <button class="test-button" data-action="update-effects-status">üîÑ Aggiorna Status</button>
        </div>

        <!-- Test 1: Caricamento Database -->
        <div id="section-database" class="test-section has-module-header">
            <!-- Nuovo header modulo: Database -->
            <div class="test-header" data-module="database">
                <div class="test-header-top">
                    <div class="test-header-left">
                        <div class="test-title">Test Database</div>
                        <div class="test-stats">
                            <span>‚úÖ <span id="db-header-passed">0</span></span>
                            <span>‚ùå <span id="db-header-failed">0</span></span>
                            <span>‚è±Ô∏è <span id="db-header-time">0ms</span></span>
                        </div>
                    </div>
                    <div class="test-header-right">
                        <div class="test-progress" id="db-header-progress">0/17</div>
                        <span class="test-header-status status-pending status-pending-small" id="db-header-status">In attesa</span>
                    </div>
                </div>
                <div class="test-timestamp" id="db-header-timestamp" data-ts="">-</div>
                <div class="test-bar">
                    <div class="test-bar-fill" id="db-header-bar" data-progress="0"></div>
                </div>
            </div>

            <!-- CARD UNICA che contiene tutti i gruppi (stile Mobile 3) -->
            <div class="test-groups-card">

                <!-- Gruppo 0: Debug Logger -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="debug" data-group-id="debug">
                        <div class="test-group-bar group-debug"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">üêõ Debug Logger</div>
                            <div class="test-group-subtitle">Sistema di logging avanzato per debugging</div>
                        </div>
                        <div class="test-group-badge badge-info">DEV</div>
                        <div class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="debug-group-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item">
                                <div class="test-item-header">
                                    <div class="test-item-title">üîß Controllo Debug Logger</div>
                                    <div class="test-item-description">Attiva/disattiva il sistema di debug logging</div>
                                </div>
                                <div class="test-item-actions">
                                    <button class="test-btn test-btn-primary" onclick="DebugCore.enable()">
                                        ‚úÖ Attiva Logger
                                    </button>
                                    <button class="test-btn test-btn-secondary" onclick="DebugCore.disable()">
                                        ‚ùå Disattiva Logger
                                    </button>
                                    <button class="test-btn test-btn-info" onclick="window.diagnoseScroll()">
                                        üîç Diagnosi Scroll
                                    </button>
                                </div>
                            </div>
                            <div class="test-item">
                                <div class="test-item-header">
                                    <div class="test-item-title">üìù Test Log Categorie</div>
                                    <div class="test-item-description">Testa le diverse categorie di logging</div>
                                </div>
                                <div class="test-item-actions">
                                    <button class="test-btn test-btn-success" onclick="DebugCore.log('GPS', 'Test GPS logging', {lat: 40.123, lng: 18.456})">
                                        üìç Test GPS
                                    </button>
                                    <button class="test-btn test-btn-warning" onclick="DebugCore.log('PERFORMANCE', 'Test performance', {loadTime: '234ms'})">
                                        ‚ö° Test Performance
                                    </button>
                                    <button class="test-btn test-btn-danger" onclick="DebugCore.log('ERROR', 'Test errore simulato', {type: 'TestError'})">
                                        ‚ùå Test Error
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 1: Caricamento & Struttura -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="db" data-group-id="group1">
                        <div class="test-group-bar group-db-1"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Caricamento & Struttura</div>
                            <div id="db-group1-subtitle" class="test-group-subtitle state-pending">5 test da completare</div>
                        </div>
                        <div id="db-group1-badge" class="test-group-badge badge-pending">0/5</div>
                        <div id="db-group1-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="db-group1-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-database-load">
                                <span>üìÑ Caricamento database.json</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-structure">
                                <span>üèóÔ∏è Validazione struttura base</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-lines">
                                <span>üìã Campi obbligatori</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-types">
                                <span>üîç Tipi rigorosi</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-null-undefined">
                                <span>üö´ Valori null/undefined</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 2: Validazione Dati -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="db" data-group-id="group2">
                        <div class="test-group-bar group-db-2"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Validazione Dati</div>
                            <div id="db-group2-subtitle" class="test-group-subtitle state-pending">4 test da completare</div>
                        </div>
                        <div id="db-group2-badge" class="test-group-badge badge-pending">0/4</div>
                        <div id="db-group2-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="db-group2-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-database-prices">
                                <span>üí∞ Validazione prezzi</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-stops">
                                <span>üöè Validazione fermate</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-codes">
                                <span>üè∑Ô∏è Validazione codici</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-encoding">
                                <span>üåê Encoding e caratteri speciali</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 3: Analisi Qualit√† -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="db" data-group-id="group3">
                        <div class="test-group-bar group-db-3"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Analisi Qualit√†</div>
                            <div id="db-group3-subtitle" class="test-group-subtitle state-pending">7 test da completare</div>
                        </div>
                        <div id="db-group3-badge" class="test-group-badge badge-pending">0/7</div>
                        <div id="db-group3-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="db-group3-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-database-duplicates">
                                <span>üîÑ Nomi linee duplicati</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-range">
                                <span>üìä Range prezzi</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-progression">
                                <span>üìà Progressivit√† prezzi</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-format">
                                <span>üî§ Formato codici</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-consistency">
                                <span>üîó Consistenza dati</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-edge-cases">
                                <span>‚ö†Ô∏è Edge cases estremi</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-database-size-limit">
                                <span>üìè Dimensioni massime</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 4: Performance -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="db" data-group-id="group4">
                        <div class="test-group-bar group-db-4"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Performance</div>
                            <div id="db-group4-subtitle" class="test-group-subtitle state-pending">1 test da completare</div>
                        </div>
                        <div id="db-group4-badge" class="test-group-badge badge-pending">0/1</div>
                        <div id="db-group4-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="db-group4-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-database-performance">
                                <span>üöÄ Misurazione velocit√†</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; margin-top: 1rem;">
                <button class="test-button" data-test="database" style="flex: 1; min-width: 120px;">üß™ Esegui
                    Tutti i Test</button>
                <button class="test-button" data-db-action="toggle-open" style="background: #6b7280; min-width: 100px;">üìÇ Espandi
                    Tutti</button>
                <button class="test-button" data-db-action="toggle-close" style="background: #6b7280; min-width: 100px;">üìÅ Comprimi
                    Tutti</button>
                <button class="test-button" data-db-action="reset" style="background: #ef4444; transition: background-color 0.2s ease; min-width: 100px;">üîÑ Reset
                    Test</button>
            </div>
            <div class="test-output" id="output-database" style="display:none;"></div>
            <div id="db-log-buttons" style="display: none; gap: 0.5rem; margin-top: 0.5rem;">
                <button class="test-button" data-db-action="copy-log" style="background: #0d9488;">üìã Copia
                    log</button>
                <button class="test-button" data-db-action="download-log" style="background: #3b82f6;">üíæ Scarica
                    log</button>
                <button class="test-button" data-db-action="clear-log" style="background: #ef4444;">üóëÔ∏è Cancella
                    log</button>
            </div>
        </div>

        <!-- Test 2: LocalStorage -->
        <!-- Test 3: Dark Mode -->
        <div id="section-darkmode" class="test-section">
            <h2>üåô Test Dark Mode</h2>
            <div class="test-item" id="test-darkmode-toggle">
                <span>Toggle dark mode</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-darkmode-persistence">
                <span>Persistenza preferenza</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <button class="test-button" data-test="darkmode">üß™ Test Dark Mode</button>
            <div class="test-output" id="output-darkmode" style="display:none;"></div>
        </div>

        <!-- Test 3.5: Storage Module (js/core/storage.js) -->
        <div id="section-storage" class="test-section has-module-header">
            <!-- Header modulo: Storage -->
            <div class="test-header" data-module="storage">
                    <div class="test-header-top">
                    <div class="test-title">üíæ Test Storage Module</div>
                    <div class="test-progress" id="storage-header-progress">0/24</div>
                    <span class="test-header-status status-pending" id="storage-header-status">In attesa</span>
                </div>
                <div class="test-stats">
                    <span>‚úÖ <span id="storage-header-passed">0</span></span>
                    <span>‚ùå <span id="storage-header-failed">0</span></span>
                    <span>‚è±Ô∏è <span id="storage-header-time">0ms</span></span>
                </div>
                <div class="test-timestamp" id="storage-header-timestamp" data-ts="">-</div>
                <div class="test-bar">
                    <div class="test-bar-fill" id="storage-header-bar" data-progress="0"></div>
                </div>
            </div>

            <!-- CARD UNICA che contiene tutti i gruppi -->
            <div class="test-groups-card">

                <!-- Gruppo 1: Test Base -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="storage" data-group-id="group1">
                        <div class="test-group-bar group-storage-1"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Test Base</div>
                            <div id="storage-group1-subtitle" class="test-group-subtitle state-pending">3 test da completare</div>
                        </div>
                        <div id="storage-group1-badge" class="test-group-badge badge-pending">0/3</div>
                        <div id="storage-group1-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="storage-group1-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-storage-set-get">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-set-get" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Storage.setItem() e Storage.getItem()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-remove">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-remove" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Storage.removeItem()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-default-value">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-default-value" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Storage.getItem() con defaultValue</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 2: Test JSON -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="storage" data-group-id="group2">
                        <div class="test-group-bar group-storage-2"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Test JSON</div>
                            <div id="storage-group2-subtitle" class="test-group-subtitle state-pending">4 test da completare</div>
                        </div>
                        <div id="storage-group2-badge" class="test-group-badge badge-pending">0/4</div>
                        <div id="storage-group2-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="storage-group2-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-storage-json-object">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-json-object" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Oggetti JSON</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-json-array">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-json-array" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Array JSON</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-boolean">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-boolean" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Valori boolean</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-number">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-number" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Valori numerici</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 3: Test Funzioni Avanzate -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="storage" data-group-id="group3">
                        <div class="test-group-bar group-storage-3"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Funzioni Avanzate</div>
                            <div id="storage-group3-subtitle" class="test-group-subtitle state-pending">5 test da completare</div>
                        </div>
                        <div id="storage-group3-badge" class="test-group-badge badge-pending">0/5</div>
                        <div id="storage-group3-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="storage-group3-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-storage-clear">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-clear" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Storage.clear()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-prefix-get">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-prefix-get" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Storage.getItemsByPrefix()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-prefix-remove">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-prefix-remove" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Storage.removeItemsByPrefix()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-has-item">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-has-item" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Storage.hasItem()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-size">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-size" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Storage.getSize()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 4: Test Edge Cases -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="storage" data-group-id="group4">
                        <div class="test-group-bar group-storage-4"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Edge Cases</div>
                            <div id="storage-group4-subtitle" class="test-group-subtitle state-pending">4 test da completare</div>
                        </div>
                        <div id="storage-group4-badge" class="test-group-badge badge-pending">0/4</div>
                        <div id="storage-group4-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="storage-group4-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-storage-retrocompatibility">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-retrocompatibility" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Retrocompatibilit√† localStorage</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-null-undefined">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-null-undefined" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Valori null e undefined</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-special-chars">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-special-chars" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Caratteri speciali</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-large-value">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-large-value" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Valore grande (10KB)</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 5: Test Avanzati -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="storage" data-group-id="group5">
                        <div class="test-group-bar group-storage-5"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Test Avanzati</div>
                            <div id="storage-group5-subtitle" class="test-group-subtitle state-pending">8 test da completare</div>
                        </div>
                        <div id="storage-group5-badge" class="test-group-badge badge-pending">0/8</div>
                        <div id="storage-group5-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="storage-group5-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-storage-multiple-operations">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-multiple-operations" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Operazioni multiple</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-performance">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-performance" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Performance (100KB x100)</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-iterate-keys">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-iterate-keys" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Iterazione chiavi</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-invalid-json">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-invalid-json" title="Esegui solo questo test">‚ñ∂</button>
                                <span>JSON invalido</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-non-string">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-non-string" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Valori non-stringa</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-namespace">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-namespace" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Namespace prefix (tpl.*)</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-migration">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-migration" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Migrazione isDark ‚Üí themeMode</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-storage-timestamp">
                                <button class="test-run-single" data-test="storage-single" data-test-id="test-storage-timestamp" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Gestione timestamp</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- Fine Card Gruppi Test Storage -->

            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; margin-top: 1rem;">
                <button class="test-button" data-test="storage" style="flex: 1; min-width: 150px;">üß™ Test Storage (24 test)</button>
                <button class="test-button" data-storage-action="toggle-open" style="background: #6b7280;">üìÇ Apri Tutti</button>
                <button class="test-button" data-storage-action="toggle-close" style="background: #6b7280;">üìÅ Chiudi Tutti</button>
                <button class="test-button" data-storage-action="reset" style="background: #ef4444; transition: background-color 0.2s ease; min-width: 100px;">üîÑ Reset Test</button>
            </div>
            <div class="test-output" id="output-storage" style="display:none;"></div>
            <div id="storage-log-buttons" style="display: none; gap: 0.5rem; margin-top: 0.5rem;">
                <button class="test-button" data-storage-action="copy-log" style="background: #0d9488;">üìã Copia log</button>
                <button class="test-button" data-storage-action="download-log" style="background: #3b82f6;">üíæ Scarica log</button>
                <button class="test-button" data-storage-action="clear-log" style="background: #ef4444;">üóëÔ∏è Cancella log</button>
            </div>
        </div>

        <!-- Test 4: Calcolo Prezzi (Modulo prezzi.js) -->
        <div id="section-prezzi" class="test-section has-module-header">
            <!-- Nuovo header modulo: Prezzi -->
            <div class="test-header" data-module="prezzi">
                <div class="test-header-top">
                    <div class="test-title">üí∞ Test Prezzi</div>
                    <div class="test-progress" id="price-header-progress">0/26</div>
                    <span class="test-header-status status-pending" id="price-header-status">In attesa</span>
                </div>
                <div class="test-stats">
                    <span>‚úÖ <span id="price-header-passed">0</span></span>
                    <span>‚ùå <span id="price-header-failed">0</span></span>
                    <span>‚è±Ô∏è <span id="price-header-time">0ms</span></span>
                </div>
                <div class="test-timestamp" id="price-header-timestamp" data-ts="">-</div>
                <div class="test-bar">
                    <div class="test-bar-fill" id="price-header-bar" data-progress="0"></div>
                </div>
            </div>

            <!-- CARD UNICA che contiene tutti i gruppi (stile Mobile 3) -->
            <div class="test-groups-card">

                <!-- Gruppo 1: Test Unitari -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="price" data-group-id="group1">
                        <div class="test-group-bar group-price-1"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Test Unitari</div>
                            <div id="price-group1-subtitle" class="test-group-subtitle state-pending">5 test da completare</div>
                        </div>
                        <div id="price-group1-badge" class="test-group-badge badge-pending">0/5</div>
                        <div id="price-group1-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="price-group1-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-pricing-calculate">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-calculate" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Pricing.calculatePrice()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-ticket-code">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-ticket-code" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Pricing.getTicketCode()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-format">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-format" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Pricing.formatPrice()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-validation">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-validation" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Pricing.isValidSelection()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-route">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-route" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Pricing.isRouteAvailable()</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 2: Edge Cases -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="price" data-group-id="group2">
                        <div class="test-group-bar group-price-2"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Edge Cases</div>
                            <div id="price-group2-subtitle" class="test-group-subtitle state-pending">3 test da completare</div>
                        </div>
                        <div id="price-group2-badge" class="test-group-badge badge-pending">0/3</div>
                        <div id="price-group2-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="price-group2-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-pricing-same-stop">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-same-stop" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Stessa fermata (partenza = arrivo)</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-out-of-range">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-out-of-range" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Indici fuori range</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-fallback">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-fallback" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Fallback tariffarioAggiornato</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 3: Test Avanzati -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="price" data-group-id="group3">
                        <div class="test-group-bar group-price-3"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Test Avanzati</div>
                            <div id="price-group3-subtitle" class="test-group-subtitle state-pending">5 test da completare</div>
                        </div>
                        <div id="price-group3-badge" class="test-group-badge badge-pending">0/5</div>
                        <div id="price-group3-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="price-group3-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-pricing-empty-tariffario">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-empty-tariffario" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Tariffario vuoto/null</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-negative-indices">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-negative-indices" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Indici negativi</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-string-indices">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-string-indices" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Indici come stringhe ("0", "5")</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-zero-price">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-zero-price" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Prezzo zero (gratuito)</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-missing-matrices">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-missing-matrices" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Matrici prezzi/codici mancanti</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 4: Robustezza Dati -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="price" data-group-id="group4">
                        <div class="test-group-bar group-price-4"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Robustezza Dati</div>
                            <div id="price-group4-subtitle" class="test-group-subtitle state-pending">16 test da completare</div>
                        </div>
                        <div id="price-group4-badge" class="test-group-badge badge-pending">0/16</div>
                        <div id="price-group4-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="price-group4-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-pricing-null-price">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-null-price" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Prezzo null nella matrice</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-undefined-price">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-undefined-price" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Prezzo undefined nella matrice</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-string-price">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-string-price" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Prezzo come stringa ("3.50")</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-line-not-exists">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-line-not-exists" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Linea non esistente (indice 999)</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-result-structure">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-result-structure" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Struttura risultato corretta</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-nan-price">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-nan-price" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Prezzo NaN nella matrice</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-infinity-price">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-infinity-price" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Prezzo Infinity nella matrice</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-negative-price">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-negative-price" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Prezzo negativo</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-fermate-not-array">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-fermate-not-array" title="Esegui solo questo test">‚ñ∂</button>
                                <span>fermate non array</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-code-with-spaces">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-code-with-spaces" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Codice con spazi</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-price-code-only">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-price-code-only" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Solo codice senza prezzo</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-fallback-actual">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-fallback-actual" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Fallback tariffarioAggiornato (funzionamento)</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-extreme-values">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-extreme-values" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Valori estremi (grande/piccolo/decimali)</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-symmetry">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-symmetry" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Simmetria andata/ritorno</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-multiple-lines">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-multiple-lines" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Test con pi√π linee diverse</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-pricing-performance">
                                <button class="test-run-single" data-test="price-single" data-test-id="test-pricing-performance" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Performance (1000 calcoli)</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- Fine Card Gruppi Test Prezzi -->

            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; margin-top: 1rem;">
                <button class="test-button" data-test="price" style="flex: 1; min-width: 150px;">üß™ Test
                    Modulo Prezzi</button>
                <button class="test-button" data-price-action="toggle-open" style="background: #6b7280;">üìÇ Apri
                    Tutti</button>
                <button class="test-button" data-price-action="toggle-close" style="background: #6b7280;">üìÅ Chiudi
                    Tutti</button>
                <button class="test-button" data-price-action="reset" style="background: #ef4444; transition: background-color 0.2s ease; min-width: 100px;">üîÑ Reset Test</button>
            </div>
            <div class="test-output" id="output-price" style="display:none;" data-no-copy="true"></div>
            <div id="price-log-buttons" style="display: none; gap: 0.5rem; margin-top: 0.5rem;">
                <button class="test-button" data-price-action="copy-log" style="background: #0d9488;">üìã Copia log</button>
                <button class="test-button" data-price-action="download-log" style="background: #3b82f6;">üíæ Scarica
                    log</button>
                <button class="test-button" data-price-action="clear-log" style="background: #ef4444;">üóëÔ∏è Cancella
                    log</button>
            </div>
        </div>

        <!-- Test RouteSelector: Route Selector (Modulo route-selector.js) -->
        <div id="section-route" class="test-section has-module-header">
            <!-- Header modulo: Route Selector -->
            <div class="test-header" data-module="route">
                <div class="test-header-top">
                    <div class="test-title">üß≠ Test Route Selector</div>
                    <div class="test-progress" id="route-header-progress">0/10</div>
                    <span class="test-header-status status-pending" id="route-header-status">In attesa</span>
                </div>
                <div class="test-stats">
                    <span>‚úÖ <span id="route-header-passed">0</span></span>
                    <span>‚ùå <span id="route-header-failed">0</span></span>
                    <span>‚è±Ô∏è <span id="route-header-time">0ms</span></span>
                </div>
                <div class="test-timestamp" id="route-header-timestamp" data-ts="">-</div>
                <div class="test-bar">
                    <div class="test-bar-fill" id="route-header-bar" data-progress="0"></div>
                </div>
            </div>

            <!-- CARD UNICA che contiene tutti i gruppi -->
            <div class="test-groups-card">

                <!-- Gruppo 1: Test Base -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="route" data-group-id="group1">
                        <div class="test-group-bar group-route-1"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Test Base</div>
                            <div id="route-group1-subtitle" class="test-group-subtitle state-pending">2 test da completare</div>
                        </div>
                        <div id="route-group1-badge" class="test-group-badge badge-pending">0/2</div>
                        <div id="route-group1-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="route-group1-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-route-module">
                                <button class="test-run-single" data-test="route-single" data-test-id="test-route-module" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Disponibilit√† modulo</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-route-initial-state">
                                <button class="test-run-single" data-test="route-single" data-test-id="test-route-initial-state" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Stato iniziale</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 2: Selezione -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="route" data-group-id="group2">
                        <div class="test-group-bar group-route-2"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Selezione</div>
                            <div id="route-group2-subtitle" class="test-group-subtitle state-pending">3 test da completare</div>
                        </div>
                        <div id="route-group2-badge" class="test-group-badge badge-pending">0/3</div>
                        <div id="route-group2-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="route-group2-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-route-select-linea">
                                <button class="test-run-single" data-test="route-single" data-test-id="test-route-select-linea" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Selezione linea</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-route-select-partenza">
                                <button class="test-run-single" data-test="route-single" data-test-id="test-route-select-partenza" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Selezione partenza</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-route-select-arrivo">
                                <button class="test-run-single" data-test="route-single" data-test-id="test-route-select-arrivo" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Selezione arrivo</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 3: Funzionalit√† -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="route" data-group-id="group3">
                        <div class="test-group-bar group-route-3"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Funzionalit√†</div>
                            <div id="route-group3-subtitle" class="test-group-subtitle state-pending">3 test da completare</div>
                        </div>
                        <div id="route-group3-badge" class="test-group-badge badge-pending">0/3</div>
                        <div id="route-group3-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="route-group3-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-route-swap">
                                <button class="test-run-single" data-test="route-single" data-test-id="test-route-swap" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Swap partenza/arrivo</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-route-reset">
                                <button class="test-run-single" data-test="route-single" data-test-id="test-route-reset" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Reset selezioni</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-route-getters">
                                <button class="test-run-single" data-test="route-single" data-test-id="test-route-getters" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Metodi getter</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 4: Storage -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="route" data-group-id="group4">
                        <div class="test-group-bar group-route-4"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Storage</div>
                            <div id="route-group4-subtitle" class="test-group-subtitle state-pending">2 test da completare</div>
                        </div>
                        <div id="route-group4-badge" class="test-group-badge badge-pending">0/2</div>
                        <div id="route-group4-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="route-group4-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-route-storage-save">
                                <button class="test-run-single" data-test="route-single" data-test-id="test-route-storage-save" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Salvataggio Storage</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-route-storage-restore">
                                <button class="test-run-single" data-test="route-single" data-test-id="test-route-storage-restore" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Ripristino Storage</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- Fine Card Gruppi Test Route Selector -->

            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; margin-top: 1rem;">
                <button class="test-button" data-test="route" style="flex: 1; min-width: 150px;">üß™ Test
                    Route Selector</button>
                <button class="test-button" data-route-action="toggle-open" style="background: #6b7280;">üìÇ Apri
                    Tutti</button>
                <button class="test-button" data-route-action="toggle-close" style="background: #6b7280;">üìÅ Chiudi
                    Tutti</button>
                <button class="test-button" data-route-action="reset" style="background: #ef4444; transition: background-color 0.2s ease; min-width: 100px;">üîÑ Reset Test</button>
            </div>
            <div class="test-output" id="output-route" style="display:none;" data-no-copy="true"></div>
            <div id="route-log-buttons" style="display: none; gap: 0.5rem; margin-top: 0.5rem;">
                <button class="test-button" data-route-action="copy-log" style="background: #0d9488;">üìã Copia log</button>
                <button class="test-button" data-route-action="download-log" style="background: #3b82f6;">üíæ Scarica
                    log</button>
                <button class="test-button" data-route-action="clear-log" style="background: #ef4444;">üóëÔ∏è Cancella
                    log</button>
            </div>
        </div>

        <!-- Test 5: Settings (Modulo settings.js) -->
        <div id="section-settings" class="test-section has-module-header">
            <!-- Header modulo: Settings -->
            <div class="test-header" data-module="settings">
                <div class="test-header-top">
                    <div class="test-title">‚öôÔ∏è Test Settings</div>
                    <div class="test-progress" id="settings-header-progress">0/22</div>
                    <span class="test-header-status status-pending" id="settings-header-status">In attesa</span>
                </div>
                <div class="test-stats">
                    <span>‚úÖ <span id="settings-header-passed">0</span></span>
                    <span>‚ùå <span id="settings-header-failed">0</span></span>
                    <span>‚è±Ô∏è <span id="settings-header-time">0ms</span></span>
                </div>
                <div class="test-timestamp" id="settings-header-timestamp" data-ts="">-</div>
                <div class="test-bar">
                    <div class="test-bar-fill" id="settings-header-bar" data-progress="0"></div>
                </div>
            </div>

            <!-- CARD UNICA che contiene tutti i gruppi -->
            <div class="test-groups-card">

                <!-- Gruppo 1: Dimensione Testo -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="settings" data-group-id="group1">
                        <div class="test-group-bar group-settings-1"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Dimensione Testo</div>
                            <div id="settings-group1-subtitle" class="test-group-subtitle state-pending">3 test da completare</div>
                        </div>
                        <div id="settings-group1-badge" class="test-group-badge badge-pending">0/3</div>
                        <div id="settings-group1-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="settings-group1-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-settings-font-size-normal">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-font-size-normal" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Font Size: Normal</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-font-size-large">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-font-size-large" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Font Size: Large</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-font-size-xlarge">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-font-size-xlarge" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Font Size: XLarge</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 2: Tema -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="settings" data-group-id="group2">
                        <div class="test-group-bar group-settings-2"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Tema</div>
                            <div id="settings-group2-subtitle" class="test-group-subtitle state-pending">3 test da completare</div>
                        </div>
                        <div id="settings-group2-badge" class="test-group-badge badge-pending">0/3</div>
                        <div id="settings-group2-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="settings-group2-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-settings-theme-light">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-theme-light" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Tema: Light</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-theme-dark">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-theme-dark" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Tema: Dark</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-theme-system">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-theme-system" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Tema: System</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 3: Accessibilit√† -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="settings" data-group-id="group3">
                        <div class="test-group-bar group-settings-3"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Accessibilit√†</div>
                            <div id="settings-group3-subtitle" class="test-group-subtitle state-pending">6 test da completare</div>
                        </div>
                        <div id="settings-group3-badge" class="test-group-badge badge-pending">0/6</div>
                        <div id="settings-group3-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="settings-group3-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-settings-high-contrast">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-high-contrast" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Contrasto Alto</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-touch-friendly">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-touch-friendly" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Touch Friendly</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-reduce-motion">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-reduce-motion" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Riduci Animazioni</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-extra-spacing">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-extra-spacing" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Spaziatura Extra</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-compact-layout">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-compact-layout" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Layout Compatto</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-blue-light-filter">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-blue-light-filter" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Filtro Luce Blu</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 4: Dimensione Interfaccia -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="settings" data-group-id="group4">
                        <div class="test-group-bar group-settings-4"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Dimensione Interfaccia</div>
                            <div id="settings-group4-subtitle" class="test-group-subtitle state-pending">5 test da completare</div>
                        </div>
                        <div id="settings-group4-badge" class="test-group-badge badge-pending">0/5</div>
                        <div id="settings-group4-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="settings-group4-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-settings-interface-scale-75">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-interface-scale-75" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Interface Scale: 75%</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-interface-scale-85">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-interface-scale-85" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Interface Scale: 85%</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-interface-scale-100">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-interface-scale-100" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Interface Scale: 100%</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-interface-scale-115">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-interface-scale-115" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Interface Scale: 115%</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-interface-scale-125">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-interface-scale-125" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Interface Scale: 125%</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 5: Feedback e Persistenza -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="settings" data-group-id="group5">
                        <div class="test-group-bar group-settings-5"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Feedback e Persistenza</div>
                            <div id="settings-group5-subtitle" class="test-group-subtitle state-pending">5 test da completare</div>
                        </div>
                        <div id="settings-group5-badge" class="test-group-badge badge-pending">0/5</div>
                        <div id="settings-group5-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="settings-group5-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-settings-haptic-feedback">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-haptic-feedback" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Feedback Aptico</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-animation-toggle">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-animation-toggle" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Toggle Animazioni</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-keep-screen-on">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-keep-screen-on" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Keep Screen On (Wake Lock)</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-localstorage-persistence">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-localstorage-persistence" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Persistenza localStorage</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-settings-css-classes">
                                <button class="test-run-single" data-test="settings-single" data-test-id="test-settings-css-classes" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Classi CSS applicate</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- Fine Card Gruppi Test Settings -->

            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; margin-top: 1rem;">
                <button class="test-button" data-test="settings" style="flex: 1; min-width: 150px;">üß™ Test Modulo Settings</button>
                <button class="test-button" data-settings-action="toggle-open" style="background: #6b7280;">üìÇ Apri Tutti</button>
                <button class="test-button" data-settings-action="toggle-close" style="background: #6b7280;">üìÅ Chiudi Tutti</button>
                <button class="test-button" data-settings-action="reset" style="background: #ef4444; transition: background-color 0.2s ease; min-width: 100px;">üîÑ Reset Test</button>
            </div>
            <div class="test-output" id="output-settings" style="display:none;" data-no-copy="true"></div>
            <div id="settings-log-buttons" style="display: none; gap: 0.5rem; margin-top: 0.5rem;">
                <button class="test-button" data-settings-action="copy-log" style="background: #0d9488;">üìã Copia log</button>
                <button class="test-button" data-settings-action="download-log" style="background: #3b82f6;">üíæ Scarica log</button>
                <button class="test-button" data-settings-action="clear-log" style="background: #ef4444;">üóëÔ∏è Cancella log</button>
            </div>
        </div>

        <!-- Test 5: Service Worker (Modulo sw.js) -->
        <div id="section-sw" class="test-section has-module-header">
            <!-- Header modulo: Service Worker -->
            <div class="test-header" data-module="sw">
                <div class="test-header-top">
                    <div class="test-title">‚öôÔ∏è Test Service Worker (PWA)</div>
                    <div class="test-progress" id="sw-header-progress">0/14</div>
                    <span class="test-header-status status-pending" id="sw-header-status">In attesa</span>
                </div>
                <div class="test-stats">
                    <span>‚úÖ <span id="sw-header-passed">0</span></span>
                    <span>‚ùå <span id="sw-header-failed">0</span></span>
                    <span>‚è±Ô∏è <span id="sw-header-time">0ms</span></span>
                </div>
                <div class="test-timestamp" id="sw-header-timestamp" data-ts="">-</div>
                <div class="test-bar">
                    <div class="test-bar-fill" id="sw-header-bar" data-progress="0"></div>
                </div>
            </div>

            <!-- CARD UNICA che contiene tutti i gruppi -->
            <div class="test-groups-card">

                <!-- Gruppo 1: Registrazione e Base -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="sw" data-group-id="group1">
                        <div class="test-group-bar group-sw-1"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Registrazione e Base</div>
                            <div id="sw-group1-subtitle" class="test-group-subtitle state-pending">3 test da completare</div>
                        </div>
                        <div id="sw-group1-badge" class="test-group-badge badge-pending">0/3</div>
                        <div id="sw-group1-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="sw-group1-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-sw-registration">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-registration" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Registrazione Service Worker</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-sw-cache">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-cache" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Verifica cache</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-sw-version-not-cached">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-version-not-cached" title="Esegui solo questo test">‚ñ∂</button>
                                <span>version.json non in cache</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 2: Cache Management -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="sw" data-group-id="group2">
                        <div class="test-group-bar group-sw-2"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Cache Management</div>
                            <div id="sw-group2-subtitle" class="test-group-subtitle state-pending">4 test da completare</div>
                        </div>
                        <div id="sw-group2-badge" class="test-group-badge badge-pending">0/4</div>
                        <div id="sw-group2-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="sw-group2-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-sw-cache-size">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-cache-size" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Dimensione cache</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-sw-cache-cleanup">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-cache-cleanup" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Cache cleanup</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-sw-static-assets">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-static-assets" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Static assets verification</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-sw-fetch-strategy">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-fetch-strategy" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Fetch strategy (cache-first)</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 3: Messaggi e Comunicazione -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="sw" data-group-id="group3">
                        <div class="test-group-bar group-sw-3"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Messaggi e Comunicazione</div>
                            <div id="sw-group3-subtitle" class="test-group-subtitle state-pending">4 test da completare</div>
                        </div>
                        <div id="sw-group3-badge" class="test-group-badge badge-pending">0/4</div>
                        <div id="sw-group3-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="sw-group3-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-sw-messages">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-messages" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Messaggi al Service Worker</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-sw-clear-cache-message">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-clear-cache-message" title="Esegui solo questo test">‚ñ∂</button>
                                <span>CLEAR_CACHE message</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-sw-skip-waiting-message">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-skip-waiting-message" title="Esegui solo questo test">‚ñ∂</button>
                                <span>SKIP_WAITING message</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-sw-offline-fallback">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-offline-fallback" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Offline fallback</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gruppo 4: Strategie e Patterns -->
                <div class="test-group-separator">
                    <div class="test-group-header" data-toggle-group="sw" data-group-id="group4">
                        <div class="test-group-bar group-sw-4"></div>
                        <div class="test-group-title-container">
                            <div class="test-group-title">Strategie e Patterns</div>
                            <div id="sw-group4-subtitle" class="test-group-subtitle state-pending">3 test da completare</div>
                        </div>
                        <div id="sw-group4-badge" class="test-group-badge badge-pending">0/3</div>
                        <div id="sw-group4-icon" class="test-group-icon">‚ñ∂</div>
                    </div>
                    <div id="sw-group4-content" class="test-group-content">
                        <div class="test-group-items-container">
                            <div class="test-item" id="test-sw-update-mechanism">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-update-mechanism" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Update mechanism</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-sw-github-pages-patterns">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-github-pages-patterns" title="Esegui solo questo test">‚ñ∂</button>
                                <span>GitHub Pages patterns</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                            <div class="test-item" id="test-sw-error-handling">
                                <button class="test-run-single" data-test="sw-single" data-test-id="test-sw-error-handling" title="Esegui solo questo test">‚ñ∂</button>
                                <span>Error handling</span>
                                <span class="test-status pending">In attesa</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- Fine Card Gruppi Test Service Worker -->

            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; margin-top: 1rem;">
                <button class="test-button" data-test="serviceworker" style="flex: 1; min-width: 150px;">üß™ Test Modulo Service Worker</button>
                <button class="test-button" data-sw-action="toggle-open" style="background: #6b7280;">üìÇ Apri Tutti</button>
                <button class="test-button" data-sw-action="toggle-close" style="background: #6b7280;">üìÅ Chiudi Tutti</button>
                <button class="test-button" data-sw-action="reset" style="background: #ef4444; transition: background-color 0.2s ease; min-width: 100px;">üîÑ Reset Test</button>
            </div>
            <div class="test-output" id="output-sw" style="display:none;" data-no-copy="true"></div>
            <div id="sw-log-buttons" style="display: none; gap: 0.5rem; margin-top: 0.5rem;">
                <button class="test-button" data-sw-action="copy-log" style="background: #0d9488;">üìã Copia log</button>
                <button class="test-button" data-sw-action="download-log" style="background: #3b82f6;">üíæ Scarica log</button>
                <button class="test-button" data-sw-action="clear-log" style="background: #ef4444;">üóëÔ∏è Cancella log</button>
            </div>
        </div>

        <!-- Test 6: UI Components -->
        <div id="section-ui" class="test-section">
            <h2>üé® Test Componenti UI</h2>
            <div class="test-item" id="test-ui-selects">
                <span>Popolamento select</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-ui-swap">
                <span>Funzione swap percorso</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-ui-summary">
                <span>Aggiornamento riepilogo</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <button class="test-button" data-test="ui">üß™ Test UI Components</button>
            <div class="test-output" id="output-ui" style="display:none;"></div>
        </div>

        <!-- Test 7: Manifest PWA -->
        <div id="section-manifest" class="test-section">
            <h2>üì± Test Manifest PWA</h2>
            <div class="test-item" id="test-manifest-load">
                <span>Caricamento manifest.webmanifest</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-manifest-icons">
                <span>Validazione icone</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <button class="test-button" data-test="manifest">üß™ Test Manifest</button>
            <div class="test-output" id="output-manifest" style="display:none;"></div>
        </div>

        <!-- Test PWA Install Banner -->
        <div id="section-pwa-install" class="test-section">
            <h2>üì≤ Test PWA Install Banner</h2>
            <div class="test-item">
                <span>Banner HTML presente</span>
                <span class="test-status pending" id="test-pwa-install-banner-html">In attesa</span>
            </div>
            <div class="test-item">
                <span>Modulo PWAInstall caricato</span>
                <span class="test-status pending" id="test-pwa-install-module">In attesa</span>
            </div>
            <div class="test-item">
                <span>Condizioni installabilit√†</span>
                <span class="test-status pending" id="test-pwa-install-conditions">In attesa</span>
            </div>
            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; margin-top: 1rem;">
                <button class="test-button" data-test="pwa-install" style="flex: 1; min-width: 150px;">üß™ Test PWA Install Banner</button>
                <button class="test-button" data-pwa-install-action="show" style="background: #10b981;">üëÅÔ∏è Mostra Banner</button>
                <button class="test-button" data-pwa-install-action="hide" style="background: #6b7280;">üôà Nascondi Banner</button>
                <button class="test-button" data-pwa-install-action="check" style="background: #3b82f6;">üîç Verifica Condizioni</button>
            </div>
            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; margin-top: 0.5rem;">
                <button class="test-button" data-pwa-install-action="simulate-android" style="background: #10b981; flex: 1; min-width: 150px;">ü§ñ Simula Android</button>
                <button class="test-button" data-pwa-install-action="simulate-ios" style="background: #3b82f6; flex: 1; min-width: 150px;">üçé Simula iOS</button>
                <button class="test-button" data-pwa-install-action="update-mode" style="background: #8b5cf6; flex: 1; min-width: 150px;">üîÑ Aggiorna Modalit√†</button>
            </div>
            <div class="test-output" id="output-pwa-install" style="display:none;"></div>
        </div>

        <!-- Test 8: Performance -->
        <div id="section-performance" class="test-section">
            <h2>‚ö° Test Performance</h2>
            <div class="test-item" id="test-perf-load-time">
                <button class="test-run-single" data-test="performance-single" data-test-id="test-perf-load-time" title="Esegui solo questo test">‚ñ∂</button>
                <span>Tempo caricamento dati</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-perf-calc-time">
                <button class="test-run-single" data-test="performance-single" data-test-id="test-perf-calc-time" title="Esegui solo questo test">‚ñ∂</button>
                <span>Tempo calcolo prezzo</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; margin-top: 1rem;">
                <button class="test-button" data-test="performance" style="flex: 1; min-width: 150px;">üß™ Test Performance</button>
                <button class="test-button" data-performance-action="reset" style="background: #ef4444; transition: background-color 0.2s ease; min-width: 100px;">üîÑ Reset Test</button>
            </div>
            <div class="test-output" id="output-performance" style="display:none;"></div>
            <div id="performance-log-buttons" style="display: none; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
                <button class="test-button" data-performance-action="copy-log" style="background: #0d9488;">üìã Copia log</button>
                <button class="test-button" data-performance-action="download-log" style="background: #3b82f6;">üíæ Scarica log</button>
                <button class="test-button" data-performance-action="clear-log" style="background: #ef4444;">üóëÔ∏è Cancella log</button>
            </div>
        </div>

    </div>

    <!-- Banner installazione PWA (per test) -->
    <div id="pwa-install-banner" class="pwa-install-banner" style="display: none;">
        <div class="pwa-install-content">
            <div class="pwa-install-text">
                <span class="pwa-install-title">üì± Installa l'app</span>
                <span class="pwa-install-subtitle">Accedi pi√π velocemente e offline</span>
            </div>
            <div class="pwa-install-actions">
                <button id="pwa-install-later" class="pwa-btn pwa-btn-secondary" type="button">Pi√π tardi</button>
                <button id="pwa-install-button" class="pwa-btn pwa-btn-primary" type="button">Installa</button>
            </div>
        </div>
        <div id="pwa-ios-hint" class="pwa-ios-hint" style="display: none;">
            <div class="ios-hint-title">üì≤ Come installare su iPhone/iPad:</div>
            <ol class="ios-hint-steps">
                <li><span class="step-number">1.</span> Tocca il pulsante <strong>Condividi</strong> <span class="ios-share-icon">üì§</span> in basso (Safari)</li>
                <li><span class="step-number">2.</span> Scorri e seleziona <strong>"Aggiungi a Home"</strong> <span class="ios-plus-icon">‚ûï</span></li>
                <li><span class="step-number">3.</span> Tocca <strong>"Aggiungi"</strong> in alto a destra ‚úÖ</li>
            </ol>
            <div class="ios-hint-note">üí° L'app apparir√† sulla tua schermata Home come un'app nativa</div>
        </div>
        <div id="pwa-android-hint" class="pwa-android-hint" style="display: none;">
            <div class="android-hint-title">ü§ñ Come installare su Android:</div>
            <ol class="android-hint-steps">
                <li><span class="step-number">1.</span> Tocca il pulsante <strong>"Installa"</strong> qui sopra (se disponibile) ‚¨ÜÔ∏è</li>
                <li><span class="step-number">2.</span> Oppure: tocca il menu <strong>‚ãÆ</strong> (tre puntini) in alto a destra del browser</li>
                <li><span class="step-number">3.</span> Seleziona <strong>"Installa app"</strong> o <strong>"Aggiungi alla schermata Home"</strong> üì±</li>
                <li><span class="step-number">4.</span> Conferma l'installazione toccando <strong>"Installa"</strong> ‚úÖ</li>
            </ol>
            <div class="android-hint-note">üí° L'app apparir√† sulla tua schermata Home e potrai aprirla come un'app nativa</div>
        </div>
    </div>

    <!-- Pulsante torna su -->
    <!-- Gestito automaticamente da js/utils/ui-helpers.js con addEventListener -->
    <button class="scroll-to-top" title="Torna su">
        ‚Üë
    </button>

    <!-- Modal conferma reset cache / verifica aggiornamenti -->
    <div id="cache-modal" class="cache-modal">
        <div class="cache-modal-content">
            <div class="cache-modal-header">
                <h3 id="modal-title">üîÑ Verifica Aggiornamenti</h3>
            </div>
            <div class="cache-modal-body">
                <p id="modal-message">Verifico se ci sono aggiornamenti disponibili...</p>
                <p class="cache-modal-warning" id="modal-warning" style="display: none;"></p>
            </div>
            <div class="cache-modal-footer">
                <button id="cache-cancel" class="cache-modal-btn cache-modal-cancel">Annulla</button>
                <button id="cache-confirm" class="cache-modal-btn cache-modal-confirm" style="display: none;">Riavvia e
                    Aggiorna</button>
            </div>
        </div>
    </div>

    <!-- Modal Notifica (per conferme e messaggi) -->
    <div id="notification-modal" class="notification-modal">
        <div class="notification-modal-content">
            <div class="notification-modal-header">
                <h3 id="notification-modal-title">‚úì Operazione completata</h3>
            </div>
            <div class="notification-modal-body">
                <p id="notification-modal-message"></p>
            </div>
            <div class="notification-modal-footer">
                <button id="notification-modal-ok" class="notification-modal-btn">OK</button>
            </div>
        </div>
    </div>

    

    <!-- Footer -->
    <footer class="footer">
        <!-- Footer generato dinamicamente da footer.js -->
    </footer>

    <!-- Script di test -->
    <!-- CORE: Storage (deve essere caricato PRIMA di features che lo usano) -->
    <script src="js/core/storage.js"></script>
    <!-- DATA: Tariffario (deve essere caricato PRIMA di route-selector.js) -->
    <script src="js/data/tariffario.js"></script>
    <script src="footer.js"></script>
    <script src="changelog.js"></script>
    <script src="js/features/updates.js"></script>
    <script src="js/features/settings.js"></script>
    <!-- modals.js caricato subito dopo settings.js perch√© SettingsModal dipende da Settings -->
    <script src="js/components/modals.js"></script>
    <script src="js/components/notification-modal.js"></script>
    <script src="js/features/tests-ui.js"></script>
    <script src="js/features/prezzi.js?v=20251102-2"></script>
    <script src="js/tests/test-prezzi.js"></script>
    <!-- Wrapper funzioni Prezzi test - Event delegation gestita automaticamente per data-test="price" e data-test="price-single" -->
    <script src="js/tests/test-prezzi-wrappers.js"></script>
    <!-- Route Selector (dipende da tariffario.js e Pricing) -->
    <script src="js/features/route-selector.js"></script>
    <script src="js/tests/test-route-selector.js"></script>
    <!-- Wrapper funzioni Route Selector test - Event delegation gestita automaticamente per data-test="route" e data-test="route-single" -->
    <script src="js/tests/test-route-selector-wrappers.js"></script>
    <!-- GPS Modules - Fase 1-3 modularizzazione GPS (09/11/2025) -->
    <!-- IMPORTANTE: Ordine di caricamento importante per dipendenze -->
    <!-- Device Detection Module (09/11/2025) -->
    <script src="js/tests/device-detector.js"></script>
    <!-- PWA Test Mode Module (09/11/2025) -->
    <script src="js/tests/pwa-test-mode.js"></script>
    <!-- Effects Status Module (09/11/2025) -->
    <script src="js/tests/effects-status.js"></script>
    <script src="js/tests/gps/helpers.js"></script>
    <script src="js/tests/gps/fake-position.js"></script>
    <script src="js/tests/gps/reset-data.js"></script>
    <script src="js/tests/gps/distance-calculator.js"></script>
    <script src="js/tests/gps/map-leaflet.js"></script>
    <script src="js/tests/gps/watch-position.js"></script>
    <script src="js/tests/gps/quick-test.js"></script>
    <script src="js/tests/gps/export-report.js"></script>
    <script src="js/tests/gps/test-geolocation.js"></script>
    <!-- Modulo utility per test - Step 1 modularizzazione (02/11/2025) -->
    <script src="js/tests/test-utils.js"></script>
    <!-- Funzioni gestione log - Step 2 modularizzazione (06/11/2025) -->
    <!-- Le funzioni sono disponibili globalmente (window.copyDatabaseLog, ecc.) -->
    <script src="js/tests/test-log-helpers.js"></script>
    <!-- Wrapper funzioni accordion - Step 3 modularizzazione (06/11/2025) -->
    <!-- Event delegation gestita automaticamente per toggle gruppi (data-toggle-group e data-group-id) -->
    <script src="js/tests/test-accordion-wrappers.js"></script>
    <!-- Wrapper funzioni Storage test - Event delegation gestita automaticamente per data-test="storage" e data-test="storage-single" -->
    <script src="js/tests/test-storage-wrappers.js"></script>
    <!-- Modulo accordion per gruppi test - Step 3 modularizzazione (06/11/2025) -->
    <script src="js/tests/test-accordion.js"></script>
    <!-- Moduli test per categoria - Step 2 modularizzazione (02/11/2025) -->
    <script src="js/tests/test-database.js"></script>
    <!-- test-localstorage.js DEPRECATO - usa test-storage.js -->
    <script src="js/tests/test-storage.js"></script>
    <script src="js/tests/test-settings.js"></script>
    <script src="js/tests/test-settings-wrappers.js"></script>
    <script src="js/tests/test-darkmode.js"></script>
    <script src="js/tests/test-darkmode-wrappers.js"></script>
    <script src="js/tests/test-sw.js"></script>
    <script src="js/tests/test-sw-wrappers.js"></script>
    <script src="js/tests/test-all-wrappers.js"></script>
    <!-- Test UI, Manifest, Performance -->
    <script src="js/tests/test-ui.js"></script>
    <script src="js/tests/test-manifest.js"></script>
    <script src="js/tests/test-performance.js"></script>
    <!-- Wrapper funzioni UI, Manifest, Performance test - Event delegation gestita automaticamente per data-test="ui", "manifest", "performance" -->
    <script src="js/tests/test-ui-manifest-performance-wrappers.js"></script>
    <!-- TOC Navigation - Smooth scroll e highlight dinamico per indice mobile e sidebar desktop -->
    <script src="js/features/toc-navigation.js"></script>
    <!-- Mega Dropdown Settings (componente condiviso, solo desktop) -->
    <script src="js/components/mega-dropdown-settings.js"></script>
    <script src="js/utils/connection-monitor.js"></script>
    <script src="js/utils/offline-simulator.js"></script>
    <script src="js/utils/display-detector.js"></script>
    <!-- UI Helpers (gestisce scroll-to-top) -->
    <script src="js/utils/ui-helpers.js"></script>
    <!-- DEBUG LOGGER -->
    <script src="js/debug/core.js"></script>
    <script src="js/debug/categories.js"></script>
    <script src="js/debug/ui.js"></script>
    <!-- GEOLOCATION MODULE (necessario per test GPS) -->
    <script src="js/features/geolocation.js"></script>
    <!-- Hamburger Menu -->
    <script src="js/components/hamburger-menu.js"></script>
    <script src="js/components/pwa-install.js"></script>
    <script src="script.js"></script>
    <!-- Error 404 Simulator (solo per test.html) -->
    <script src="js/tests/error-404-simulator.js"></script>
    <script src="test-config.js"></script>
    <script>
        // ===== INITIALIZATION =====
        // Tutte le funzioni sono modulari e caricate tramite script tag sopra.
        // Event delegation gestita automaticamente dai wrapper modules.
        // I moduli DeviceDetector e EffectsStatus si auto-inizializzano.
        window.addEventListener('DOMContentLoaded', () => {
            // Inizializza statistiche test (conta status iniziali)
            if (typeof TestUtils !== 'undefined' && typeof TestUtils.updateStats === 'function') {
                TestUtils.updateStats();
            }

            // Event listener per test geolocalizzazione
            // Usa event delegation su document.body per evitare problemi con clonazione pulsanti
            // Setup event listener per test-location-btn (event delegation)
            document.body.addEventListener('click', (e) => {
                // Verifica se il click √® sul pulsante test-location-btn o sui suoi figli
                const target = e.target;
                const btn = target.closest('#test-location-btn');
                
                if (btn) {
                    // Click su test-location-btn rilevato
                    e.preventDefault();
                    e.stopPropagation();
                    try {
                        if (window.GPSTestGeolocation && typeof window.GPSTestGeolocation.run === 'function') {
                            window.GPSTestGeolocation.run();
                        } else if (typeof window.testGeolocation === 'function') {
                            // Fallback a funzione globale per retrocompatibilit√†
                            window.testGeolocation();
                        } else {
                            console.error('‚ùå testGeolocation non disponibile');
                        }
                    } catch (error) {
                        console.error('‚ùå Errore in testGeolocation:', error);
                    }
                }
            }, true); // Usa capture phase per intercettare prima di altri listener

            // Event listener per test rapido GPS
            const quickTestBtn = document.getElementById('quick-gps-test-btn');
            if (quickTestBtn) {
                quickTestBtn.addEventListener('click', () => {
                    if (window.GPSQuickTest && typeof window.GPSQuickTest.run === 'function') {
                        window.GPSQuickTest.run();
                    } else {
                        console.error('‚ùå GPSQuickTest non disponibile');
                    }
                });
            }

            // Event listener per export report
            const exportJsonBtn = document.getElementById('export-json-btn');
            if (exportJsonBtn) {
                exportJsonBtn.addEventListener('click', () => {
                    if (window.GPSExportReport && typeof window.GPSExportReport.export === 'function') {
                        window.GPSExportReport.export('json');
                    } else {
                        console.error('‚ùå GPSExportReport non disponibile');
                    }
                });
            }

            const exportTxtBtn = document.getElementById('export-txt-btn');
            if (exportTxtBtn) {
                exportTxtBtn.addEventListener('click', () => {
                    if (window.GPSExportReport && typeof window.GPSExportReport.export === 'function') {
                        window.GPSExportReport.export('txt');
                    } else {
                        console.error('‚ùå GPSExportReport non disponibile');
                    }
                });
            }

            // Event listener per reset dati GPS
            // NOTA: I listener sono gestiti automaticamente da js/tests/gps/reset-data.js
            // che si auto-inizializza. Il modulo reset-data.js gestisce gi√†:
            // - Pulsante reset GPS
            // - Pulsanti modal (cancel/confirm)
            // - Chiusura modal con click su overlay
            // - Chiusura modal con tasto ESC

            // Aggiorna l'anno nel footer
            const footerYear = document.getElementById('footer-year');
            if (footerYear) footerYear.textContent = new Date().getFullYear();

            // Effects Status gestisce automaticamente i listener per dark mode e resize
            // I listener sono configurati nel modulo effects-status.js
        });

        // ===== SCROLL TO TOP =====
        // CODICE RIMOSSO: Gestito da js/utils/ui-helpers.js (comune a tutte le pagine)
        // Le funzioni scrollToTop() e toggleScrollToTopButton() sono disponibili globalmente
        // Il modulo si auto-inizializza e gestisce automaticamente il pulsante scroll-to-top

        // ===== MEGA DROPDOWN IMPOSTAZIONI (OPZIONE C) =====
        // CODICE SPOSTATO IN js/components/mega-dropdown-settings.js (09/11/2025)
        // Il modulo si auto-inizializza e gestisce automaticamente il mega dropdown
        // NOTA: Questo componente √® disponibile in tutte le pagine (solo desktop)
    </script>

    <!-- Changelog non presente in test.html - rimosso renderChangelog -->

    <!-- Script Rilevamento Display - Spostato in js/utils/display-detector.js -->
    <script src="js/utils/display-detector.js"></script>

    <!-- Script Monitoraggio Connessione - Spostato in js/utils/connection-monitor.js -->
    <!-- NOTA: connection-monitor.js √® gi√† caricato sopra, non duplicare -->

    <script>
        // ===== INIZIALIZZAZIONE SETTINGS MODAL E CACHE MODAL =====
        // CODICE RIMOSSO: Gestito da script.js e modals.js (comune a tutte le pagine)
        // - Settings Modal: inizializzato da script.js (initializeModalsModules) e modals.js (setupDirectEventListener)
        // - Cache Modal: gestito da script.js (righe 395-437) con Updates da updates.js
        // Questi moduli sono gi√† caricati in test.html e gestiscono automaticamente i modali

        // ===== INIZIALIZZAZIONE HAMBURGER MENU =====
        // CODICE RIMOSSO: Gestito da script.js (comune a tutte le pagine)
        // L'hamburger menu √® gestito automaticamente da script.js (righe 1100-1181)
        // script.js √® gi√† caricato in test.html e gestisce l'inizializzazione del menu mobile

        // ===== ANIMAZIONE HEADER (Database & LocalStorage) =====
        // L'animazione shrink/expand dell'header √® gestita automaticamente da js/features/tests-ui.js
        // Animazione header gestita da tests-ui.js

        // ===== ANIMAZIONE SOBRIA GRUPPI TEST =====
        // Animazione subtile quando si clicca per aprire/chiudere i gruppi
        document.addEventListener('DOMContentLoaded', () => {
            // Inizializzazione animazioni sobrie gruppi test
            
            // Seleziona tutti i gruppi
            document.querySelectorAll('.test-group-separator').forEach(group => {
                const header = group.querySelector('.test-group-header');
                if (!header) return;
                
                header.addEventListener('click', function(e) {
                    // Non animare se si clicca sul pulsante test singolo
                    if (e.target.closest('.test-run-single')) {
                        return;
                    }
                    
                    const content = group.querySelector('.test-group-content');
                    const isExpanding = !content.classList.contains('expanded');
                    
                    // Animazione press (sempre)
                    // Usa requestAnimationFrame per ridurre forced reflow
                    group.classList.remove('clicking');
                    requestAnimationFrame(() => {
                        group.classList.add('clicking');
                        setTimeout(() => {
                            group.classList.remove('clicking');
                        }, 200);
                    });
                    
                    // Animazione highlight (solo quando si apre)
                    if (isExpanding) {
                        group.classList.remove('opening');
                        requestAnimationFrame(() => {
                            group.classList.add('opening');
                            setTimeout(() => {
                                group.classList.remove('opening');
                            }, 300);
                        });
                    }
                });
            });
            
            // Animazioni sobrie applicate ai gruppi test
        });
    </script>


</body>

</html>