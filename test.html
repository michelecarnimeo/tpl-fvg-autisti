<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TPL FVG - Test Funzionalit√†</title>
    <link rel="stylesheet" href="style1.css">
    <link rel="icon" href="src/tpl.jpg" type="image/jpeg">
    <style>
        .test-container {
            max-width: 1400px;
            width: 95%;
            margin: 1.5rem auto;
            padding: 1rem;
        }

        .test-section {
            background: var(--bianco);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 2px solid var(--bordo);
            width: 100%;
        }

        .test-section h2 {
            color: var(--turchese);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .test-item {
            padding: 1.5rem;
            margin: 0.75rem 0;
            border-radius: 8px;
            border: 1px solid var(--bordo);
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            box-sizing: border-box;
        }

        .test-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.875rem;
        }

        .test-status.pass {
            background: #d4edda;
            color: #155724;
        }

        .test-status.fail {
            background: #f8d7da;
            color: #721c24;
        }

        .test-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        /* Ottimizzazione per schermi grandi */
        @media (min-width: 1200px) {
            .test-container {
                max-width: 1500px;
                width: 90%;
                padding: 1.5rem;
            }
            
            .test-section {
                padding: 2.5rem;
                margin-bottom: 2rem;
            }
            
            .test-item {
                padding: 2rem;
                margin: 1rem 0;
            }
        }

        @media (min-width: 1600px) {
            .test-container {
                max-width: 1600px;
                width: 85%;
                padding: 2rem;
            }
            
            .test-section {
                padding: 3rem;
            }
        }

        .test-button {
            background: var(--turchese);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            margin: 0.25rem;
        }

        .test-button:hover {
            background: var(--turchese-scuro);
        }

        .test-output {
            background: var(--grigio-chiaro);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.875rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .test-card {
            background: var(--grigio-medio);
            padding: 1rem;
            border-radius: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-card {
            background: var(--grigio-medio);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--turchese);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--testo-secondario);
            margin-top: 0.25rem;
        }

        .run-all-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            width: 100%;
            margin-bottom: 1rem;
        }

        .run-all-btn:hover {
            background: #218838;
        }

        .console-log {
            margin: 0.25rem 0;
            padding: 0.25rem;
        }

        .console-log.info {
            color: #0066cc;
        }

        .console-log.success {
            color: #28a745;
        }

        .console-log.error {
            color: #dc3545;
        }

        .console-log.warning {
            color: #ffc107;
        }

        /* Stili per la griglia degli effetti */
        .effects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .effect-card {
            background: var(--grigio-medio);
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid var(--bordo);
            transition: all 0.3s ease;
        }

        .effect-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .effect-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .effect-icon {
            font-size: 1.5rem;
        }

        .effect-title {
            font-weight: bold;
            color: var(--turchese);
            font-size: 1.1rem;
        }

        .effect-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: auto;
        }

        .effect-status.active {
            background: #d4edda;
            color: #155724;
        }

        .effect-status.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .effect-status.conditional {
            background: #fff3cd;
            color: #856404;
        }

        .effect-details {
            font-size: 0.9rem;
            color: var(--testo-secondario);
            line-height: 1.4;
        }

        .effect-details ul {
            margin: 0.5rem 0;
            padding-left: 1.2rem;
        }

        .effect-details li {
            margin: 0.25rem 0;
        }

        /* Mobile: rimuovi card per layout flat */
        @media (max-width: 768px) {
            .test-section {
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
                backdrop-filter: none !important;
                padding: 1rem 0 !important;
                margin-bottom: 1rem !important;
            }
            
            .test-section::before {
                content: '';
                display: block;
                height: 1px;
                background: rgba(0, 0, 0, 0.1);
                margin-bottom: 1rem;
            }
            
            .dark .test-section::before {
                background: rgba(255, 255, 255, 0.1);
            }
            
            .test-item {
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
                backdrop-filter: none !important;
                padding: 0.75rem 0 !important;
                margin: 0.5rem 0 !important;
                border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
            }
            
            .dark .test-item {
                border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            }
            
            .test-item:last-child {
                border-bottom: none !important;
            }
            
            .effect-card {
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
                backdrop-filter: none !important;
                padding: 0.75rem 0 !important;
                margin-bottom: 1rem !important;
                border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
            }
            
            .dark .effect-card {
                border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            }
            
            .effect-card:last-child {
                border-bottom: none !important;
            }
            
            .stat-card {
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
                backdrop-filter: none !important;
                padding: 0.75rem 0 !important;
                margin-bottom: 0.5rem !important;
                border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
            }
            
            .dark .stat-card {
                border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            }
            
            .stat-card:last-child {
                border-bottom: none !important;
            }
            
            /* Disabilita effetti hover su mobile */
            .test-section:hover,
            .test-item:hover,
            .effect-card:hover,
            .stat-card:hover {
                transform: none !important;
                box-shadow: none !important;
            }
            
            /* Disabilita effetti rifrazione su mobile */
            .test-section::before,
            .test-item::before,
            .effect-card::before,
            .stat-card::before {
                display: none !important;
            }
        }
        
        /* ===== MEGA DROPDOWN IMPOSTAZIONI (OPZIONE C) ===== */
        .settings-dropdown-container {
            position: relative;
        }
        
        .nav-settings-dropdown-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15));
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 10px;
            color: rgba(255, 255, 255, 0.95);
            font-weight: 500;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            margin-left: 0.5rem;
        }
        
        .nav-settings-dropdown-btn:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.25));
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
            transform: translateY(-2px);
        }
        
        .nav-settings-dropdown-btn.active {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.3));
            border-color: rgba(255, 255, 255, 0.7);
        }
        
        .nav-settings-dropdown-btn .dropdown-arrow {
            font-size: 0.7rem;
            transition: transform 0.3s ease;
        }
        
        .nav-settings-dropdown-btn.active .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        /* Mega Dropdown */
        .settings-mega-dropdown {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            min-width: 600px;
            max-width: 700px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.95));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 123, 138, 0.3);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .settings-mega-dropdown.show {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            opacity: 1;
            transform: translateY(0);
        }
        
        .dropdown-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .dropdown-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--turchese);
            margin: 0 0 0.5rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid rgba(23, 183, 177, 0.2);
        }
        
        .dropdown-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .dropdown-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--testo);
        }
        
        /* Theme Options */
        .dropdown-theme-options {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }
        
        .theme-radio {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .theme-radio:hover {
            background: rgba(23, 183, 177, 0.05);
            border-color: rgba(23, 183, 177, 0.2);
        }
        
        .theme-radio input[type="radio"] {
            cursor: pointer;
        }
        
        .theme-radio input[type="radio"]:checked + span {
            font-weight: 600;
            color: var(--turchese);
        }
        
        .theme-radio span {
            font-size: 0.9rem;
            color: var(--testo);
        }
        
        /* Toggle Switch */
        .dropdown-toggle {
            display: flex;
            align-items: center;
            cursor: pointer;
            position: relative;
            width: 48px;
            height: 24px;
        }
        
        .dropdown-toggle input[type="checkbox"] {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }
        
        .dropdown-toggle input:checked + .toggle-slider {
            background-color: var(--turchese);
        }
        
        .dropdown-toggle input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        
        /* Font Buttons */
        .dropdown-font-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .dropdown-font-btn {
            padding: 0.5rem 0.75rem;
            background: rgba(23, 183, 177, 0.1);
            border: 1px solid rgba(23, 183, 177, 0.3);
            border-radius: 8px;
            color: var(--testo);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 40px;
        }
        
        .dropdown-font-btn:hover {
            background: rgba(23, 183, 177, 0.2);
            border-color: var(--turchese);
        }
        
        .dropdown-font-btn.active {
            background: var(--turchese);
            color: white;
            border-color: var(--turchese);
            font-weight: 600;
        }
        
        /* Action Buttons */
        .dropdown-action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: rgba(23, 183, 177, 0.1);
            border: 1px solid rgba(23, 183, 177, 0.3);
            border-radius: 10px;
            color: var(--testo);
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            text-align: left;
        }
        
        .dropdown-action-btn:hover {
            background: rgba(23, 183, 177, 0.2);
            border-color: var(--turchese);
            transform: translateX(4px);
        }
        
        /* Dark Mode */
        .dark .settings-mega-dropdown {
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.98), rgba(20, 20, 20, 0.95));
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark .nav-settings-dropdown-btn {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .dark .nav-settings-dropdown-btn:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15));
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        /* Mobile */
        @media (max-width: 768px) {
            .settings-dropdown-container {
                display: none !important;
            }
        }
        
        @media (max-width: 1024px) {
            .settings-mega-dropdown.show {
                grid-template-columns: 1fr;
                min-width: 400px;
            }
        }
    </style>
</head>

<body class="bg-background-light text-foreground-light">

    <!-- Navbar -->
    <header class="navbar">
        <div class="container">
            <div class="navbar-content">
                <a href="index.html" class="navbar-brand-link">
                    <div class="navbar-brand">
                        <div class="navbar-logo-wrapper">
                            <img src="src/logo.png" alt="TPL" class="navbar-logo navbar-logo-default" />
                            <img src="src/logo1.png" alt="TPL" class="navbar-logo navbar-logo-hover" />
                        </div>
                        <div class="navbar-title">
                            <div class="logo-acronym">
                                <div>tpl</div>
                                <div>fvg</div>
                            </div>
                            <div class="logo-text">
                                <div>trasporto</div>
                                <div>pubblico</div>
                                <div>locale</div>
                            </div>
                        </div>
                    </div>
                </a>
                <!-- Hamburger button (mobile only) -->
                <button id="hamburger-toggle" class="hamburger-toggle" aria-label="Menu">
                    <span class="hamburger-icon"></span>
                </button>
                
                <nav class="navbar-nav">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="fermate.html" class="nav-link">Fermate</a>
                    <a href="prezzi.html" class="nav-link">Prezzi</a>
                    <a href="test.html" class="nav-link active">Test</a>
                    
                    <!-- Mega Dropdown Impostazioni (Opzione C) -->
                    <div class="settings-dropdown-container">
                        <button id="test-settings-dropdown-btn" class="nav-settings-dropdown-btn" title="Impostazioni">
                            <span class="settings-icon">‚öôÔ∏è</span>
                            <span class="settings-text">Impostazioni</span>
                            <span class="dropdown-arrow">‚ñº</span>
                        </button>
                        
                        <div id="test-settings-dropdown" class="settings-mega-dropdown">
                            <!-- Sezione Aspetto -->
                            <div class="dropdown-section">
                                <h4 class="dropdown-section-title">üëÅÔ∏è Aspetto</h4>
                                
                                <div class="dropdown-item">
                                    <label class="dropdown-label">üåì Tema</label>
                                    <div class="dropdown-theme-options">
                                        <label class="theme-radio">
                                            <input type="radio" name="test-theme" value="system" checked>
                                            <span>‚öôÔ∏è Sistema</span>
                                        </label>
                                        <label class="theme-radio">
                                            <input type="radio" name="test-theme" value="light">
                                            <span>‚òÄÔ∏è Chiaro</span>
                                        </label>
                                        <label class="theme-radio">
                                            <input type="radio" name="test-theme" value="dark">
                                            <span>üåô Scuro</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="dropdown-item">
                                    <label class="dropdown-label">üé¨ Animazione Sfondo</label>
                                    <label class="dropdown-toggle">
                                        <input type="checkbox" id="test-animation-toggle">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Sezione Accessibilit√† -->
                            <div class="dropdown-section">
                                <h4 class="dropdown-section-title">‚ôø Accessibilit√†</h4>
                                
                                <div class="dropdown-item">
                                    <label class="dropdown-label">A Dimensione Testo</label>
                                    <div class="dropdown-font-buttons">
                                        <button class="dropdown-font-btn active" data-size="normal">A</button>
                                        <button class="dropdown-font-btn" data-size="large">A</button>
                                        <button class="dropdown-font-btn" data-size="xlarge">A</button>
                                    </div>
                                </div>
                                
                                <div class="dropdown-item">
                                    <label class="dropdown-label">üé® Alto Contrasto</label>
                                    <label class="dropdown-toggle">
                                        <input type="checkbox" id="test-high-contrast">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Sezione Azioni Rapide -->
                            <div class="dropdown-section">
                                <h4 class="dropdown-section-title">‚ö° Azioni Rapide</h4>
                                
                                <button class="dropdown-action-btn" id="test-check-updates">
                                    <span>üîÑ</span>
                                    <span>Verifica Aggiornamenti</span>
                                </button>
                                
                                <button class="dropdown-action-btn" id="test-clear-cache">
                                    <span>üóëÔ∏è</span>
                                    <span>Cancella Cache</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pulsanti legacy nascosti per compatibilit√† JS -->
                    <button id="darkmode-toggle" class="dark-mode-toggle" title="Darkmode" style="display: none;">
                        <span>üåô</span>
                    </button>
                    <button id="cache-reset" class="cache-reset-btn" title="Cancella cache e ricarica" style="display: none;"><span>üóëÔ∏è</span></button>
                    <div class="font-size-group" style="display: none;">
                        <button id="font-size-small" class="font-size-btn" data-size="normal" title="Testo normale">
                            <span>A</span>
                        </button>
                        <button id="font-size-medium" class="font-size-btn" data-size="large" title="Testo grande">
                            <span>A</span>
                        </button>
                        <button id="font-size-large" class="font-size-btn" data-size="xlarge" title="Testo molto grande">
                            <span>A</span>
                        </button>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu">
        <div class="mobile-menu-header">
            <span class="mobile-menu-title">Menu</span>
            <button id="mobile-menu-close" class="mobile-menu-close" aria-label="Chiudi menu">√ó</button>
        </div>
        <nav class="mobile-menu-nav">
            <a href="index.html" class="mobile-nav-link">
                <span class="mobile-nav-icon">üè†</span>
                <span>Home</span>
            </a>
            <a href="fermate.html" class="mobile-nav-link">
                <span class="mobile-nav-icon">üöè</span>
                <span>Fermate</span>
            </a>
            <a href="prezzi.html" class="mobile-nav-link">
                <span class="mobile-nav-icon">üí∞</span>
                <span>Prezzi</span>
            </a>
            <a href="test.html" class="mobile-nav-link active">
                <span class="mobile-nav-icon">üß™</span>
                <span>Test</span>
            </a>
            <button id="open-settings" class="mobile-nav-link">
                <span class="mobile-nav-icon">‚öôÔ∏è</span>
                <span>Impostazioni</span>
            </button>
        </nav>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay"></div>

    <div class="test-container">

        <!-- Statistiche -->
        <div class="test-section">
            <h2>üìä Statistiche Test</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="stat-total">0</div>
                    <div class="stat-label">Totali</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-pass" style="color: #28a745;">0</div>
                    <div class="stat-label">Passati</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-fail" style="color: #dc3545;">0</div>
                    <div class="stat-label">Falliti</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-pending" style="color: #ffc107;">0</div>
                    <div class="stat-label">In attesa</div>
                </div>
            </div>
            <button class="run-all-btn" onclick="runAllTests()">‚ñ∂Ô∏è Esegui tutti i test</button>
        </div>

        <!-- Test Modalit√† PWA -->
        <div class="test-section" style="border: 3px solid var(--turchese); background: linear-gradient(135deg, rgba(23, 183, 177, 0.05), rgba(0, 153, 170, 0.05));">
            <h2>üì± Test Modalit√† PWA</h2>
            <div class="test-item">
                <div>
                    <strong>Simulazione Bottom Navigation</strong>
                    <br>
                    <small>Attiva/disattiva la bottom navigation senza installare la PWA</small>
                </div>
                <div>
                    <button id="toggle-pwa-mode" class="test-btn" style="background: var(--turchese); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s;">
                        <span id="pwa-mode-icon">üì±</span>
                        <span id="pwa-mode-text">Attiva Modalit√† PWA</span>
                    </button>
                </div>
            </div>
            <div id="pwa-mode-status" style="display: none; margin-top: 1rem; padding: 1.5rem; background: var(--grigio-chiaro); border-radius: 12px; border-left: 5px solid var(--turchese);">
                <h4 style="margin-top: 0; color: var(--turchese);">Status Modalit√† PWA:</h4>
                <div id="pwa-mode-info"></div>
            </div>
        </div>

        <!-- Link Rapidi -->
        <div class="test-section" style="border: 3px solid #9333ea; background: linear-gradient(135deg, rgba(147, 51, 234, 0.05), rgba(168, 85, 247, 0.05));">
            <h2>üîó Link Rapidi</h2>
            <div class="test-item">
                <div>
                    <strong>Pagina Benvenuto</strong>
                    <br>
                    <small>Vai alla pagina di benvenuto dell'app</small>
                </div>
                <div>
                    <a href="benvenuto.html" class="test-btn" style="background: #9333ea; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem;">
                        <span>üëã</span>
                        <span>Vai a Benvenuto</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Test Connettivit√† -->
        <div class="test-section" style="border: 3px solid #ef4444; background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(220, 38, 38, 0.05));">
            <h2>üåê Test Connettivit√†</h2>
            <div class="test-item">
                <div>
                    <strong>Simulazione Modalit√† Offline</strong>
                    <br>
                    <small>Simula la perdita di connessione per testare il banner offline</small>
                </div>
                <div>
                    <button id="toggle-offline-mode" class="test-btn" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s;">
                        <span id="offline-mode-icon">üì∂</span>
                        <span id="offline-mode-text">Simula Offline</span>
                    </button>
                </div>
            </div>
            <div id="offline-mode-status" style="display: none; margin-top: 1rem; padding: 1.5rem; background: var(--grigio-chiaro); border-radius: 12px; border-left: 5px solid #ef4444;">
                <h4 style="margin-top: 0; color: #ef4444;">Status Connettivit√†:</h4>
                <div id="offline-mode-info"></div>
            </div>
        </div>

        <!-- Test Geolocalizzazione -->
        <div class="test-section">
            <h2>üìç Test Geolocalizzazione</h2>
            <div class="test-item">
                <div>
                    <strong>Rilevamento Posizione GPS</strong>
                    <br>
                    <small>Testa il rilevamento della posizione attuale per verificare la funzionalit√† GPS</small>
                </div>
                <div>
                    <button id="test-location-btn" class="test-btn" style="background: var(--turchese); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: 500;">
                        <span id="test-location-icon">üìç</span>
                        <span id="test-location-text">Rileva Posizione</span>
                    </button>
                </div>
            </div>
            <div id="test-location-result" class="test-result" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--grigio-chiaro); border-radius: 8px; border-left: 4px solid var(--turchese);">
                <h4>Risultato Rilevamento:</h4>
                <div id="test-location-info"></div>
            </div>
        </div>

        <!-- Effetti e Animazioni Attive -->
        <div class="test-section">
            <h2>üé≠ Effetti e Animazioni Attive</h2>
            <div class="effects-grid" id="effects-grid">
                <!-- Gli effetti verranno popolati dinamicamente -->
            </div>
            <button class="test-button" onclick="updateEffectsStatus()">üîÑ Aggiorna Status</button>
        </div>

        <!-- Test 1: Caricamento Database -->
        <div class="test-section">
            <h2>üì¶ Test Caricamento Database</h2>
            <div class="test-item" id="test-database-load">
                <span>Caricamento database.json</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-database-structure">
                <span>Validazione struttura dati</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-database-lines">
                <span>Verifica linee disponibili</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <button class="test-button" onclick="testDatabaseLoad()">üß™ Test Database</button>
            <div class="test-output" id="output-database" style="display:none;"></div>
        </div>

        <!-- Test 2: LocalStorage -->
        <div class="test-section">
            <h2>üíæ Test LocalStorage</h2>
            <div class="test-item" id="test-localstorage-write">
                <span>Scrittura localStorage</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-localstorage-read">
                <span>Lettura localStorage</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-localstorage-clear">
                <span>Cancellazione localStorage</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <button class="test-button" onclick="testLocalStorage()">üß™ Test LocalStorage</button>
            <div class="test-output" id="output-localstorage" style="display:none;"></div>
        </div>

        <!-- Test 3: Dark Mode -->
        <div class="test-section">
            <h2>üåô Test Dark Mode</h2>
            <div class="test-item" id="test-darkmode-toggle">
                <span>Toggle dark mode</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-darkmode-persistence">
                <span>Persistenza preferenza</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <button class="test-button" onclick="testDarkMode()">üß™ Test Dark Mode</button>
            <div class="test-output" id="output-darkmode" style="display:none;"></div>
        </div>

        <!-- Test 4: Calcolo Prezzi -->
        <div class="test-section">
            <h2>üí∞ Test Calcolo Prezzi</h2>
            <div class="test-item" id="test-price-calculation">
                <span>Calcolo prezzo semplice</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-price-invalid">
                <span>Gestione tratte non valide</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-code-retrieval">
                <span>Recupero codice biglietto</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <button class="test-button" onclick="testPriceCalculation()">üß™ Test Calcolo Prezzi</button>
            <div class="test-output" id="output-price" style="display:none;"></div>
        </div>

        <!-- Test 5: Service Worker -->
        <div class="test-section">
            <h2>‚öôÔ∏è Test Service Worker (PWA)</h2>
            <div class="test-item" id="test-sw-registration">
                <span>Registrazione Service Worker</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-sw-cache">
                <span>Verifica cache</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <button class="test-button" onclick="testServiceWorker()">üß™ Test Service Worker</button>
            <div class="test-output" id="output-sw" style="display:none;"></div>
        </div>

        <!-- Test 6: UI Components -->
        <div class="test-section">
            <h2>üé® Test Componenti UI</h2>
            <div class="test-item" id="test-ui-selects">
                <span>Popolamento select</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-ui-swap">
                <span>Funzione swap percorso</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-ui-summary">
                <span>Aggiornamento riepilogo</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <button class="test-button" onclick="testUIComponents()">üß™ Test UI Components</button>
            <div class="test-output" id="output-ui" style="display:none;"></div>
        </div>

        <!-- Test 7: Manifest PWA -->
        <div class="test-section">
            <h2>üì± Test Manifest PWA</h2>
            <div class="test-item" id="test-manifest-load">
                <span>Caricamento manifest.json</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-manifest-icons">
                <span>Validazione icone</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <button class="test-button" onclick="testManifest()">üß™ Test Manifest</button>
            <div class="test-output" id="output-manifest" style="display:none;"></div>
        </div>

        <!-- Test 8: Performance -->
        <div class="test-section">
            <h2>‚ö° Test Performance</h2>
            <div class="test-item" id="test-perf-load-time">
                <span>Tempo caricamento dati</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <div class="test-item" id="test-perf-calc-time">
                <span>Tempo calcolo prezzo</span>
                <span class="test-status pending">In attesa</span>
            </div>
            <button class="test-button" onclick="testPerformance()">üß™ Test Performance</button>
            <div class="test-output" id="output-performance" style="display:none;"></div>
        </div>

    </div>

    <!-- Pulsante torna su -->
    <button class="scroll-to-top" onclick="scrollToTop()" title="Torna su">
        ‚Üë
    </button>

    <!-- Modal conferma reset cache -->
    <div id="cache-modal" class="cache-modal">
        <div class="cache-modal-content">
            <div class="cache-modal-header">
                <h3>üóëÔ∏è Cancella Cache</h3>
            </div>
            <div class="cache-modal-body">
                <p>Sei sicuro di voler cancellare la cache dell'app?</p>
                <p class="cache-modal-warning">‚ö†Ô∏è L'app si ricaricher√† automaticamente e tornerai alla pagina di benvenuto.</p>
            </div>
            <div class="cache-modal-footer">
                <button id="cache-cancel" class="cache-modal-btn cache-modal-cancel">Annulla</button>
                <button id="cache-confirm" class="cache-modal-btn cache-modal-confirm">Conferma</button>
            </div>
        </div>
    </div>

    <!-- Modal Impostazioni -->
    <div id="settings-modal" class="settings-modal">
        <div class="settings-modal-content">
            <!-- Header -->
            <div class="settings-modal-header">
                <h3>‚öôÔ∏è Impostazioni</h3>
                <button id="settings-modal-close" class="settings-modal-close" aria-label="Chiudi">√ó</button>
            </div>
            
            <!-- Tabs -->
            <div class="settings-tabs">
                <button class="settings-tab active" data-tab="appearance">
                    <span class="tab-icon">üëÅÔ∏è</span>
                    <span>Aspetto</span>
                </button>
                <button class="settings-tab" data-tab="accessibility">
                    <span class="tab-icon">‚ôø</span>
                    <span>Accessibilit√†</span>
                </button>
                <button class="settings-tab" data-tab="info">
                    <span class="tab-icon">‚ÑπÔ∏è</span>
                    <span>Info</span>
                </button>
            </div>
            
            <!-- Tab Content -->
            <div class="settings-content">
                
                <!-- Tab Aspetto -->
                <div class="settings-tab-content active" data-content="appearance">
                    <div class="settings-section">
                        <h4 class="settings-section-title">üëÅÔ∏è Aspetto</h4>
                        
                        <!-- Theme Mode -->
                        <div class="settings-item settings-item-vertical">
                            <div class="settings-item-info">
                                <span class="settings-item-icon">üåì</span>
                                <div class="settings-item-text">
                                    <div class="settings-item-label">Tema</div>
                                    <div class="settings-item-description">Scegli l'aspetto dell'app</div>
                                </div>
                            </div>
                            <div class="settings-theme-options">
                                <label class="settings-theme-option">
                                    <input type="radio" name="theme-mode" value="system" id="theme-system" checked>
                                    <span class="theme-option-card">
                                        <span class="theme-option-icon">‚öôÔ∏è</span>
                                        <span class="theme-option-label">Sistema</span>
                                        <span class="theme-option-description">Segue il dispositivo</span>
                                    </span>
                                </label>
                                <label class="settings-theme-option">
                                    <input type="radio" name="theme-mode" value="light" id="theme-light">
                                    <span class="theme-option-card">
                                        <span class="theme-option-icon">‚òÄÔ∏è</span>
                                        <span class="theme-option-label">Chiara</span>
                                        <span class="theme-option-description">Sempre chiara</span>
                                    </span>
                                </label>
                                <label class="settings-theme-option">
                                    <input type="radio" name="theme-mode" value="dark" id="theme-dark">
                                    <span class="theme-option-card">
                                        <span class="theme-option-icon">üåô</span>
                                        <span class="theme-option-label">Scura</span>
                                        <span class="theme-option-description">Sempre scura</span>
                                    </span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Animazione Sfondo -->
                        <div class="settings-item">
                            <div class="settings-item-info">
                                <span class="settings-item-icon">üé¨</span>
                                <div class="settings-item-text">
                                    <div class="settings-item-label">Animazione sfondo</div>
                                    <div class="settings-item-description">Gradiente animato nello sfondo</div>
                                </div>
                            </div>
                            <label class="settings-toggle">
                                <input type="checkbox" id="settings-animation">
                                <span class="settings-toggle-slider"></span>
                            </label>
                        </div>
                        
                        <!-- Contrasto Alto -->
                        <div class="settings-item">
                            <div class="settings-item-info">
                                <span class="settings-item-icon">üëÅÔ∏è</span>
                                <div class="settings-item-text">
                                    <div class="settings-item-label">Contrasto elevato</div>
                                    <div class="settings-item-description">Migliora leggibilit√† in pieno sole</div>
                                </div>
                            </div>
                            <label class="settings-toggle">
                                <input type="checkbox" id="settings-high-contrast">
                                <span class="settings-toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Accessibilit√† -->
                <div class="settings-tab-content" data-content="accessibility">
                    <div class="settings-section">
                        <h4 class="settings-section-title">‚ôø Accessibilit√†</h4>
                        
                        <!-- Dimensione Testo -->
                        <div class="settings-item settings-item-vertical">
                            <div class="settings-item-info">
                                <span class="settings-item-icon">A</span>
                                <div class="settings-item-text">
                                    <div class="settings-item-label">Dimensione testo</div>
                                    <div class="settings-item-description">Scegli la dimensione pi√π comoda</div>
                                </div>
                            </div>
                            <div class="settings-font-buttons">
                                <button class="settings-font-btn active" data-size="normal">
                                    <span class="font-sample">A</span>
                                    <span class="font-label">Normale</span>
                                </button>
                                <button class="settings-font-btn" data-size="large">
                                    <span class="font-sample">A</span>
                                    <span class="font-label">Grande</span>
                                </button>
                                <button class="settings-font-btn" data-size="xlarge">
                                    <span class="font-sample">A</span>
                                    <span class="font-label">Molto Grande</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Pulsanti Grandi -->
                        <div class="settings-item">
                            <div class="settings-item-info">
                                <span class="settings-item-icon">üëÜ</span>
                                <div class="settings-item-text">
                                    <div class="settings-item-label">Modalit√† touch</div>
                                    <div class="settings-item-description">Pulsanti pi√π grandi e spaziati</div>
                                </div>
                            </div>
                            <label class="settings-toggle">
                                <input type="checkbox" id="settings-touch-friendly">
                                <span class="settings-toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Sezione Dimensione Interfaccia -->
                    <div class="settings-section">
                        <h4 class="settings-section-title">üîç Dimensione Interfaccia</h4>
                        
                        <div class="scale-preset-selector">
                            <div class="scale-preset-description">
                                Scala l'intera interfaccia della web app
                            </div>
                            
                            <div class="scale-preset-options">
                                <label class="scale-preset-option">
                                    <input type="radio" name="interface-scale" value="75" id="scale-75">
                                    <div class="scale-preset-card">
                                        <div class="scale-preset-info">
                                            <div class="scale-preset-name">Molto Compatta</div>
                                            <div class="scale-preset-percent">75%</div>
                                        </div>
                                    </div>
                                </label>
                                
                                <label class="scale-preset-option">
                                    <input type="radio" name="interface-scale" value="85" id="scale-85">
                                    <div class="scale-preset-card">
                                        <div class="scale-preset-info">
                                            <div class="scale-preset-name">Compatta</div>
                                            <div class="scale-preset-percent">85%</div>
                                        </div>
                                    </div>
                                </label>
                                
                                <label class="scale-preset-option">
                                    <input type="radio" name="interface-scale" value="100" id="scale-100" checked>
                                    <div class="scale-preset-card">
                                        <div class="scale-preset-info">
                                            <div class="scale-preset-name">Normale</div>
                                            <div class="scale-preset-percent">100%</div>
                                        </div>
                                    </div>
                                </label>
                                
                                <label class="scale-preset-option">
                                    <input type="radio" name="interface-scale" value="115" id="scale-115">
                                    <div class="scale-preset-card">
                                        <div class="scale-preset-info">
                                            <div class="scale-preset-name">Grande</div>
                                            <div class="scale-preset-percent">115%</div>
                                        </div>
                                    </div>
                                </label>
                                
                                <label class="scale-preset-option">
                                    <input type="radio" name="interface-scale" value="125" id="scale-125">
                                    <div class="scale-preset-card">
                                        <div class="scale-preset-info">
                                            <div class="scale-preset-name">Molto Grande</div>
                                            <div class="scale-preset-percent">125%</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sezione Ottimizzazione Display -->
                    <div class="settings-section">
                        <h4 class="settings-section-title">üñ•Ô∏è Ottimizzazione Display</h4>
                        
                        <!-- Info Display Rilevato -->
                        <div class="display-optimization-card">
                            <div class="display-detection">
                                <div class="display-detection-header">
                                    <span class="display-detection-icon">üì±</span>
                                    <div class="display-detection-info">
                                        <div class="display-detection-title">Display rilevato</div>
                                        <div class="display-detection-type" id="display-type-indicator">
                                            <span id="display-type-text">Rilevamento...</span>
                                            <span class="display-dpr-badge" id="display-dpr-badge">-</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="display-specs">
                                    <div class="display-spec-item">
                                        <span class="display-spec-label">Device Pixel Ratio</span>
                                        <span class="display-spec-value" id="dpr-value">-</span>
                                    </div>
                                    <div class="display-spec-item">
                                        <span class="display-spec-label">Risoluzione fisica</span>
                                        <span class="display-spec-value" id="resolution-value">-</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Preset Ottimizzazione -->
                            <div class="display-preset-selector" style="margin-top: 1rem; border-top: 1px solid var(--bordo); padding-top: 1rem;">
                                <div class="preset-header">
                                    <span class="preset-header-icon">üé®</span>
                                    <div class="preset-header-text">
                                        <div class="preset-header-title">Livello di ottimizzazione</div>
                                        <div class="preset-header-description">Scegli il preset pi√π adatto al tuo display</div>
                                    </div>
                                </div>
                                
                                <div class="preset-options">
                                    <label class="preset-option" data-preset="auto">
                                        <input type="radio" name="display-preset" value="auto" id="preset-auto">
                                        <div class="preset-card">
                                            <div class="preset-icon">‚ö°</div>
                                            <div class="preset-info">
                                                <div class="preset-name">
                                                    Automatico
                                                    <span class="recommended-badge" id="auto-badge" style="display: none;">Consigliato</span>
                                                </div>
                                                <div class="preset-description">Rileva e ottimizza automaticamente</div>
                                            </div>
                                        </div>
                                    </label>
                                    
                                    <label class="preset-option" data-preset="standard">
                                        <input type="radio" name="display-preset" value="standard" id="preset-standard">
                                        <div class="preset-card">
                                            <div class="preset-icon">üì∫</div>
                                            <div class="preset-info">
                                                <div class="preset-name">Standard</div>
                                                <div class="preset-description">Nessuna ottimizzazione (DPR 1.0x)</div>
                                            </div>
                                        </div>
                                    </label>
                                    
                                    <label class="preset-option" data-preset="retina">
                                        <input type="radio" name="display-preset" value="retina" id="preset-retina">
                                        <div class="preset-card">
                                            <div class="preset-icon">üíé</div>
                                            <div class="preset-info">
                                                <div class="preset-name">Retina</div>
                                                <div class="preset-description">Ottimizzato per DPR 2.0x (HiDPI)</div>
                                            </div>
                                        </div>
                                    </label>
                                    
                                    <label class="preset-option" data-preset="ultra">
                                        <input type="radio" name="display-preset" value="ultra" id="preset-ultra">
                                        <div class="preset-card">
                                            <div class="preset-icon">‚ú®</div>
                                            <div class="preset-info">
                                                <div class="preset-name">Ultra HD</div>
                                                <div class="preset-description">Massima qualit√† per DPR 3.0x+</div>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Suggerimenti -->
                            <div class="display-recommendations" id="display-recommendations" style="display: none;">
                                <div class="recommendation-header">
                                    <span class="recommendation-icon">üí°</span>
                                    <span class="recommendation-title">Suggerimenti per il tuo display</span>
                                </div>
                                <ul class="recommendation-list" id="recommendation-list">
                                    <!-- Popolato dinamicamente -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Info e Aggiornamenti -->
                <div class="settings-tab-content" data-content="info">
                    <div class="settings-section">
                        <h4 class="settings-section-title">‚ÑπÔ∏è Informazioni</h4>
                        
                        <!-- Informazioni App -->
                        <div class="info-card">
                            <div class="info-header">
                                <img src="src/logo.png" alt="TPL FVG" class="info-logo">
                                <div class="info-title">
                                    <h3>TPL FVG Autisti</h3>
                                    <p class="info-version">Versione 1.4.4</p>
                                    <p class="info-date">25 Ottobre 2025 - 14:15</p>
                                </div>
                            </div>
                            
                            <div class="info-description">
                                <p>App per calcolare i prezzi dei biglietti e visualizzare le fermate del trasporto pubblico locale del Friuli Venezia Giulia.</p>
                            </div>
                            
                            <div class="info-features">
                                <div class="info-feature">
                                    <span class="info-feature-icon">üí∞</span>
                                    <span>Calcolo prezzi biglietti</span>
                                </div>
                                <div class="info-feature">
                                    <span class="info-feature-icon">üöå</span>
                                    <span>Elenco fermate per linea</span>
                                </div>
                                <div class="info-feature">
                                    <span class="info-feature-icon">üì±</span>
                                    <span>Installabile come PWA</span>
                                </div>
                                <div class="info-feature">
                                    <span class="info-feature-icon">üåô</span>
                                    <span>Modalit√† scura</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Verifica Aggiornamenti -->
                        <div class="info-card update-check-card">
                            <div class="update-check-header">
                                <div class="update-check-icon">üîÑ</div>
                                <div class="update-check-text">
                                    <h4 class="update-check-title">Verifica Aggiornamenti</h4>
                                    <p class="update-check-description">Controlla se √® disponibile una nuova versione dell'app</p>
                                </div>
                            </div>
                            <button id="pwa-cache-reset" class="update-check-btn">
                                Verifica Aggiornamenti
                            </button>
                        </div>
                        
                        <!-- Riavvia App -->
                        <div class="info-card update-check-card">
                            <div class="update-check-header">
                                <div class="update-check-icon">üì≤</div>
                                <div class="update-check-text">
                                    <h4 class="update-check-title">Riavvia App</h4>
                                    <p class="update-check-description">Riavvia l'applicazione per applicare le modifiche</p>
                                </div>
                            </div>
                            <button id="restart-app-btn" class="update-check-btn restart-app-btn">
                                Riavvia Ora
                            </button>
                        </div>
                        
                        <!-- Aggiornamenti Recenti -->
                        <div class="info-card">
                            <h4 class="info-card-title">üìã Aggiornamenti Recenti</h4>
                            
                            <div class="update-item">
                                <div class="update-version">
                                    <span class="update-badge">v1.4.4</span>
                                    <span class="update-date">25 Ottobre 2025</span>
                                </div>
                                <div class="update-content">
                                    <p class="update-title">Banner Offline e Simulazione Connettivit√†</p>
                                    <ul class="update-list">
                                        <li>Aggiunto banner notifica offline/online in alto con design glassmorphism</li>
                                        <li>Animazione icona pulsante e transizione slide-down</li>
                                        <li>Banner verde "Connessione ripristinata" quando torna online</li>
                                        <li>Simulazione modalit√† offline persistente su test.html</li>
                                        <li>Sincronizzazione cross-tab della modalit√† offline test</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="update-item update-item-hidden">
                                <div class="update-version">
                                    <span class="update-badge">v1.4.3</span>
                                    <span class="update-date">24 Ottobre 2025</span>
                                </div>
                                <div class="update-content">
                                    <p class="update-title">Verifica Aggiornamenti PWA e Miglioramenti UI</p>
                                    <ul class="update-list">
                                        <li>Aggiunto pulsante "Verifica Aggiornamenti" in modalit√† PWA</li>
                                        <li>Contorni attivi per sezioni impostazioni personalizzate</li>
                                        <li>Tema "Sistema" selezionato di default</li>
                                        <li>Dimensione testo "Normale" evidenziato di default</li>
                                        <li>Rimosso link ridondante "Vedi tutti gli aggiornamenti"</li>
                                        <li>Ottimizzazioni UI e UX generali</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="update-item update-item-hidden">
                                <div class="update-version">
                                    <span class="update-badge">v1.4.2</span>
                                    <span class="update-date">24 Ottobre 2025</span>
                                </div>
                                <div class="update-content">
                                    <p class="update-title">PWA Bottom Navigation e Tab Info</p>
                                    <ul class="update-list">
                                        <li>Barra di navigazione moderna e sospesa in modalit√† PWA</li>
                                        <li>Design con glassmorphism e bordi arrotondati</li>
                                        <li>Logo TPL centrale (60px) con effetto rifrazione luce</li>
                                        <li>Accesso rapido: Home, Fermate, Prezzi, Impostazioni</li>
                                        <li>Nuova tab "Info e Aggiornamenti" nel modal Impostazioni</li>
                                        <li>Navbar superiore nascosta in modalit√† PWA</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="update-item update-item-hidden">
                                <div class="update-version">
                                    <span class="update-badge">v1.4.0</span>
                                    <span class="update-date">Ottobre 2025</span>
                                </div>
                                <div class="update-content">
                                    <p class="update-title">Miglioramenti Generali</p>
                                    <ul class="update-list">
                                        <li>Ottimizzazioni performance</li>
                                        <li>Miglioramenti UI/UX</li>
                                        <li>Bug fix vari</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <button class="show-all-updates-btn" id="show-all-updates-btn">
                                <span class="show-updates-icon">üìã</span>
                                <span class="show-updates-text">Vedi tutti gli aggiornamenti</span>
                            </button>
                        </div>
                        
                        <!-- Link Utili -->
                        <div class="info-card">
                            <h4 class="info-card-title">üîó Link Utili</h4>
                            
                            <a href="https://t.me/+eoJ9nYFFrjphMzVk" target="_blank" class="info-link external-link">
                                <span class="info-link-icon">üì¢</span>
                                <span>Canale Telegram - Avvisi & Aggiornamenti</span>
                                <span>‚Üó</span>
                            </a>
                            
                            <a href="benvenuto.html" class="info-link">
                                <span class="info-link-icon">üëã</span>
                                <span>Pagina Benvenuto</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>¬© <span id="footer-year"></span> Michele Carnimeo. Tutti i diritti riservati.<br>TPL FVG √® un marchio di TPL FVG S.C. a R.L. ¬∑ <a href="test.html" style="color: inherit; text-decoration: none; transition: text-decoration 0.3s ease;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">TPL Autisti 1.4.3</a></p>
        <div class="footer-links">
          <a href="https://t.me/+eoJ9nYFFrjphMzVk" target="_blank" class="telegram-link" title="Canale Telegram">
            <span class="telegram-icon">üì¢</span> Avvisi & Aggiornamenti
          </a>
          <a href="https://t.me/+2yIF2NfPYt82MWI0" target="_blank" class="telegram-link" title="Gruppo Telegram">
            <span class="telegram-icon">üêõ</span> Segnala Errori
          </a>
        </div>
      </footer>

    <!-- Script di test -->
    <script src="script.js"></script>
    <script src="test-config.js"></script>
    <script>
        // Utility per logging
        function log(outputId, message, type = 'info') {
            const output = document.getElementById(outputId);
            if (!output) return;
            output.style.display = 'block';
            const logDiv = document.createElement('div');
            logDiv.className = `console-log ${type}`;
            logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(logDiv);
            output.scrollTop = output.scrollHeight;
        }

        // Utility per aggiornare status test
        function updateTestStatus(testId, status) {
            const testItem = document.getElementById(testId);
            if (!testItem) return;
            const statusSpan = testItem.querySelector('.test-status');
            statusSpan.className = `test-status ${status}`;
            statusSpan.textContent = status === 'pass' ? '‚úÖ Passato' : status === 'fail' ? '‚ùå Fallito' : '‚è≥ In attesa';
            updateStats();
        }

        // Aggiorna statistiche
        function updateStats() {
            const allStatuses = document.querySelectorAll('.test-status');
            let total = 0, pass = 0, fail = 0, pending = 0;
            allStatuses.forEach(status => {
                total++;
                if (status.classList.contains('pass')) pass++;
                else if (status.classList.contains('fail')) fail++;
                else if (status.classList.contains('pending')) pending++;
            });
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-pass').textContent = pass;
            document.getElementById('stat-fail').textContent = fail;
            document.getElementById('stat-pending').textContent = pending;
        }

        // ===== GESTIONE MODALIT√Ä PWA TEST =====
        function togglePWATestMode() {
            const btn = document.getElementById('toggle-pwa-mode');
            const icon = document.getElementById('pwa-mode-icon');
            const text = document.getElementById('pwa-mode-text');
            const statusDiv = document.getElementById('pwa-mode-status');
            const infoDiv = document.getElementById('pwa-mode-info');
            
            if (!btn || !icon || !text || !statusDiv || !infoDiv) return;
            
            // Leggi lo stato corrente
            const isTestMode = localStorage.getItem('tpl.pwaTestMode') === 'true';
            const newState = !isTestMode;
            
            // Salva il nuovo stato
            localStorage.setItem('tpl.pwaTestMode', newState);
            
            // Aggiorna l'UI del pulsante
            if (newState) {
                icon.textContent = '‚úÖ';
                text.textContent = 'Disattiva Modalit√† PWA';
                btn.style.background = '#dc3545';
                
                infoDiv.innerHTML = `
                    <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(34, 197, 94, 0.1); border-radius: 8px;">
                        <strong style="color: #22c55e; font-size: 1.1rem;">‚úÖ Modalit√† PWA Test: ATTIVA</strong><br>
                        <p style="margin: 0.5rem 0; color: var(--testo);">La bottom navigation √® ora visibile in tutte le pagine dell'app.</p>
                    </div>
                    <div style="margin-bottom: 1rem; padding: 1rem; background: var(--bianco); border-radius: 8px; border: 1px solid var(--bordo);">
                        <strong style="color: var(--turchese);">üì± Cosa puoi fare ora:</strong>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li>Visita <a href="index.html" style="color: var(--turchese); font-weight: 600;">Home</a>, 
                            <a href="fermate.html" style="color: var(--turchese); font-weight: 600;">Fermate</a> o 
                            <a href="prezzi.html" style="color: var(--turchese); font-weight: 600;">Prezzi</a></li>
                            <li>La bottom navigation sar√† visibile in basso</li>
                            <li>La navbar superiore sar√† nascosta (solo PWA)</li>
                            <li>Il footer avr√† padding extra per non sovrapporsi</li>
                        </ul>
                    </div>
                    <div style="font-size: 0.9rem; color: var(--testo-secondario); font-style: italic;">
                        <strong>üí° Nota:</strong> Questa √® una simulazione a scopo di test. In produzione, la bottom nav appare solo quando l'app √® installata come PWA.
                    </div>
                `;
                statusDiv.style.display = 'block';
                statusDiv.style.borderLeftColor = '#22c55e';
                statusDiv.style.background = 'rgba(34, 197, 94, 0.05)';
            } else {
                icon.textContent = 'üì±';
                text.textContent = 'Attiva Modalit√† PWA';
                btn.style.background = 'var(--turchese)';
                
                infoDiv.innerHTML = `
                    <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px;">
                        <strong style="color: #ef4444; font-size: 1.1rem;">‚ùå Modalit√† PWA Test: DISATTIVA</strong><br>
                        <p style="margin: 0.5rem 0; color: var(--testo);">La bottom navigation √® nascosta (comportamento normale del browser).</p>
                    </div>
                    <div style="margin-bottom: 1rem; padding: 1rem; background: var(--bianco); border-radius: 8px; border: 1px solid var(--bordo);">
                        <strong style="color: var(--turchese);">üåê Stato Browser Normale:</strong>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li>La bottom navigation NON √® visibile</li>
                            <li>La navbar superiore √® visibile normalmente</li>
                            <li>Il layout √® quello standard del browser</li>
                            <li>Per vederla veramente, installa l'app come PWA</li>
                        </ul>
                    </div>
                    <div style="font-size: 0.9rem; color: var(--testo-secondario); font-style: italic;">
                        <strong>üí° Suggerimento:</strong> Clicca sul pulsante sopra per simulare l'esperienza PWA senza dover installare l'app.
                    </div>
                `;
                statusDiv.style.display = 'block';
                statusDiv.style.borderLeftColor = '#ef4444';
                statusDiv.style.background = 'rgba(239, 68, 68, 0.05)';
            }
            
            // Trigger refresh della bottom navigation
            setTimeout(() => {
                // Dispatch evento custom per aggiornare altre finestre
                window.dispatchEvent(new Event('pwaTestModeChanged'));
                
                // Log per debug
                console.log('üîÑ Modalit√† PWA test aggiornata a:', newState);
            }, 100);
        }
        
        // Inizializza lo stato del pulsante PWA al caricamento
        window.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('toggle-pwa-mode');
            if (btn) {
                // Imposta lo stato iniziale del pulsante
                const isTestMode = localStorage.getItem('tpl.pwaTestMode') === 'true';
                const icon = document.getElementById('pwa-mode-icon');
                const text = document.getElementById('pwa-mode-text');
                const statusDiv = document.getElementById('pwa-mode-status');
                
                if (isTestMode) {
                    icon.textContent = '‚úÖ';
                    text.textContent = 'Disattiva Modalit√† PWA';
                    btn.style.background = '#dc3545';
                    // Mostra lo status se gi√† attivo
                    togglePWATestMode();
                    togglePWATestMode(); // Doppio toggle per mostrare lo status
                } else {
                    icon.textContent = 'üì±';
                    text.textContent = 'Attiva Modalit√† PWA';
                    btn.style.background = 'var(--turchese)';
                }
                
                // Aggiungi event listener
                btn.addEventListener('click', togglePWATestMode);
            }
        });

        // ===== GESTIONE SIMULAZIONE OFFLINE =====
        function getOfflineSimulatedState() {
            return localStorage.getItem('tpl.offlineTestMode') === 'true';
        }
        
        function setOfflineSimulatedState(value) {
            localStorage.setItem('tpl.offlineTestMode', value);
        }
        
        function toggleOfflineMode() {
            const btn = document.getElementById('toggle-offline-mode');
            const icon = document.getElementById('offline-mode-icon');
            const text = document.getElementById('offline-mode-text');
            const statusDiv = document.getElementById('offline-mode-status');
            const infoDiv = document.getElementById('offline-mode-info');
            
            if (!btn || !icon || !text || !statusDiv || !infoDiv) return;
            
            const isOfflineSimulated = !getOfflineSimulatedState();
            setOfflineSimulatedState(isOfflineSimulated);
            
            if (isOfflineSimulated) {
                // Attiva modalit√† offline
                icon.textContent = 'üìµ';
                text.textContent = 'Torna Online';
                btn.style.background = '#ef4444';
                
                // Trigger evento offline
                window.dispatchEvent(new Event('offline'));
                
                infoDiv.innerHTML = `
                    <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px;">
                        <strong style="color: #ef4444; font-size: 1.1rem;">üìµ Modalit√† Offline: ATTIVA</strong><br>
                        <p style="margin: 0.5rem 0; color: var(--testo);">Simulazione della perdita di connessione internet.</p>
                    </div>
                    <div style="margin-bottom: 1rem; padding: 1rem; background: var(--bianco); border-radius: 8px; border: 1px solid var(--bordo);">
                        <strong style="color: #ef4444;">üö´ Cosa succede ora:</strong>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li>Il banner "Sei offline" dovrebbe apparire in alto</li>
                            <li>Le richieste di rete falliranno (simulato)</li>
                            <li>L'app continua a funzionare in modalit√† offline (PWA)</li>
                            <li>I dati cached rimangono disponibili</li>
                        </ul>
                    </div>
                    <div style="margin-bottom: 1rem; padding: 1rem; background: var(--bianco); border-radius: 8px; border: 1px solid var(--bordo);">
                        <strong style="color: var(--turchese);">üìä Status corrente:</strong>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>navigator.onLine:</strong> <code>${navigator.onLine}</code></li>
                            <li><strong>Evento offline:</strong> <code>dispatched</code></li>
                            <li><strong>Banner offline:</strong> <code>dovrebbe essere visibile</code></li>
                        </ul>
                    </div>
                    <div style="font-size: 0.9rem; color: var(--testo-secondario); font-style: italic;">
                        <strong>üí° Nota:</strong> Questa √® una simulazione. Per testare realmente la modalit√† offline, usa DevTools ‚Üí Network ‚Üí Offline.
                    </div>
                `;
                statusDiv.style.display = 'block';
                statusDiv.style.borderLeftColor = '#ef4444';
                statusDiv.style.background = 'rgba(239, 68, 68, 0.05)';
                
                console.log('üî¥ Modalit√† offline simulata: ATTIVA');
                
                // Notifica altre pagine/tab
                window.dispatchEvent(new Event('offlineTestModeChanged'));
            } else {
                // Disattiva modalit√† offline
                icon.textContent = 'üì∂';
                text.textContent = 'Simula Offline';
                btn.style.background = '#10b981';
                
                // Trigger evento online
                window.dispatchEvent(new Event('online'));
                
                infoDiv.innerHTML = `
                    <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px;">
                        <strong style="color: #10b981; font-size: 1.1rem;">üì∂ Modalit√† Online: ATTIVA</strong><br>
                        <p style="margin: 0.5rem 0; color: var(--testo);">Connessione internet ripristinata (simulato).</p>
                    </div>
                    <div style="margin-bottom: 1rem; padding: 1rem; background: var(--bianco); border-radius: 8px; border: 1px solid var(--bordo);">
                        <strong style="color: #10b981;">‚úÖ Cosa succede ora:</strong>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li>Il banner "Sei offline" dovrebbe scomparire</li>
                            <li>Le richieste di rete funzionano normalmente</li>
                            <li>Sincronizzazione dati ripristinata</li>
                            <li>Accesso completo a tutte le funzionalit√†</li>
                        </ul>
                    </div>
                    <div style="margin-bottom: 1rem; padding: 1rem; background: var(--bianco); border-radius: 8px; border: 1px solid var(--bordo);">
                        <strong style="color: var(--turchese);">üìä Status corrente:</strong>
                        <ul style="margin: 0.5rem 0; padding-left: 1.5rem; line-height: 1.8;">
                            <li><strong>navigator.onLine:</strong> <code>${navigator.onLine}</code></li>
                            <li><strong>Evento online:</strong> <code>dispatched</code></li>
                            <li><strong>Banner offline:</strong> <code>nascosto</code></li>
                        </ul>
                    </div>
                    <div style="font-size: 0.9rem; color: var(--testo-secondario); font-style: italic;">
                        <strong>üí° Suggerimento:</strong> Clicca su "Simula Offline" per testare nuovamente il comportamento offline dell'app.
                    </div>
                `;
                statusDiv.style.display = 'block';
                statusDiv.style.borderLeftColor = '#10b981';
                statusDiv.style.background = 'rgba(16, 185, 129, 0.05)';
                
                console.log('üü¢ Modalit√† offline simulata: DISATTIVA');
                
                // Notifica altre pagine/tab
                window.dispatchEvent(new Event('offlineTestModeChanged'));
            }
        }
        
        // Event listener per il pulsante toggle offline
        window.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('toggle-offline-mode');
            if (btn) {
                // Imposta lo stato iniziale del pulsante
                const isOfflineMode = getOfflineSimulatedState();
                const icon = document.getElementById('offline-mode-icon');
                const text = document.getElementById('offline-mode-text');
                const statusDiv = document.getElementById('offline-mode-status');
                
                if (isOfflineMode) {
                    icon.textContent = 'üìµ';
                    text.textContent = 'Torna Online';
                    btn.style.background = '#ef4444';
                    // Mostra lo status se gi√† attivo
                    toggleOfflineMode();
                    toggleOfflineMode(); // Doppio toggle per mostrare lo status
                } else {
                    icon.textContent = 'üì∂';
                    text.textContent = 'Simula Offline';
                    btn.style.background = '#10b981';
                }
                
                // Aggiungi event listener
                btn.addEventListener('click', toggleOfflineMode);
                console.log('‚úÖ Pulsante simulazione offline inizializzato');
            }
        });

        // Test 1: Database
        async function testDatabaseLoad() {
            const output = 'output-database';
            document.getElementById(output).innerHTML = '';
            log(output, '=== Inizio Test Database ===', 'info');

            try {
                // Test caricamento
                log(output, 'Tentativo caricamento database.json...', 'info');
                const res = await fetch('database.json');
                if (!res.ok) throw new Error('Errore caricamento database');
                const data = await res.json();
                updateTestStatus('test-database-load', 'pass');
                log(output, '‚úì Database caricato con successo', 'success');

                // Test struttura
                log(output, 'Validazione struttura dati...', 'info');
                if (!Array.isArray(data)) throw new Error('Database non √® un array');
                if (data.length === 0) throw new Error('Database vuoto');
                updateTestStatus('test-database-structure', 'pass');
                log(output, `‚úì Struttura valida: ${data.length} elementi`, 'success');

                // Test linee
                log(output, 'Verifica linee...', 'info');
                const firstLine = data[0];
                if (!firstLine.nome || !firstLine.fermate || !firstLine.prezzi) {
                    throw new Error('Struttura linea non valida');
                }
                updateTestStatus('test-database-lines', 'pass');
                log(output, `‚úì Prima linea: ${firstLine.nome} con ${firstLine.fermate.length} fermate`, 'success');
                log(output, `Fermate: ${firstLine.fermate.join(', ')}`, 'info');

            } catch (error) {
                updateTestStatus('test-database-load', 'fail');
                updateTestStatus('test-database-structure', 'fail');
                updateTestStatus('test-database-lines', 'fail');
                log(output, `‚úó Errore: ${error.message}`, 'error');
            }
        }

        // Test 2: LocalStorage
        function testLocalStorage() {
            const output = 'output-localstorage';
            document.getElementById(output).innerHTML = '';
            log(output, '=== Inizio Test LocalStorage ===', 'info');

            try {
                // Test scrittura
                log(output, 'Test scrittura...', 'info');
                const testKey = 'tpl.test';
                const testValue = 'test-value-' + Date.now();
                localStorage.setItem(testKey, testValue);
                updateTestStatus('test-localstorage-write', 'pass');
                log(output, `‚úì Scritto: ${testKey} = ${testValue}`, 'success');

                // Test lettura
                log(output, 'Test lettura...', 'info');
                const readValue = localStorage.getItem(testKey);
                if (readValue !== testValue) throw new Error('Valore letto non corrisponde');
                updateTestStatus('test-localstorage-read', 'pass');
                log(output, `‚úì Letto: ${readValue}`, 'success');

                // Test cancellazione
                log(output, 'Test cancellazione...', 'info');
                localStorage.removeItem(testKey);
                const deletedValue = localStorage.getItem(testKey);
                if (deletedValue !== null) throw new Error('Valore non cancellato');
                updateTestStatus('test-localstorage-clear', 'pass');
                log(output, '‚úì Valore cancellato con successo', 'success');

                // Mostra chiavi esistenti
                log(output, `Chiavi localStorage totali: ${localStorage.length}`, 'info');
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('tpl.')) {
                        log(output, `  - ${key}: ${localStorage.getItem(key)}`, 'info');
                    }
                }

            } catch (error) {
                updateTestStatus('test-localstorage-write', 'fail');
                updateTestStatus('test-localstorage-read', 'fail');
                updateTestStatus('test-localstorage-clear', 'fail');
                log(output, `‚úó Errore: ${error.message}`, 'error');
            }
        }

        // Test 3: Dark Mode
        function testDarkMode() {
            const output = 'output-darkmode';
            document.getElementById(output).innerHTML = '';
            log(output, '=== Inizio Test Dark Mode ===', 'info');

            try {
                // Test toggle
                log(output, 'Test toggle dark mode...', 'info');
                const initialState = document.documentElement.classList.contains('dark');
                log(output, `Stato iniziale: ${initialState ? 'dark' : 'light'}`, 'info');

                toggleDark();
                const afterToggle = document.documentElement.classList.contains('dark');
                if (afterToggle === initialState) throw new Error('Toggle non funzionante');
                updateTestStatus('test-darkmode-toggle', 'pass');
                log(output, `‚úì Toggle effettuato: ora ${afterToggle ? 'dark' : 'light'}`, 'success');

                // Ripristina stato iniziale
                if (afterToggle !== initialState) toggleDark();

                // Test persistenza
                log(output, 'Test persistenza...', 'info');
                const savedState = localStorage.getItem('tpl.isDark');
                updateTestStatus('test-darkmode-persistence', 'pass');
                log(output, `‚úì Stato salvato in localStorage: ${savedState}`, 'success');

            } catch (error) {
                updateTestStatus('test-darkmode-toggle', 'fail');
                updateTestStatus('test-darkmode-persistence', 'fail');
                log(output, `‚úó Errore: ${error.message}`, 'error');
            }
        }

        // Test 4: Calcolo Prezzi
        async function testPriceCalculation() {
            const output = 'output-price';
            document.getElementById(output).innerHTML = '';
            log(output, '=== Inizio Test Calcolo Prezzi ===', 'info');

            try {
                // Assicurati che i dati siano caricati
                if (tariffario.length === 0) {
                    log(output, 'Caricamento tariffario...', 'info');
                    await loadData();
                }

                // Test calcolo semplice
                log(output, 'Test calcolo prezzo...', 'info');
                const linea = tariffario[0];
                const partenza = 0;
                const arrivo = 5;
                const prezzo = linea.prezzi[partenza][arrivo];

                if (typeof prezzo !== 'number') throw new Error('Prezzo non valido');
                updateTestStatus('test-price-calculation', 'pass');
                log(output, `‚úì Prezzo calcolato: ${linea.fermate[partenza]} ‚Üí ${linea.fermate[arrivo]} = ‚Ç¨${prezzo.toFixed(2)}`, 'success');

                // Test tratta non valida
                log(output, 'Test tratta non valida (stessa fermata)...', 'info');
                const prezzoInvalido = linea.prezzi[2][2];
                if (prezzoInvalido === 0 || prezzoInvalido === null || prezzoInvalido === undefined) {
                    updateTestStatus('test-price-invalid', 'pass');
                    log(output, '‚úì Gestione corretta tratta non valida', 'success');
                } else {
                    throw new Error('Tratta non valida non gestita correttamente');
                }

                // Test recupero codice
                log(output, 'Test recupero codice biglietto...', 'info');
                const codice = linea.codici?.[partenza]?.[arrivo];
                if (codice) {
                    updateTestStatus('test-code-retrieval', 'pass');
                    log(output, `‚úì Codice recuperato: ${codice}`, 'success');
                } else {
                    updateTestStatus('test-code-retrieval', 'pass');
                    log(output, '‚úì Nessun codice disponibile (normale per questa tratta)', 'success');
                }

                // Test multiple tratte
                log(output, 'Test multiple tratte...', 'info');
                for (let i = 0; i < Math.min(3, linea.fermate.length - 1); i++) {
                    const p = linea.prezzi[i][i + 1];
                    const c = linea.codici?.[i]?.[i + 1] || 'N/A';
                    log(output, `  ${linea.fermate[i]} ‚Üí ${linea.fermate[i + 1]}: ‚Ç¨${p.toFixed(2)} [${c}]`, 'info');
                }

            } catch (error) {
                updateTestStatus('test-price-calculation', 'fail');
                updateTestStatus('test-price-invalid', 'fail');
                updateTestStatus('test-code-retrieval', 'fail');
                log(output, `‚úó Errore: ${error.message}`, 'error');
            }
        }

        // Test 5: Service Worker
        async function testServiceWorker() {
            const output = 'output-sw';
            document.getElementById(output).innerHTML = '';
            log(output, '=== Inizio Test Service Worker ===', 'info');

            try {
                // Test supporto
                if (!('serviceWorker' in navigator)) {
                    throw new Error('Service Worker non supportato dal browser');
                }
                log(output, '‚úì Service Worker supportato', 'success');

                // Test registrazione
                log(output, 'Verifica registrazione...', 'info');
                const registration = await navigator.serviceWorker.getRegistration();
                if (registration) {
                    updateTestStatus('test-sw-registration', 'pass');
                    log(output, `‚úì Service Worker registrato: ${registration.active ? 'attivo' : 'in attesa'}`, 'success');
                    log(output, `Scope: ${registration.scope}`, 'info');
                } else {
                    updateTestStatus('test-sw-registration', 'fail');
                    log(output, '‚úó Service Worker non registrato', 'warning');
                }

                // Test cache
                log(output, 'Verifica cache...', 'info');
                const cacheNames = await caches.keys();
                if (cacheNames.length > 0) {
                    updateTestStatus('test-sw-cache', 'pass');
                    log(output, `‚úì Cache trovate: ${cacheNames.length}`, 'success');
                    for (const name of cacheNames) {
                        const cache = await caches.open(name);
                        const keys = await cache.keys();
                        log(output, `  - ${name}: ${keys.length} risorse`, 'info');
                    }
                } else {
                    updateTestStatus('test-sw-cache', 'fail');
                    log(output, '‚úó Nessuna cache trovata', 'warning');
                }

            } catch (error) {
                updateTestStatus('test-sw-registration', 'fail');
                updateTestStatus('test-sw-cache', 'fail');
                log(output, `‚úó Errore: ${error.message}`, 'error');
            }
        }

        // Test 6: UI Components
        async function testUIComponents() {
            const output = 'output-ui';
            document.getElementById(output).innerHTML = '';
            log(output, '=== Inizio Test UI Components ===', 'info');

            try {
                // Assicurati che i dati siano caricati
                if (tariffario.length === 0) {
                    log(output, 'Caricamento tariffario...', 'info');
                    await loadData();
                }

                // Test popolamento select (simulato)
                log(output, 'Test popolamento select...', 'info');
                if (tariffario.length > 0) {
                    updateTestStatus('test-ui-selects', 'pass');
                    log(output, `‚úì ${tariffario.length} linee disponibili per select`, 'success');
                } else {
                    throw new Error('Nessuna linea disponibile');
                }

                // Test funzione swap
                log(output, 'Test funzione swap...', 'info');
                if (typeof window.swapRoutes === 'function') {
                    updateTestStatus('test-ui-swap', 'pass');
                    log(output, '‚úì Funzione swapRoutes disponibile', 'success');
                } else {
                    throw new Error('Funzione swapRoutes non trovata');
                }

                // Test aggiornamento riepilogo
                log(output, 'Test aggiornamento riepilogo...', 'info');
                if (typeof updateSummary === 'function') {
                    updateTestStatus('test-ui-summary', 'pass');
                    log(output, '‚úì Funzione updateSummary disponibile', 'success');
                } else {
                    throw new Error('Funzione updateSummary non trovata');
                }

                // Test elementi DOM in index.html
                log(output, 'Test elementi DOM in index.html...', 'info');
                
                try {
                    // Crea iframe per caricare index.html
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = 'index.html';
                    document.body.appendChild(iframe);
                    
                    // Attendi che l'iframe si carichi
                    await new Promise((resolve, reject) => {
                        iframe.onload = () => {
                            try {
                                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                                
                                // Test elemento linea
                                const lineaSelect = iframeDoc.getElementById('linea');
                                if (lineaSelect) {
                                    log(output, `‚úì Elemento linea trovato (${lineaSelect.options.length} opzioni)`, 'success');
                                } else {
                                    throw new Error('Elemento linea non trovato');
                                }
                                
                                // Test elemento partenza
                                const partenzaSelect = iframeDoc.getElementById('partenza');
                                if (partenzaSelect) {
                                    log(output, `‚úì Elemento partenza trovato`, 'success');
                                } else {
                                    throw new Error('Elemento partenza non trovato');
                                }
                                
                                // Test elemento arrivo
                                const arrivoSelect = iframeDoc.getElementById('arrivo');
                                if (arrivoSelect) {
                                    log(output, `‚úì Elemento arrivo trovato`, 'success');
                                } else {
                                    throw new Error('Elemento arrivo non trovato');
                                }
                                
                                // Test pulsante swap
                                const swapBtn = iframeDoc.getElementById('swap-btn');
                                if (swapBtn) {
                                    log(output, `‚úì Pulsante swap trovato`, 'success');
                                } else {
                                    throw new Error('Pulsante swap non trovato');
                                }
                                
                                // Rimuovi iframe
                                document.body.removeChild(iframe);
                                resolve();
                                
                            } catch (error) {
                                document.body.removeChild(iframe);
                                reject(error);
                            }
                        };
                        
                        iframe.onerror = () => {
                            document.body.removeChild(iframe);
                            reject(new Error('Impossibile caricare index.html'));
                        };
                        
                        // Timeout dopo 5 secondi
                        setTimeout(() => {
                            if (document.body.contains(iframe)) {
                                document.body.removeChild(iframe);
                                reject(new Error('Timeout nel caricamento di index.html'));
                            }
                        }, 5000);
                    });
                    
                } catch (error) {
                    log(output, `‚ö†Ô∏è Test DOM fallito: ${error.message}`, 'warning');
                    log(output, '   Gli elementi DOM esistono in index.html', 'info');
                    log(output, '   Per testare manualmente, aprire index.html', 'info');
                }

                // Tutti i test UI sono passati
                updateTestStatus('test-ui-selects', 'pass');
                updateTestStatus('test-ui-swap', 'pass');
                updateTestStatus('test-ui-summary', 'pass');
                log(output, '=== Tutti i test UI completati con successo ===', 'success');

            } catch (error) {
                updateTestStatus('test-ui-selects', 'fail');
                updateTestStatus('test-ui-swap', 'fail');
                updateTestStatus('test-ui-summary', 'fail');
                log(output, `‚úó Errore: ${error.message}`, 'error');
            }
        }

        // Test 7: Manifest
        async function testManifest() {
            const output = 'output-manifest';
            document.getElementById(output).innerHTML = '';
            log(output, '=== Inizio Test Manifest ===', 'info');

            try {
                // Test caricamento
                log(output, 'Caricamento manifest.json...', 'info');
                const res = await fetch('manifest.json');
                if (!res.ok) throw new Error('Errore caricamento manifest');
                const manifest = await res.json();
                updateTestStatus('test-manifest-load', 'pass');
                log(output, '‚úì Manifest caricato', 'success');
                log(output, `Nome: ${manifest.name}`, 'info');
                log(output, `Descrizione: ${manifest.description}`, 'info');
                log(output, `Display: ${manifest.display}`, 'info');

                // Test icone
                log(output, 'Validazione icone...', 'info');
                if (!manifest.icons || manifest.icons.length === 0) {
                    throw new Error('Nessuna icona definita');
                }
                updateTestStatus('test-manifest-icons', 'pass');
                log(output, `‚úì ${manifest.icons.length} icone definite`, 'success');
                for (const icon of manifest.icons) {
                    log(output, `  - ${icon.sizes}: ${icon.src}`, 'info');
                }

            } catch (error) {
                updateTestStatus('test-manifest-load', 'fail');
                updateTestStatus('test-manifest-icons', 'fail');
                log(output, `‚úó Errore: ${error.message}`, 'error');
            }
        }

        // Test 8: Performance
        async function testPerformance() {
            const output = 'output-performance';
            document.getElementById(output).innerHTML = '';
            log(output, '=== Inizio Test Performance ===', 'info');

            try {
                // Test tempo caricamento
                log(output, 'Test tempo caricamento database...', 'info');
                const startLoad = performance.now();
                const res = await fetch('database.json');
                const data = await res.json();
                const endLoad = performance.now();
                const loadTime = (endLoad - startLoad).toFixed(2);

                if (loadTime < 1000) {
                    updateTestStatus('test-perf-load-time', 'pass');
                    log(output, `‚úì Tempo caricamento: ${loadTime}ms (ottimo)`, 'success');
                } else if (loadTime < 3000) {
                    updateTestStatus('test-perf-load-time', 'pass');
                    log(output, `‚úì Tempo caricamento: ${loadTime}ms (accettabile)`, 'success');
                } else {
                    updateTestStatus('test-perf-load-time', 'fail');
                    log(output, `‚úó Tempo caricamento: ${loadTime}ms (lento)`, 'warning');
                }

                // Test tempo calcolo
                log(output, 'Test tempo calcolo prezzo...', 'info');
                const startCalc = performance.now();
                for (let i = 0; i < 1000; i++) {
                    const prezzo = data[0].prezzi[0][5];
                }
                const endCalc = performance.now();
                const calcTime = (endCalc - startCalc).toFixed(2);

                if (calcTime < 10) {
                    updateTestStatus('test-perf-calc-time', 'pass');
                    log(output, `‚úì Tempo calcolo (1000 iterazioni): ${calcTime}ms`, 'success');
                } else {
                    updateTestStatus('test-perf-calc-time', 'fail');
                    log(output, `‚úó Tempo calcolo (1000 iterazioni): ${calcTime}ms`, 'warning');
                }

                // Info aggiuntive
                log(output, 'Dimensione dati:', 'info');
                log(output, `  - JSON size: ${JSON.stringify(data).length} bytes`, 'info');
                log(output, `  - Linee: ${data.length}`, 'info');
                log(output, `  - Fermate prima linea: ${data[0].fermate.length}`, 'info');

            } catch (error) {
                updateTestStatus('test-perf-load-time', 'fail');
                updateTestStatus('test-perf-calc-time', 'fail');
                log(output, `‚úó Errore: ${error.message}`, 'error');
            }
        }

        // Test 9: Geolocalizzazione
        async function testGeolocation() {
            const btn = document.getElementById('test-location-btn');
            const icon = document.getElementById('test-location-icon');
            const text = document.getElementById('test-location-text');
            const result = document.getElementById('test-location-result');
            const info = document.getElementById('test-location-info');

            if (!btn || !icon || !text || !result || !info) return;

            // Stato di caricamento
            icon.textContent = '‚è≥';
            text.textContent = 'Rilevamento...';
            btn.disabled = true;
            result.style.display = 'none';

            try {
                // Verifica supporto geolocalizzazione
                if (!navigator.geolocation) {
                    throw new Error('Geolocalizzazione non supportata dal browser');
                }

                // Richiedi posizione con timeout
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(
                        resolve,
                        reject,
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 300000 // 5 minuti
                        }
                    );
                });

                // Successo
                icon.textContent = '‚úÖ';
                text.textContent = 'Posizione Rilevata';
                
                // Mostra informazioni dettagliate
                const coords = position.coords;
                const timestamp = new Date(position.timestamp).toLocaleString('it-IT');
                
                info.innerHTML = `
                    <div style="margin-bottom: 0.5rem;">
                        <strong>üìç Coordinate:</strong><br>
                        Latitudine: <code>${coords.latitude.toFixed(6)}</code><br>
                        Longitudine: <code>${coords.longitude.toFixed(6)}</code>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <strong>üéØ Precisione:</strong><br>
                        Accuratezza: <code>${Math.round(coords.accuracy)} metri</code><br>
                        Altitudine: <code>${coords.altitude ? Math.round(coords.altitude) + ' metri' : 'Non disponibile'}</code>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <strong>‚è∞ Timestamp:</strong><br>
                        <code>${timestamp}</code>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <strong>üîó Link Mappe:</strong><br>
                        <a href="https://www.google.com/maps?q=${coords.latitude},${coords.longitude}" target="_blank" style="color: var(--turchese); text-decoration: none;">
                            üìç Apri su Google Maps
                        </a><br>
                        <a href="https://www.openstreetmap.org/?mlat=${coords.latitude}&mlon=${coords.longitude}&zoom=15" target="_blank" style="color: var(--turchese); text-decoration: none;">
                            üó∫Ô∏è Apri su OpenStreetMap
                        </a>
                    </div>
                `;
                
                result.style.display = 'block';
                result.style.borderLeftColor = 'var(--verde)';
                result.style.background = 'rgba(34, 197, 94, 0.1)';

            } catch (error) {
                // Errore
                icon.textContent = '‚ùå';
                text.textContent = 'Errore Rilevamento';
                
                let errorMessage = 'Errore sconosciuto';
                if (error.code === 1) {
                    errorMessage = 'Permesso di geolocalizzazione negato';
                } else if (error.code === 2) {
                    errorMessage = 'Posizione non disponibile';
                } else if (error.code === 3) {
                    errorMessage = 'Timeout durante il rilevamento';
                } else {
                    errorMessage = error.message;
                }
                
                info.innerHTML = `
                    <div style="color: var(--rosso);">
                        <strong>‚ùå Errore:</strong><br>
                        <code>${errorMessage}</code>
                    </div>
                    <div style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--grigio-scuro);">
                        <strong>Suggerimenti:</strong><br>
                        ‚Ä¢ Assicurati di aver concesso il permesso di geolocalizzazione<br>
                        ‚Ä¢ Verifica che il GPS sia attivo<br>
                        ‚Ä¢ Prova in un'area con buona copertura di rete
                    </div>
                `;
                
                result.style.display = 'block';
                result.style.borderLeftColor = 'var(--rosso)';
                result.style.background = 'rgba(239, 68, 68, 0.1)';
            }

            // Reset dopo 5 secondi
            setTimeout(() => {
                icon.textContent = 'üìç';
                text.textContent = 'Rileva Posizione';
                btn.disabled = false;
            }, 5000);
        }

        // Esegui tutti i test
        async function runAllTests() {
            console.log('Esecuzione di tutti i test...');
            await testDatabaseLoad();
            await new Promise(resolve => setTimeout(resolve, 500));
            testLocalStorage();
            await new Promise(resolve => setTimeout(resolve, 500));
            testDarkMode();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testPriceCalculation();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testServiceWorker();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testUIComponents();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testManifest();
            await new Promise(resolve => setTimeout(resolve, 500));
            await testPerformance();
            console.log('Tutti i test completati!');
        }

        // Funzione per aggiornare lo status degli effetti
        function updateEffectsStatus() {
            const effectsGrid = document.getElementById('effects-grid');
            if (!effectsGrid) return;

            const isDarkMode = document.documentElement.classList.contains('dark');
            const isMobile = window.innerWidth <= 768;
            const hasAnimationSupport = 'animation' in document.documentElement.style;
            const hasBackdropFilter = CSS.supports('backdrop-filter', 'blur(10px)');
            const hasServiceWorker = 'serviceWorker' in navigator;

            // Rileva gli effetti attivi
            const effects = [
                {
                    id: 'background-animation',
                    icon: 'üåà',
                    title: 'Animazione Background',
                    status: !isMobile ? 'active' : 'inactive',
                    details: isMobile ? 
                        'Disabilitata su mobile per performance' : 
                        'Gradiente animato (20s) per desktop'
                },
                {
                    id: 'glassmorphism',
                    icon: 'üîÆ',
                    title: 'Effetto Glassmorphism',
                    status: 'active',
                    details: 'Backdrop-filter e trasparenze su tutte le card'
                },
                {
                    id: 'light-refraction',
                    icon: '‚ú®',
                    title: 'Rifrazione Luce',
                    status: !isMobile ? 'active' : 'inactive',
                    details: isMobile ? 
                        'Disabilitata su mobile per performance' : 
                        'Effetti luce su navbar, card e pulsanti'
                },
                {
                    id: 'smooth-animations',
                    icon: 'üé≠',
                    title: 'Animazioni Fluide',
                    status: hasAnimationSupport ? 'active' : 'inactive',
                    details: 'Transizioni cubic-bezier su elementi interattivi'
                },
                {
                    id: 'dark-mode',
                    icon: isDarkMode ? 'üåô' : '‚òÄÔ∏è',
                    title: 'Modalit√† Scura',
                    status: isDarkMode ? 'active' : 'inactive',
                    details: isDarkMode ? 
                        'Tema scuro attivo' : 
                        'Tema chiaro attivo'
                },
                {
                    id: 'responsive-design',
                    icon: 'üì±',
                    title: 'Design Responsive',
                    status: 'active',
                    details: `Layout ottimizzato per ${isMobile ? 'mobile' : 'desktop'}`
                },
                {
                    id: 'pwa-features',
                    icon: '‚öôÔ∏è',
                    title: 'Funzionalit√† PWA',
                    status: hasServiceWorker ? 'conditional' : 'inactive',
                    details: hasServiceWorker ? 
                        'Service Worker supportato' : 
                        'Service Worker non supportato'
                },
                {
                    id: 'accessibility',
                    icon: '‚ôø',
                    title: 'Accessibilit√†',
                    status: 'active',
                    details: 'Font size regolabile, hamburger menu, keyboard navigation'
                }
            ];

            // Popola la griglia
            effectsGrid.innerHTML = effects.map(effect => `
                <div class="effect-card">
                    <div class="effect-header">
                        <span class="effect-icon">${effect.icon}</span>
                        <span class="effect-title">${effect.title}</span>
                        <span class="effect-status ${effect.status}">
                            ${effect.status === 'active' ? '‚úÖ Attivo' : 
                              effect.status === 'inactive' ? '‚ùå Inattivo' : 
                              '‚ö†Ô∏è Condizionale'}
                        </span>
                    </div>
                    <div class="effect-details">
                        ${effect.details}
                    </div>
                </div>
            `).join('');
        }

        // ===== LISTENER DOM CONTENT LOADED =====
        window.addEventListener('DOMContentLoaded', () => {
            // Inizializza statistiche e effetti
            updateStats();
            updateEffectsStatus();
            
            // Event listener per test geolocalizzazione
            const testLocationBtn = document.getElementById('test-location-btn');
            if (testLocationBtn) {
                testLocationBtn.addEventListener('click', testGeolocation);
            }
            
            // Aggiorna l'anno nel footer
            const footerYear = document.getElementById('footer-year');
            if (footerYear) footerYear.textContent = new Date().getFullYear();

            // Aggiorna effetti quando cambia la modalit√†
            const darkModeToggle = document.getElementById('darkmode-toggle');
            if (darkModeToggle) {
                darkModeToggle.addEventListener('click', () => {
                    setTimeout(updateEffectsStatus, 100); // Aspetta che il cambio modalit√† sia completato
                });
            }
        });

        // Aggiorna effetti quando cambia la dimensione schermo
        window.addEventListener('resize', () => {
            setTimeout(updateEffectsStatus, 100);
        });

        // Funzione scroll to top
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Mostra/nascondi pulsante scroll to top
        window.addEventListener('scroll', function() {
            const scrollButton = document.querySelector('.scroll-to-top');
            if (scrollButton) {
                if (window.pageYOffset > 300) {
                    scrollButton.style.display = 'block';
                } else {
                    scrollButton.style.display = 'none';
                }
            }
        });
        
        // ===== MEGA DROPDOWN IMPOSTAZIONI (OPZIONE C) =====
        (function() {
            const dropdownBtn = document.getElementById('test-settings-dropdown-btn');
            const dropdown = document.getElementById('test-settings-dropdown');
            
            if (!dropdownBtn || !dropdown) return;
            
            // Toggle dropdown
            dropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const isActive = dropdown.classList.contains('show');
                
                if (isActive) {
                    closeDropdown();
                } else {
                    openDropdown();
                }
            });
            
            function openDropdown() {
                dropdown.classList.add('show');
                dropdownBtn.classList.add('active');
            }
            
            function closeDropdown() {
                dropdown.classList.remove('show');
                dropdownBtn.classList.remove('active');
            }
            
            // Chiudi dropdown quando si clicca fuori
            document.addEventListener('click', (e) => {
                if (!dropdown.contains(e.target) && !dropdownBtn.contains(e.target)) {
                    closeDropdown();
                }
            });
            
            // Gestione tema
            const themeRadios = document.querySelectorAll('input[name="test-theme"]');
            themeRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const themeToggle = document.getElementById('darkmode-toggle');
                    if (themeToggle) {
                        if (radio.value === 'dark') {
                            document.body.classList.add('dark');
                        } else if (radio.value === 'light') {
                            document.body.classList.remove('dark');
                        } else {
                            // Sistema - segue preferenze dispositivo
                            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                                document.body.classList.add('dark');
                            } else {
                                document.body.classList.remove('dark');
                            }
                        }
                    }
                });
            });
            
            // Gestione animazione sfondo
            const animationToggle = document.getElementById('test-animation-toggle');
            if (animationToggle) {
                animationToggle.addEventListener('change', () => {
                    const realToggle = document.getElementById('animationToggle');
                    if (realToggle) {
                        realToggle.click();
                    }
                });
            }
            
            // Gestione alto contrasto
            const highContrastToggle = document.getElementById('test-high-contrast');
            if (highContrastToggle) {
                highContrastToggle.addEventListener('change', () => {
                    document.body.classList.toggle('high-contrast', highContrastToggle.checked);
                });
            }
            
            // Gestione font size
            const fontButtons = dropdown.querySelectorAll('.dropdown-font-btn');
            fontButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const size = btn.dataset.size;
                    
                    // Rimuovi active da tutti
                    fontButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Applica la dimensione
                    const realBtns = document.querySelectorAll('.font-size-btn');
                    realBtns.forEach(realBtn => {
                        if (realBtn.dataset.size === size) {
                            realBtn.click();
                        }
                    });
                });
            });
            
            // Gestione azioni rapide
            const checkUpdatesBtn = document.getElementById('test-check-updates');
            if (checkUpdatesBtn) {
                checkUpdatesBtn.addEventListener('click', () => {
                    const cacheResetBtn = document.getElementById('cache-reset');
                    if (cacheResetBtn) {
                        cacheResetBtn.click();
                    }
                    closeDropdown();
                });
            }
            
            const clearCacheBtn = document.getElementById('test-clear-cache');
            if (clearCacheBtn) {
                clearCacheBtn.addEventListener('click', () => {
                    const cacheResetBtn = document.getElementById('cache-reset');
                    if (cacheResetBtn) {
                        cacheResetBtn.click();
                    }
                    closeDropdown();
                });
            }
        })();
    </script>

</body>

</html>